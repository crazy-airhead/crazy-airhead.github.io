<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"l4qiang.me","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="记录点滴，注重积累。">
<meta property="og:type" content="website">
<meta property="og:title" content="CrazyAirhead">
<meta property="og:url" content="http://l4qiang.me/page/3/index.html">
<meta property="og:site_name" content="CrazyAirhead">
<meta property="og:description" content="记录点滴，注重积累。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="L4qiang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://l4qiang.me/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>CrazyAirhead</title>
  


  <script data-pjax>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2613e7f510eebd12cf4d0d067e4ce195";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">CrazyAirhead</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">疯狂的傻瓜，傻瓜也疯狂——傻方能执著，疯狂才专注!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/crazy-airhead" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2025/02/16/course100/024/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/16/course100/024/" class="post-title-link" itemprop="url">Web 开发 —— 高阶 WebSocket 和 SSE</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-02-16 10:14:21 / 修改时间：10:15:45" itemprop="dateCreated datePublished" datetime="2025-02-16T10:14:21+08:00">2025-02-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/" itemprop="url" rel="index"><span itemprop="name">教程100</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">写作</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/" itemprop="url" rel="index"><span itemprop="name">Solon</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/Solon-%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Solon 实用教程</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>随着大语言模型的流行，因为使用了 SSE 或者 Websocket的技术进行流式的交换，使得 SSE 和 Websocket也火了起来，今天我们来讲解，如何在 Solon 中实现 Websocket  服务端和 SSE 服务端。</p>
<h2 id="Websocket"><a href="#Websocket" class="headerlink" title="Websocket"></a>Websocket</h2><p>WebSocket 是 HTML5 开始提供的一种在单个 TCP 连接上进行全双工通讯的协议。它使得客户端和服务器之间的数据交换变得更加简单，允许服务端主动向客户端推送数据。在 WebSocket API 中，浏览器和服务器只需要完成一次握手，两者之间就直接可以创建持久性的连接，并进行双向数据传输。</p>
<p>我们这里通过一个简易的 im 的服务做为例子。</p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><p>如果使用了solon-web，默认使用的是smart-http，已经集成了 websocket，不需要添加其他的依赖。</p>
<table>
<thead>
<tr>
<th>插件</th>
<th>适配框架</th>
<th>包大小</th>
<th>信号协议支持</th>
<th>端口</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://solon.noear.org/article/90">solon-boot-smarthttp</a></td>
<td>smart-http (aio)</td>
<td>0.4Mb</td>
<td>http, ws</td>
<td>相同端口</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://solon.noear.org/article/91">solon-boot-jetty</a> + solon-boot-jetty-add-websocket</td>
<td>jetty (nio)</td>
<td>1.9Mb</td>
<td>http, ws</td>
<td>相同端口</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://solon.noear.org/article/92">solon-boot-undertow</a></td>
<td>undertow (nio)</td>
<td>4.3Mb</td>
<td>http, ws</td>
<td>相同端口</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://solon.noear.org/article/93">solon-boot-websocket</a></td>
<td>websocket (nio)</td>
<td>0.4Mb</td>
<td>ws</td>
<td>独立端口</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://solon.noear.org/article/551">solon-boot-websocket-netty</a></td>
<td>netty (nio)</td>
<td></td>
<td>ws</td>
<td>独立端口</td>
</tr>
</tbody></table>
<p>独立的 WebSocket 插件，会使用独立的端口，且默认为：主端口 + 10000，但都可以通过配置进行修改。</p>
<h3 id="启用"><a href="#启用" class="headerlink" title="启用"></a>启用</h3><p>在主类开启 Websocket。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.noear.solon.Solon;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.SolonMain;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SolonMain</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoWeb05App</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Solon.start(</span><br><span class="line">        DemoWeb05App.class,</span><br><span class="line">        args,</span><br><span class="line">        app -&gt; &#123;</span><br><span class="line">          app.enableWebSocket(<span class="keyword">true</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="开放端点"><a href="#开放端点" class="headerlink" title="开放端点"></a>开放端点</h3><p>这里集成了 SimpleWebSocketListener，已经提供了基本的实现，可以根据实际的需要实现需要的接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.im.endpoint;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.im.service.ImService;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Inject;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.net.annotation.ServerEndpoint;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.net.websocket.WebSocket;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.net.websocket.listener.SimpleWebSocketListener;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ServerEndpoint(&quot;/im.ws&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImWebsocket</span> <span class="keyword">extends</span> <span class="title">SimpleWebSocketListener</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> ImService service;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOpen</span><span class="params">(WebSocket socket)</span> </span>&#123;</span><br><span class="line">    service.onOpen(socket);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(WebSocket socket, String text)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    service.onMessage(socket, text);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现逻辑"><a href="#实现逻辑" class="headerlink" title="实现逻辑"></a>实现逻辑</h3><p>此处只是做简单的鉴权，和消息的回复，如果要实现完整的 IM 服务，还需要做会话的管理的逻辑。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.im.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> org.dromara.hutool.core.text.StrUtil;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Component;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.net.websocket.WebSocket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImService</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOpen</span><span class="params">(WebSocket socket)</span> </span>&#123;</span><br><span class="line">    String token = socket.param(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isBlank(token)) &#123;</span><br><span class="line">      socket.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 省略了管理 socket 的管理</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(WebSocket socket, String text)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    socket.send(<span class="string">&quot;&gt; &quot;</span> + text + <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;消息已阅&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=N2U0ZmI3YjBjOWVjOGE4ZDdjOTNkN2ViZTA1MzkyMmFfNTZ0aUlXbzVyZG5hcUNMMFhOY1h6aUlhZ255MllqVllfVG9rZW46Skg1YmI5VmlMb21ydGd4OTJZMmMxQVBHbjJlXzE3Mzk2NzIxMDg6MTczOTY3NTcwOF9WNA" alt="img"></p>
<h2 id="SSE"><a href="#SSE" class="headerlink" title="SSE"></a>SSE</h2><p>SSE 全称是 Server-Sent Event，网页自动获取来自服务器的更新，SSE 是单向消息传递。</p>
<p>我们这里通过一个简易的 LLM 的服务做为例子。</p>
<h3 id="依赖-1"><a href="#依赖-1" class="headerlink" title="依赖"></a>依赖</h3><p>要实现 SSE 需要引入 solon-web-sse。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    <span class="function">implementation <span class="title">platform</span><span class="params">(project(<span class="string">&quot;:demo-parent&quot;</span>)</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">implementation</span><span class="params">(<span class="string">&quot;org.noear:solon-web&quot;</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">implementation</span><span class="params">(<span class="string">&quot;org.noear:solon-web-sse&quot;</span>)</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="开放端点-1"><a href="#开放端点-1" class="headerlink" title="开放端点"></a>开放端点</h3><p>客户端先要调用 open 方法，初始化 SseEmitter 连接，之后就可以通过 SseEmitter 给客户端发送消息了，为了方便测试这里还提供了 send 方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.chat.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.chat.service.ChatService;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Controller;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Inject;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Mapping;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.web.sse.SseEmitter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Mapping(&quot;/chat&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChatController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> ChatService service;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(value = &quot;/open/&#123;id&#125;&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> SseEmitter <span class="title">open</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service.open(id);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(&quot;/send/&#123;id&#125;&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">send</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service.send(id);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(&quot;/close/&#123;id&#125;&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">close</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service.close(id);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现逻辑-1"><a href="#实现逻辑-1" class="headerlink" title="实现逻辑"></a>实现逻辑</h3><p>与 Websocket 不同的是，SSE 是单向连接，请求的过程是不带会话连接的，所以需要自己管理好会话。 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.chat.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.noear.snack.ONode;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.Utils;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Component;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.Result;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.web.sse.SseEmitter;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.web.sse.SseEvent;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChatService</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> Map&lt;String, SseEmitter&gt; emitterMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> SseEmitter <span class="title">open</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    SseEmitter sseEmitter =</span><br><span class="line">        <span class="keyword">new</span> SseEmitter(<span class="number">60</span> * <span class="number">1000L</span>)</span><br><span class="line">            .onCompletion(() -&gt; emitterMap.remove(id))</span><br><span class="line">            .onError(e -&gt; log.error(<span class="string">&quot;初始化 sse 错误&quot;</span>, e))</span><br><span class="line">            .onInited(s -&gt; emitterMap.put(id, s));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      sseEmitter.send(<span class="string">&quot;Ok&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">      log.error(<span class="string">&quot;发送 sse 错误&quot;</span>, e);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化后，才能使用</span></span><br><span class="line">    <span class="keyword">return</span> sseEmitter;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">send</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    SseEmitter emitter = emitterMap.get(id);</span><br><span class="line">    <span class="keyword">if</span> (emitter == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;No user: &quot;</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String msg = <span class="string">&quot;test msg -&gt; &quot;</span> + System.currentTimeMillis();</span><br><span class="line">    System.out.println(msg);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      emitter.send(msg);</span><br><span class="line">      <span class="comment">// reconnectTime 用于提示前端重连时间</span></span><br><span class="line">      emitter.send(<span class="keyword">new</span> SseEvent().id(Utils.guid()).data(msg).reconnectTime(<span class="number">1000L</span>));</span><br><span class="line">      emitter.send(ONode.stringify(Result.succeed(msg)));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">      log.error(<span class="string">&quot;发送 sse 错误&quot;</span>, e);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Ok&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">close</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    SseEmitter emitter = emitterMap.get(id);</span><br><span class="line">    <span class="keyword">if</span> (emitter != <span class="keyword">null</span>) &#123;</span><br><span class="line">      emitter.complete();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Ok&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="验证-1"><a href="#验证-1" class="headerlink" title="验证"></a>验证</h3><p>ApiFox 支持测试 SSE，连接成功之后就可以调用 send 方法。</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=Nzk1OTVkMjM1Y2JkNTYzNjM2NzE2NmUzOGNhOWY0YzdfT3V4MUVvWkp4ZGswNFl5SjJ3ZHV2bExjakZjUFk3N1VfVG9rZW46SkFHV2JJbHhUb1lZQ3l4UnhNRGNGZUtabktjXzE3Mzk2NzIxMDg6MTczOTY3NTcwOF9WNA" alt="img"></p>
<p>也可以直接使用 curl 进行测试</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=NDk5NTNlOGQ3NDM1ZDAxMjc3MjBhYmYwZDI1ZjkxYWJfWDlaaU1PWkpNUlN6d3lHemo0WklhY3R2eldrMWxxVklfVG9rZW46VzVUc2IzSmpEbzBHelR4ZHNCcWNIZHV4bmZjXzE3Mzk2NzIxMDg6MTczOTY3NTcwOF9WNA" alt="img"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2025/02/15/course100/023/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/15/course100/023/" class="post-title-link" itemprop="url">Web 开发 —— 高阶 本地网关</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-02-15 20:30:26 / 修改时间：20:34:06" itemprop="dateCreated datePublished" datetime="2025-02-15T20:30:26+08:00">2025-02-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/" itemprop="url" rel="index"><span itemprop="name">教程100</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">写作</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/" itemprop="url" rel="index"><span itemprop="name">Solon</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/Solon-%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Solon 实用教程</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>11k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>10 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>这里说本地网关，主要是为了区分分布式网关。</p>
<p>在 Web 进阶中，我们讲解了如何定制过滤器和拦截器，提到 Action 本质上是 Handler 和 Class Method 的结合通过，今天我们要讲解一种特殊的Handler —— Gateway（本地网关），通过本地网关更统一的定制系统功能，比如二级路由、拦截、过滤、熔断、异常处理等，虽然直接使用过滤器，也可以做统一的鉴权和异常处理，但网关还可以把一批接口编排进多个网关中，从而实现不同的协议。</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>在 IDEA 中通过 <code>File-&gt;New-&gt;Modules...</code> 可以创建新的模块 <code>demo-web04</code>，基础代码和配置可以从<code>demo-web02</code>中拷贝过来。</p>
<p>在这里，我们将继续调整<code>demo-web02</code>，通过 Gateway 来统一的控制逻辑。</p>
<ul>
<li>增加路由分组，<code>/admin-api/**</code> 对应管理端接口，<code>/app-api/**</code>对应应用端接口</li>
<li>不同的路由分组使用不同的过滤器，从而实现不同的协议等。</li>
</ul>
<h3 id="通用"><a href="#通用" class="headerlink" title="通用"></a>通用</h3><h4 id="BaseGateway"><a href="#BaseGateway" class="headerlink" title="BaseGateway"></a>BaseGateway</h4><p>通过 Component 的标签来添加过滤器的通用逻辑。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.common.gateway;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.function.Predicate;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.Solon;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.BeanWrap;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.Filter;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.Gateway;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseGateway</span> <span class="keyword">extends</span> <span class="title">Gateway</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFilters</span><span class="params">(Predicate&lt;BeanWrap&gt; where)</span> </span>&#123;</span><br><span class="line">    Solon.context()</span><br><span class="line">        .lifecycle(</span><br><span class="line">            () -&gt;</span><br><span class="line">                Solon.context()</span><br><span class="line">                    .beanForeach(</span><br><span class="line">                        (bw) -&gt; &#123;</span><br><span class="line">                          <span class="keyword">if</span> (where.test(bw)) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (bw.raw() <span class="keyword">instanceof</span> Filter) &#123;</span><br><span class="line">                              filter(bw.index(), bw.raw());</span><br><span class="line">                            &#125;</span><br><span class="line">                          &#125;</span><br><span class="line">                        &#125;));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="SwaggerConfig"><a href="#SwaggerConfig" class="headerlink" title="SwaggerConfig"></a>SwaggerConfig</h4><p>对 /admin-api 和 /app-api 的文档进行分组。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.common.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.xiaoymin.knife4j.solon.extension.OpenApiExtensionResolver;</span><br><span class="line"><span class="keyword">import</span> io.swagger.models.Scheme;</span><br><span class="line"><span class="keyword">import</span> io.swagger.models.auth.ApiKeyAuthDefinition;</span><br><span class="line"><span class="keyword">import</span> io.swagger.models.auth.In;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Predicate;</span><br><span class="line"><span class="keyword">import</span> org.dromara.hutool.core.text.StrUtil;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.Solon;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Inject;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.BeanWrap;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.docs.DocDocket;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.docs.models.ApiContact;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.docs.models.ApiInfo;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfig</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> OpenApiExtensionResolver openApiExtensionResolver;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean(&quot;adminApi&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> DocDocket <span class="title">adminApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    DocDocket docDocket =</span><br><span class="line">        <span class="keyword">new</span> DocDocket()</span><br><span class="line">            .groupName(<span class="string">&quot;Admin 端接口&quot;</span>)</span><br><span class="line">            .info(</span><br><span class="line">                <span class="keyword">new</span> ApiInfo()</span><br><span class="line">                    .title(<span class="string">&quot;porpoise-demo&quot;</span>)</span><br><span class="line">                    .description(<span class="string">&quot;在线API文档&quot;</span>)</span><br><span class="line">                    .contact(<span class="keyword">new</span> ApiContact().name(<span class="string">&quot;CrazyAirhead&quot;</span>).email(<span class="string">&quot;l4qiang@hotmail.com&quot;</span>))</span><br><span class="line">                    .version(<span class="string">&quot;1.0&quot;</span>))</span><br><span class="line">            .schemes(Scheme.HTTP.toValue())</span><br><span class="line">            .globalResponseInData(<span class="keyword">true</span>)</span><br><span class="line">            .basePath(getBasePath())</span><br><span class="line">            .vendorExtensions(openApiExtensionResolver.buildExtensions())</span><br><span class="line">            .securityExtensions(<span class="string">&quot;token&quot;</span>, <span class="keyword">new</span> ApiKeyAuthDefinition().name(<span class="string">&quot;token&quot;</span>).in(In.HEADER));</span><br><span class="line"></span><br><span class="line">    addApis(docDocket, bw -&gt; <span class="string">&quot;adminApi&quot;</span>.equals(bw.tag()));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> docDocket;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean(&quot;appApi&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> DocDocket <span class="title">appApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    DocDocket docDocket =</span><br><span class="line">        <span class="keyword">new</span> DocDocket()</span><br><span class="line">            .groupName(<span class="string">&quot;app 端接口&quot;</span>)</span><br><span class="line">            .info(</span><br><span class="line">                <span class="keyword">new</span> ApiInfo()</span><br><span class="line">                    .title(<span class="string">&quot;Ficus&quot;</span>)</span><br><span class="line">                    .description(<span class="string">&quot;在线App API文档&quot;</span>)</span><br><span class="line">                    .termsOfService(<span class="string">&quot;https://jishunetwork.com&quot;</span>)</span><br><span class="line">                    .contact(</span><br><span class="line">                        <span class="keyword">new</span> ApiContact()</span><br><span class="line">                            .name(<span class="string">&quot;Ficus&quot;</span>)</span><br><span class="line">                            .url(<span class="string">&quot;https://jishunetwork.com&quot;</span>)</span><br><span class="line">                            .email(<span class="string">&quot;l4qiang@gmail.com&quot;</span>))</span><br><span class="line">                    .version(<span class="string">&quot;1.0&quot;</span>))</span><br><span class="line">            .schemes(Scheme.HTTP.toValue())</span><br><span class="line">            .globalResponseInData(<span class="keyword">true</span>)</span><br><span class="line">            .basePath(getBasePath());</span><br><span class="line"></span><br><span class="line">    addApis(docDocket, bw -&gt; <span class="string">&quot;appApi&quot;</span>.equals(bw.tag()));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> docDocket;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> String <span class="title">getBasePath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String basePath = Solon.cfg().serverContextPath();</span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isBlank(basePath)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;/&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (basePath.endsWith(<span class="string">&quot;/&quot;</span>)) &#123;</span><br><span class="line">      basePath = basePath.substring(<span class="number">0</span>, basePath.length() - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> basePath;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addApis</span><span class="params">(DocDocket docDocket, Predicate&lt;BeanWrap&gt; where)</span> </span>&#123;</span><br><span class="line">    Solon.context()</span><br><span class="line">        .lifecycle(</span><br><span class="line">            () -&gt;</span><br><span class="line">                Solon.context()</span><br><span class="line">                    .beanForeach(</span><br><span class="line">                        bw -&gt; &#123;</span><br><span class="line">                          <span class="keyword">if</span> (where.test(bw)) &#123;</span><br><span class="line">                            String name = bw.clz().getName();</span><br><span class="line">                            docDocket.apis(name);</span><br><span class="line">                          &#125;</span><br><span class="line">                        &#125;));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="管理端"><a href="#管理端" class="headerlink" title="管理端"></a>管理端</h3><h4 id="AdminGateway"><a href="#AdminGateway" class="headerlink" title="AdminGateway"></a>AdminGateway</h4><p>路由注册，添加 adminApi 标签的过滤器，添加 adminApi 标签的请求方法。除了按批添加接口，还可以单独添加，这里未单独列出。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.common.gateway;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Component;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Mapping;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Mapping(&quot;/admin-api/**&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminGateway</span> <span class="keyword">extends</span> <span class="title">BaseGateway</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 添加过滤器</span></span><br><span class="line">    addFilters(beanWrap -&gt; <span class="string">&quot;adminApi&quot;</span>.equals(beanWrap.tag()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加接口</span></span><br><span class="line">    addBeans(beanWrap -&gt; <span class="string">&quot;adminApi&quot;</span>.equals(beanWrap.tag()));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AdminExceptionFilter"><a href="#AdminExceptionFilter" class="headerlink" title="AdminExceptionFilter"></a>AdminExceptionFilter</h4><p>增加 adminApi 的标签，delivered设置为false，这样不会被加载为全局的路由，index设置为-1，提供有限级。为了区分与 App 端的不同，这里的的错误会返回异常的具体信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.common.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.common.model.Ret;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Component;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.Context;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.Filter;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.FilterChain;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.validation.ValidatorException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component(tag = &quot;adminApi&quot;, delivered = false, index = -1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminExceptionFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(Context ctx, FilterChain chain)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      chain.doFilter(ctx);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ValidatorException e) &#123;</span><br><span class="line">      log.error(<span class="string">&quot;validator exception&quot;</span>, e);</span><br><span class="line"></span><br><span class="line">      ctx.status(e.getCode());</span><br><span class="line">      ctx.outputAsJson(Ret.fail(e.getMessage()).toJson());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">      log.error(<span class="string">&quot;other throwable&quot;</span>, e);</span><br><span class="line"></span><br><span class="line">      ctx.status(<span class="number">500</span>);</span><br><span class="line">      ctx.outputAsJson(Ret.fail(e.getMessage()).toJson());</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">// 文件清理放此处也算合理，异常时需要清理和尝试恢复</span></span><br><span class="line">      <span class="keyword">if</span> (ctx.isMultipartFormData()) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          ctx.filesDelete();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">          log.error(<span class="string">&quot;clean temp file exception&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AdminTokenFilter"><a href="#AdminTokenFilter" class="headerlink" title="AdminTokenFilter"></a>AdminTokenFilter</h4><p>管理端需要 token 校验，这里也是为了演示通过不同的 Gateway 可以有不同的过滤器的配置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.common.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.dromara.hutool.core.text.StrUtil;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Component;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.Context;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.Filter;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.FilterChain;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component(tag = &quot;adminApi&quot;, delivered = false, index = 0)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminTokenFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(Context ctx, FilterChain chain)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    String token = ctx.header(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isBlank(token)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;token 不能为空&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    chain.doFilter(ctx);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="DeptController"><a href="#DeptController" class="headerlink" title="DeptController"></a>DeptController</h4><p>这里的 Controller 去除了 @Controller 的注解和 @Mapping 的注解，使用的是 @Component 的注解，并设置了adminApi的标签，以便 AdminGateway 能进行批量的添加。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.manage.controller.admin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.common.annotation.OperateLog;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.common.model.Ret;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.manage.dto.DeptDto;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.manage.service.DeptService;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component(tag = &quot;adminApi&quot;)</span></span><br><span class="line"><span class="meta">@Api(&quot;管理端 部门管理&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> DeptService service;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(value = &quot;listWithException&quot;)</span></span><br><span class="line">  <span class="meta">@Get</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;获取列表但返回异常&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Ret&lt;List&lt;DeptDto&gt;&gt; listWithException() &#123;</span><br><span class="line">    <span class="keyword">return</span> Ret.ok(service.listWithException());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(value = &quot;list&quot;)</span></span><br><span class="line">  <span class="meta">@Get</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;获取列表&quot;)</span></span><br><span class="line">  <span class="meta">@OperateLog</span></span><br><span class="line">  <span class="keyword">public</span> Ret&lt;List&lt;DeptDto&gt;&gt; list() &#123;</span><br><span class="line">    <span class="keyword">return</span> Ret.ok(service.list());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="应用端"><a href="#应用端" class="headerlink" title="应用端"></a>应用端</h3><h4 id="AppGateway"><a href="#AppGateway" class="headerlink" title="AppGateway"></a>AppGateway</h4><p>路由注册，添加 appApi 标签的过滤器，添加 appApi 标签的请求方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.common.gateway;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Component;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Mapping;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Mapping(&quot;/app-api/**&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppGateway</span> <span class="keyword">extends</span> <span class="title">BaseGateway</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 添加过滤器</span></span><br><span class="line">    addFilters(beanWrap -&gt; <span class="string">&quot;appApi&quot;</span>.equals(beanWrap.tag()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加接口</span></span><br><span class="line">    addBeans(beanWrap -&gt; <span class="string">&quot;appApi&quot;</span>.equals(beanWrap.tag()));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AppExceptionFilter"><a href="#AppExceptionFilter" class="headerlink" title="AppExceptionFilter"></a>AppExceptionFilter</h4><p>Component增加 appApi 的标签，delivered设置为false，这样不会被加载为全局的路由，index设置为-1，提高优先级。为了区分与 Admin 端的不同，这里的的错误只返回「服务器错误，请重试」这样的错误信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.common.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.common.model.Ret;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Component;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.Context;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.Filter;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.FilterChain;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.validation.ValidatorException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * App</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component(tag = &quot;appApi&quot;, delivered = false, index = -1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppExceptionFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(Context ctx, FilterChain chain)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      chain.doFilter(ctx);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ValidatorException e) &#123;</span><br><span class="line">      log.error(<span class="string">&quot;validator exception&quot;</span>, e);</span><br><span class="line"></span><br><span class="line">      ctx.status(e.getCode());</span><br><span class="line">      ctx.outputAsJson(Ret.fail(<span class="string">&quot;服务器错误，请重试&quot;</span>).toJson());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">      log.error(<span class="string">&quot;other throwable&quot;</span>, e);</span><br><span class="line"></span><br><span class="line">      ctx.status(<span class="number">500</span>);</span><br><span class="line">      ctx.outputAsJson(Ret.fail(<span class="string">&quot;服务器错误，请重试&quot;</span>).toJson());</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">// 文件清理放此处也算合理，异常时需要清理和尝试恢复</span></span><br><span class="line">      <span class="keyword">if</span> (ctx.isMultipartFormData()) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          ctx.filesDelete();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">          log.error(<span class="string">&quot;clean temp file exception&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AppDeptController"><a href="#AppDeptController" class="headerlink" title="AppDeptController"></a>AppDeptController</h4><p>这里的 Controller 去除了 @Controller 的注解和 @Mapping 的注解，使用的是 @Component 的注解，并设置了appApi的标签，以便 AdminGateway 能进行批量的添加。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.manage.controller.app;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.manage.dto.DeptDto;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.manage.service.DeptService;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component(tag = &quot;appApi&quot;)</span></span><br><span class="line"><span class="meta">@Api(&quot;App 端部门服务&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppDeptController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> DeptService service;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(value = &quot;listWithException&quot;)</span></span><br><span class="line">  <span class="meta">@Get</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;获取列表但返回异常&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;DeptDto&gt; <span class="title">listWithException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service.listWithException();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(value = &quot;list&quot;)</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;获取列表&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;DeptDto&gt; <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service.list();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(&quot;/index&quot;)</span></span><br><span class="line">  <span class="meta">@Get</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;浏览部门&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">index</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">    mv.put(<span class="string">&quot;depts&quot;</span>, service.list());</span><br><span class="line">    mv.view(<span class="string">&quot;dept.shtm&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mv;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><h4 id="管理端接口请求"><a href="#管理端接口请求" class="headerlink" title="管理端接口请求"></a>管理端接口请求</h4><p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=OTU1ZDJjNzA1Nzg4NGE4NjVmMTI4MzZkMzZmNjdhOGJfdVRtSHBxVVJ4Q1Vhc0NWaHV5bXNTQ1V3bkM0Vzk2azlfVG9rZW46R2NLWmJDaVhyb1p1RkJ4WFlrSWNvNFQ3bmJiXzE3Mzk2MjI2Njg6MTczOTYyNjI2OF9WNA" alt="img"></p>
<h4 id="应用端接口请求"><a href="#应用端接口请求" class="headerlink" title="应用端接口请求"></a>应用端接口请求</h4><p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjdmYzFhMmRlYTNjNDRmMTM0OWY0MzBkZmEzYjI1ZmJfV0VZQ1QxTmtKUWRaUk1sYWRZekVnbjRoTkVQT3VLZ1BfVG9rZW46TDIzOGJJcXdob1JocXl4ZXo5UGNVODJPbnJlXzE3Mzk2MjI2Njg6MTczOTYyNjI2OF9WNA" alt="img"></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>本章通过本地网关对路由分组注册的方式演示了统一的异常处理和鉴权的逻辑，其实 Gateway 还能进一步的定制，可以参考官网的文档 <a target="_blank" rel="noopener" href="https://solon.noear.org/article/214">https://solon.noear.org/article/214</a> 。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2025/02/14/course100/022/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/14/course100/022/" class="post-title-link" itemprop="url">Web 开发 —— 进阶 事务和缓存</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-02-14 22:44:04 / 修改时间：22:53:47" itemprop="dateCreated datePublished" datetime="2025-02-14T22:44:04+08:00">2025-02-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/" itemprop="url" rel="index"><span itemprop="name">教程100</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">写作</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/" itemprop="url" rel="index"><span itemprop="name">Solon</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/Solon-%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Solon 实用教程</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>9 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>在数据操作的章节中，我们只是讲解了对关系数据库和非关系数据库的简单的数据操作，在实际的业务当中，操作会更加复杂，因此不可避免的会涉及到数据库的事务和数据的缓存。</p>
<p>Solon 通过 Solon data 提供事务的管理和基础的缓存框架，具体的缓存实现还是通过插件的方式来实现的。</p>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><p>Solon 的事务是通过 AOP 的方式实现的，因此在同一个类中的两个方法的调用，事务传播机制是不会生效的。</p>
<p>Solon 通过 Tran 注解来标记事务，主要有 policy （事务传导策略）和 isolation（事务隔离级别）</p>
<h3 id="事务传导策略"><a href="#事务传导策略" class="headerlink" title="事务传导策略"></a>事务传导策略</h3><table>
<thead>
<tr>
<th>传番策略</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>TranPolicy.required</td>
<td>支持当前事务，如果没有则创建一个新的。这是最常见的选择。也是默认。</td>
</tr>
<tr>
<td>TranPolicy.requires_new</td>
<td>新建事务，如果当前存在事务，把当前事务挂起。</td>
</tr>
<tr>
<td>TranPolicy.nested</td>
<td>如果当前有事务，则在当前事务内部嵌套一个事务；否则新建事务。</td>
</tr>
<tr>
<td>TranPolicy.mandatory</td>
<td>支持当前事务，如果没有事务则报错。</td>
</tr>
<tr>
<td>TranPolicy.supports</td>
<td>支持当前事务，如果没有则不使用事务。</td>
</tr>
<tr>
<td>TranPolicy.not_supported</td>
<td>以无事务的方式执行，如果当前有事务则将其挂起。</td>
</tr>
<tr>
<td>TranPolicy.never</td>
<td>以无事务的方式执行，如果当前有事务则报错。</td>
</tr>
</tbody></table>
<h3 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h3><table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>TranIsolation.unspecified</td>
<td>默认（JDBC默认）</td>
</tr>
<tr>
<td>TranIsolation.read_uncommitted</td>
<td>脏读：其它事务，可读取未提交数据</td>
</tr>
<tr>
<td>TranIsolation.read_committed</td>
<td>只读取提交数据：其它事务，只能读取已提交数据</td>
</tr>
<tr>
<td>TranIsolation.repeatable_read</td>
<td>可重复读：保证在同一个事务中多次读取同样数据的结果是一样的</td>
</tr>
<tr>
<td>TranIsolation.serializable</td>
<td>可串行化读：要求事务串行化执行，事务只能一个接着一个执行，不能并发执行</td>
</tr>
</tbody></table>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>虽然 Solon 支持手动的方式提供对事务的操作，但用注解的方式已经足够用，所以这里就不讲解手动使用的方式。如果需要可以查看官网文档 <a target="_blank" rel="noopener" href="https://solon.noear.org/article/299">https://solon.noear.org/article/299</a> 。官网也提供了事务的监听器，可能针对性的对事务的事件做些附加的处理。</p>
<p>基于 Web02 增加用户表（主表）和用户部门表（子表）来演示事务的三个常见：</p>
<ol>
<li>回滚，无论添加主表方法异常，还是添加子表方法异常。在这个例子业务数据正常。</li>
<li>只回滚父事务，但不回滚子事务。也就是主表不会添加数据，子表会添加数据。在这个例子中表现为业务数据异常。</li>
<li>只回滚子事务，但不回滚父事务。也就是子表不会添加数据，父表会添加数据。在这个例子中表现为业务数据异常。</li>
</ol>
<p>为了方便说明和查看方便，不同的回滚场景提供的代码会做删减，请注意到仓库获取完整代码。</p>
<h4 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `demo_user` (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `nick_name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;昵称&#x27;</span>,</span><br><span class="line">  `user_name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">  `create_at` datetime <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `update_at` datetime <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> UPDATE <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  `creator` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">  `updater` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;更新人&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci COMMENT<span class="operator">=</span><span class="string">&#x27;用户表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `demo_user_dept` (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `user_id` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户id&#x27;</span>,</span><br><span class="line">  `dept_id` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;部门id&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci;</span><br></pre></td></tr></table></figure>

<h4 id="回滚主子表"><a href="#回滚主子表" class="headerlink" title="回滚主子表"></a>回滚主子表</h4><p>回滚主子表的时候，可能出现两种情况，一种是子表方法出现错误，一种是主表方法出现问题。</p>
<h5 id="UserController"><a href="#UserController" class="headerlink" title="UserController"></a>UserController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Mapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="meta">@Api(&quot;用户管理&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> UserService service;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(&quot;rollbackAll&quot;)</span></span><br><span class="line">  <span class="meta">@Post</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;回滚全部&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">rollbackAll</span><span class="params">(<span class="meta">@Body</span> UserDto userDto)</span> </span>&#123;</span><br><span class="line">    service.rollbackAll(userDto);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(&quot;rollbackAll1&quot;)</span></span><br><span class="line">  <span class="meta">@Post</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;回滚全部1&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">rollbackAll1</span><span class="params">(<span class="meta">@Body</span> UserDto userDto)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service.rollbackAll1(userDto);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="UserService"><a href="#UserService" class="headerlink" title="UserService"></a>UserService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Db(&quot;db1&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> EasyEntityQuery entityQuery;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> UserDeptService userDeptService;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Tran</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rollbackAll</span><span class="params">(UserDto userDto)</span> </span>&#123;</span><br><span class="line">    UserEntity user = UserConvert.INSTANCE.convert(userDto);</span><br><span class="line"></span><br><span class="line">    entityQuery.insertable(user).executeRows(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    UserDeptDto userDeptDto = <span class="keyword">new</span> UserDeptDto();</span><br><span class="line">    userDeptDto.setUserId(user.getId());</span><br><span class="line">    userDeptDto.setDeptId(userDto.getDeptId());</span><br><span class="line">    <span class="comment">// 子表方法异常</span></span><br><span class="line">    userDeptService.rollbackUserDept(userDeptDto);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Tran</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">rollbackAll1</span><span class="params">(UserDto userDto)</span> </span>&#123;</span><br><span class="line">    UserEntity user = UserConvert.INSTANCE.convert(userDto);</span><br><span class="line"></span><br><span class="line">    entityQuery.insertable(user).executeRows(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    UserDeptDto userDeptDto = <span class="keyword">new</span> UserDeptDto();</span><br><span class="line">    userDeptDto.setUserId(user.getId());</span><br><span class="line">    userDeptDto.setDeptId(userDto.getDeptId());</span><br><span class="line">    userDeptService.addUserDept(userDeptDto);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 主表方法异常</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;不能添加主表&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="UserDeptService"><a href="#UserDeptService" class="headerlink" title="UserDeptService"></a>UserDeptService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDeptService</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Db(&quot;db1&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> EasyEntityQuery entityQuery;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Tran</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addUserDept</span><span class="params">(UserDeptDto userDeptDto)</span> </span>&#123;</span><br><span class="line">    UserDeptEntity userDept = UserDeptConvert.INSTANCE.convert(userDeptDto);</span><br><span class="line">    entityQuery.insertable(userDept).executeRows(<span class="keyword">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Tran</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">rollbackUserDept</span><span class="params">(UserDeptDto userDeptDto)</span> </span>&#123;</span><br><span class="line">    UserDeptEntity userDept = UserDeptConvert.INSTANCE.convert(userDeptDto);</span><br><span class="line">    entityQuery.insertable(userDept).executeRows(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;不能添加子表&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h5><p>这里就不截图了，可以从日志和看数据库数据，可以看到 user 表和 user_dept 表都不会增加数据。</p>
<h4 id="只回滚主表，但不回滚子表"><a href="#只回滚主表，但不回滚子表" class="headerlink" title="只回滚主表，但不回滚子表"></a>只回滚主表，但不回滚子表</h4><h5 id="UserController-1"><a href="#UserController-1" class="headerlink" title="UserController"></a>UserController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Mapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="meta">@Api(&quot;用户管理&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> UserService service;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(&quot;rollbackMaster&quot;)</span></span><br><span class="line">  <span class="meta">@Post</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;回滚主表&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">rollbackMaster</span><span class="params">(<span class="meta">@Body</span> UserDto userDto)</span> </span>&#123;</span><br><span class="line">    service.rollbackMaster(userDto);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="UserService-1"><a href="#UserService-1" class="headerlink" title="UserService"></a>UserService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Db(&quot;db1&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> EasyEntityQuery entityQuery;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> UserDeptService userDeptService;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Tran</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rollbackMaster</span><span class="params">(UserDto userDto)</span> </span>&#123;</span><br><span class="line">    UserEntity user = UserConvert.INSTANCE.convert(userDto);</span><br><span class="line"></span><br><span class="line">    entityQuery.insertable(user).executeRows(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    UserDeptDto userDeptDto = <span class="keyword">new</span> UserDeptDto();</span><br><span class="line">    userDeptDto.setUserId(user.getId());</span><br><span class="line">    userDeptDto.setDeptId(userDto.getDeptId());</span><br><span class="line"></span><br><span class="line">    userDeptService.addUserDept1(userDeptDto);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;不能添加主表&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="UserDeptService-1"><a href="#UserDeptService-1" class="headerlink" title="UserDeptService"></a>UserDeptService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDeptService</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Db(&quot;db1&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> EasyEntityQuery entityQuery;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Tran(policy = TranPolicy.requires_new)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addUserDept1</span><span class="params">(UserDeptDto userDeptDto)</span> </span>&#123;</span><br><span class="line">    UserDeptEntity userDept = UserDeptConvert.INSTANCE.convert(userDeptDto);</span><br><span class="line">    entityQuery.insertable(userDept).executeRows(<span class="keyword">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="效果-1"><a href="#效果-1" class="headerlink" title="效果"></a>效果</h5><p>这里就不截图了，可以从日志和看数据库数据，可以看到 user 表不会增加数据，但 user_dept 表会增加数据。</p>
<h4 id="只回滚子表，但不回滚主表"><a href="#只回滚子表，但不回滚主表" class="headerlink" title="只回滚子表，但不回滚主表"></a>只回滚子表，但不回滚主表</h4><h5 id="UserController-2"><a href="#UserController-2" class="headerlink" title="UserController"></a>UserController</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Mapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="meta">@Api(&quot;用户管理&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> UserService service;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(&quot;rollbackSub&quot;)</span></span><br><span class="line">  <span class="meta">@Post</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;回滚子表&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">rollbackSub</span><span class="params">(<span class="meta">@Body</span> UserDto userDto)</span> </span>&#123;</span><br><span class="line">    service.rollbackSub(userDto);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="UserService-2"><a href="#UserService-2" class="headerlink" title="UserService"></a>UserService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Db(&quot;db1&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> EasyEntityQuery entityQuery;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> UserDeptService userDeptService;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Tran</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rollbackSub</span><span class="params">(UserDto userDto)</span> </span>&#123;</span><br><span class="line">    UserEntity user = UserConvert.INSTANCE.convert(userDto);</span><br><span class="line"></span><br><span class="line">    entityQuery.insertable(user).executeRows(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    UserDeptDto userDeptDto = <span class="keyword">new</span> UserDeptDto();</span><br><span class="line">    userDeptDto.setUserId(user.getId());</span><br><span class="line">    userDeptDto.setDeptId(userDto.getDeptId());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      userDeptService.rollbackUserDept1(userDeptDto);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ignore) &#123;</span><br><span class="line">      <span class="comment">// 忽略子表的异常</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="UserDeptService-2"><a href="#UserDeptService-2" class="headerlink" title="UserDeptService"></a>UserDeptService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDeptService</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Db(&quot;db1&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> EasyEntityQuery entityQuery;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Tran(policy = TranPolicy.nested)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">rollbackUserDept1</span><span class="params">(UserDeptDto userDeptDto)</span> </span>&#123;</span><br><span class="line">    UserDeptEntity userDept = UserDeptConvert.INSTANCE.convert(userDeptDto);</span><br><span class="line">    entityQuery.insertable(userDept).executeRows(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;不能添加子表&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="效果-2"><a href="#效果-2" class="headerlink" title="效果"></a>效果</h5><p>这里就不截图了，可以从日志和看数据库数据，可以看到 user 表会添加数据，但 user_dept 表不会添加数据。</p>
<h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><p>Solon 通过 solon-data 插件提供缓存的基础框架，然后通过不同的缓存插件实现具体的缓存逻辑，使得应用层可以快速的切换缓存的存储或者实现多级缓存。</p>
<p>Solon 的缓存框架使用 key（唯一标识） 和 tags（标签）两个维度来管理缓存。</p>
<ul>
<li>key ：缓存唯一标识，没有指定时会自动生成。无论自己指定还是自动生成都需要注意避免 key 重复。</li>
<li>tags：缓存标签，可以用于标签的批量操作，通常为批量删除。</li>
</ul>
<h3 id="注解说明"><a href="#注解说明" class="headerlink" title="注解说明"></a>注解说明</h3><p>@Cache 注解：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>service()</td>
<td>缓存服务</td>
</tr>
<tr>
<td>seconds()</td>
<td>缓存时间</td>
</tr>
<tr>
<td>key()</td>
<td>缓存唯一标识，支持字符串模版</td>
</tr>
<tr>
<td>tags()</td>
<td>缓存标签，多个以逗号隔开（为当前缓存块添加标签，用于清除）</td>
</tr>
</tbody></table>
<p>@CachePut 注解：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>service()</td>
<td>缓存服务</td>
</tr>
<tr>
<td>seconds()</td>
<td>缓存时间</td>
</tr>
<tr>
<td>key()</td>
<td>缓存唯一标识，支持字符串模版</td>
</tr>
<tr>
<td>tags()</td>
<td>缓存标签，多个以逗号隔开（为当前缓存块添加标签，用于清除）</td>
</tr>
</tbody></table>
<p>@CacheRemove 注解：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>service()</td>
<td>缓存服务</td>
</tr>
<tr>
<td>keys()</td>
<td>缓存唯一标识，多个以逗号隔开，支持字符串模版</td>
</tr>
<tr>
<td>tags()</td>
<td>缓存标签，多个以逗号隔开（方便清除一批key）</td>
</tr>
</tbody></table>
<h3 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h3><p>我们继续通过部门管理的例子来演示数据的缓存。</p>
<h4 id="RedisConfig"><a href="#RedisConfig" class="headerlink" title="RedisConfig"></a>RedisConfig</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Bean(typed = true)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> CacheService <span class="title">defaultCache</span><span class="params">(<span class="meta">@Inject</span> RedisClient redisClient)</span> </span>&#123;</span><br><span class="line">    RedisCacheService cacheService = <span class="keyword">new</span> RedisCacheService(redisClient, <span class="number">30</span>);</span><br><span class="line">    cacheService.enableMd5key(<span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">return</span> cacheService;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean(typed = true)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> RedisClient <span class="title">defaultClient</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">      <span class="meta">@Inject(&quot;$&#123;demo.redis&#125;&quot;)</span> RedisClientSupplier redisClientSupplier)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> redisClientSupplier.get();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="DeptDto"><a href="#DeptDto" class="headerlink" title="DeptDto"></a>DeptDto</h4><p>需要实现 Serializable 这样才能给缓存序列化。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiModel</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptDto</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 部门名称 */</span></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 部门编码 */</span></span><br><span class="line">  <span class="keyword">private</span> String code;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="DeptService"><a href="#DeptService" class="headerlink" title="DeptService"></a>DeptService</h4><p>保存、更新、删除的时候通过tags清理缓存，获取id和list的时候通过key增加缓存，同时增加tags标签。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptService</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Db(&quot;db1&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> EasyEntityQuery entityQuery;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@CachePut(key = &quot;dept:list&quot;, tags = &quot;dept&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;DeptDto&gt; <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;search list from db&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> entityQuery.queryable(DeptEntity.class).select(DeptDto.class).toList();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@CacheRemove(tags = &quot;dept&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">add</span><span class="params">(DeptDto deptDto)</span> </span>&#123;</span><br><span class="line">    DeptEntity dept = DeptConvert.INSTANCE.convert(deptDto);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> entityQuery.insertable(dept).executeRows(<span class="keyword">true</span>) &gt; <span class="number">0L</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@CacheRemove(tags = &quot;dept&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">update</span><span class="params">(DeptDto deptDto)</span> </span>&#123;</span><br><span class="line">    DeptEntity dept = DeptConvert.INSTANCE.convert(deptDto);</span><br><span class="line">    <span class="keyword">return</span> entityQuery.updatable(dept).executeRows() &gt; <span class="number">0L</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@CachePut(key = &quot;dept:$&#123;id&#125;&quot;, tags = &quot;dept&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> DeptDto <span class="title">get</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;search from db by id&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> entityQuery</span><br><span class="line">        .queryable(DeptEntity.class)</span><br><span class="line">        .whereById(id)</span><br><span class="line">        .select(DeptDto.class)</span><br><span class="line">        .firstOrNull();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@CacheRemove(tags = &quot;dept&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">delete</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> entityQuery</span><br><span class="line">            .getEasyQueryClient()</span><br><span class="line">            .deletable(DeptEntity.class)</span><br><span class="line">            .allowDeleteStatement(<span class="keyword">true</span>)</span><br><span class="line">            .whereById(id)</span><br><span class="line">            .executeRows()</span><br><span class="line">        &gt; <span class="number">0L</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="效果-3"><a href="#效果-3" class="headerlink" title="效果"></a>效果</h4><p>调用 list 或 get 接口时缓存，如果存在缓存时不再从数据库中获取数据。</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=M2Y1NDEwYmMwMDlkMTNkMTk1MDVhYTIyOWE5MTgwMTlfTVJDNkQwYWpLdXpXTVM4ekhVRWpxenJRMXhiczVkS3NfVG9rZW46QzVCZWJYV1RNb3Q2OUd4a01MVGNyY0pHblMzXzE3Mzk1NDQzNjE6MTczOTU0Nzk2MV9WNA" alt="img"></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>要在 Solon 应用中使用事务和缓存是比较容易的，增加对应的注解即可实现相关的功能。有了事务和缓存的支持，数据的可靠性和应用的性能可以进一步得到保障，通过以上内容的学习，基本上可以起飞，做业务开发了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2025/02/13/course100/021/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/13/course100/021/" class="post-title-link" itemprop="url">Web 开发 —— 进阶</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-02-13 19:50:30" itemprop="dateCreated datePublished" datetime="2025-02-13T19:50:30+08:00">2025-02-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-02-14 22:45:40" itemprop="dateModified" datetime="2025-02-14T22:45:40+08:00">2025-02-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/" itemprop="url" rel="index"><span itemprop="name">教程100</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">写作</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/" itemprop="url" rel="index"><span itemprop="name">Solon</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/Solon-%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Solon 实用教程</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>在基础篇当中，我们讲究了 Solon 对 MVC 的支持和提供的基础的Web 能力。在这个章节我们会讲解 Solon 提供了哪些能力可以供我们进行控制。</p>
<p>首先我们来看看 Solon Web  的请求过程，理解 Solon 的基础概念，这样方便我们后续的定制。</p>
<h2 id="请求过程"><a href="#请求过程" class="headerlink" title="请求过程"></a>请求过程</h2><p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjcyZDQ3ZDA2NWI4YTMxN2ZiOWQ0YzRlMWI0Y2M3MDFfOTZtdkFYRDJlaGNQZElYN0hWNWVUU3ZFTVVFTnA3Q1VfVG9rZW46SjJQQ2JzQzNZb2MxYlR4Rm1KcmNmSlY4blplXzE3Mzk0NDc1MTA6MTczOTQ1MTExMF9WNA" alt="img"></p>
<p>从图中，我们可以看到在Web 的请求过程中，会经过几个环节：Filter（全局过滤器）-&gt;</p>
<p>RouterInterCeptor（路由拦截器）-&gt; Handler（处理器）-&gt; Interceptor（拦截器）。</p>
<h3 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h3><p>Solon 采用 Handler + Context 架构，Context 是请求的上下文。 在 Context 中可以获取请求和响应相关的数据，包括请求相关的对象与接口，会话相关的对象与接口，响应相关的对象与接口等。Solon 提供了多种方式获取Context，也为Context 其他了一些常用的接口，更详细的内容可以查看 <a target="_blank" rel="noopener" href="https://solon.noear.org/article/216">https://solon.noear.org/article/216</a> 。</p>
<h3 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h3><p>过滤器，可以对所有请求（无论动态还是静态的请求）进行全局的控制。通常用于全局的 Web 请求异常处理，全局的性能记录，全局的响应状态调整，全局的上下文日志记录，全局的链路跟踪等等，当然也可以作用在局部上。</p>
<h3 id="RouterInterceptor"><a href="#RouterInterceptor" class="headerlink" title="RouterInterceptor"></a>RouterInterceptor</h3><p>路由拦截器，可以对动态请求进行全局的控制，功能基本与 Filter 一致。主要的区别是：1. 只能对动态请求（路由器范围）进行拦截；2. 可以修改参数和返回结果。</p>
<h3 id="Interceptor"><a href="#Interceptor" class="headerlink" title="Interceptor"></a>Interceptor</h3><p>拦截器，拦截器使用切面（AOP）的方式实现，通过定义注解、设置切点、注册拦截器，Solon 将对方法进行拦截，从而增加拦截器方法的执行。拦截器可以用于实现缓存、事务等等功能。</p>
<h3 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h3><p>实际的请求方法，注册到路由器的方法（通常是<code>@Mapping</code> 函数，可以通过 Controller 的方式定义，也可以通过 Handler 的方式定义，等等）。Action 本质上是 Handler 和 Class Method 的结合，可以请求方法进行局部的控制。</p>
<h2 id="示例-demo-web02"><a href="#示例-demo-web02" class="headerlink" title="示例 demo-web02"></a>示例 demo-web02</h2><p>在 IDEA 中通过 <code>File-&gt;New-&gt;Modules...</code> 可以创建新的模块 <code>demo-web02</code>，基础代码和配置可以从<code>demo-web01</code>中拷贝过来。</p>
<p>这里我们继续补充<code>demo-web01</code> ，增加定制化的处理。</p>
<ul>
<li>增加简单的鉴权用于演示的Filter。</li>
<li>增加RouterInterceptor，用于演示Filter和RouterInterceptor的区别。 </li>
<li>增加日志审计的功能用于演示 Interceptor 拦截器。</li>
</ul>
<h3 id="全局过滤器"><a href="#全局过滤器" class="headerlink" title="全局过滤器"></a>全局过滤器</h3><p>使用全局的Filter做简单的 token 验证。这里需要指定<code>Component</code>的注解，也就是统一有Solon 来管理。如果有多个过滤器是可以指定<code>Component</code>的 index 参数，参数越小，越外层，可以理解为优先级越高。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.common.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jfinal.kit.Kv;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.dromara.hutool.core.text.StrUtil;</span><br><span class="line"><span class="keyword">import</span> org.noear.snack.ONode;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Component;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.Context;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.Filter;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.FilterChain;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(Context ctx, FilterChain chain)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    String path = ctx.path();</span><br><span class="line">    log.info(<span class="string">&quot;1. GlobalFilter, path: &#123;&#125;&quot;</span>, path);</span><br><span class="line">    <span class="comment">// 简单逻辑，非静态的路径都需要token</span></span><br><span class="line">    <span class="keyword">if</span> (!path.contains(<span class="string">&quot;.&quot;</span>)) &#123;</span><br><span class="line">      String token = ctx.param(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (StrUtil.isBlank(token)) &#123;</span><br><span class="line">        ctx.outputAsJson(ONode.stringify(Kv.of(<span class="string">&quot;state&quot;</span>, <span class="keyword">false</span>)));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    chain.doFilter(ctx);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="路由拦截器"><a href="#路由拦截器" class="headerlink" title="路由拦截器"></a>路由拦截器</h3><p>这边只是为了对比和Filter的不同，如果是静态资源请求时，不会进入路由拦截器，也就不会打印对应的日志。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.common.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Component;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.Context;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.Handler;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.route.RouterInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.route.RouterInterceptorChain;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoRouteInterceptor</span> <span class="keyword">implements</span> <span class="title">RouterInterceptor</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doIntercept</span><span class="params">(Context ctx, Handler mainHandler, RouterInterceptorChain chain)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    String path = ctx.path();</span><br><span class="line">    log.info(<span class="string">&quot;2. DemoRouteInterceptor, path: &#123;&#125;&quot;</span>, path);</span><br><span class="line"></span><br><span class="line">    chain.doIntercept(ctx, mainHandler);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="局部过滤器"><a href="#局部过滤器" class="headerlink" title="局部过滤器"></a>局部过滤器</h3><p>局部过滤器可以通过 Addition 注解直接使用，可以通过注解继承的方式使用。</p>
<h4 id="WhitelistFilter"><a href="#WhitelistFilter" class="headerlink" title="WhitelistFilter"></a>WhitelistFilter</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.common.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.Context;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.Filter;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.FilterChain;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WhitelistFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(Context ctx, FilterChain chain)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    String path = ctx.path();</span><br><span class="line">    log.info(<span class="string">&quot;3. WhitelistFilter, path: &#123;&#125;&quot;</span>, path);</span><br><span class="line">    chain.doFilter(ctx);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Whitelist"><a href="#Whitelist" class="headerlink" title="Whitelist"></a>Whitelist</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.common.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.common.filter.WhitelistFilter;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Addition;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Addition(WhitelistFilter.class)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Whitelist &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h3><p>拦截器可以通过 Around 注解直接使用，可以通过注解继承的方式使用。</p>
<h4 id="LogInterceptor"><a href="#LogInterceptor" class="headerlink" title="LogInterceptor"></a>LogInterceptor</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.common.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.aspect.Interceptor;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.aspect.Invocation;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.Context;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">doIntercept</span><span class="params">(Invocation inv)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    Context context = Context.current();</span><br><span class="line">    String path = context.path();</span><br><span class="line">    log.info(<span class="string">&quot;4. LogInterceptor, path: &#123;&#125;&quot;</span>, path);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inv.invoke();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="OperateLog"><a href="#OperateLog" class="headerlink" title="OperateLog"></a>OperateLog</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.common.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.common.interceptor.LogInterceptor;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Around;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Around(LogInterceptor.class)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> OperateLog &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Controller的调整"><a href="#Controller的调整" class="headerlink" title="Controller的调整"></a>Controller的调整</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.manage.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.common.annotation.OperateLog;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.common.annotation.Whitelist;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.common.filter.WhitelistFilter;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.common.interceptor.LogInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.manage.dto.DeptDto;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.manage.service.DeptService;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.Context;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.UploadedFile;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Mapping(&quot;/dept&quot;)</span></span><br><span class="line"><span class="meta">@Api(&quot;部门管理&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> DeptService service;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(&quot;/index&quot;)</span></span><br><span class="line">  <span class="meta">@Get</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;浏览部门&quot;)</span></span><br><span class="line">  <span class="meta">@OperateLog</span></span><br><span class="line">  <span class="meta">@Whitelist</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">index</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">    mv.put(<span class="string">&quot;depts&quot;</span>, service.list());</span><br><span class="line">    mv.view(<span class="string">&quot;dept.shtm&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mv;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(value = &quot;list&quot;)</span></span><br><span class="line">  <span class="meta">@Get</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;获取列表&quot;)</span></span><br><span class="line">  <span class="meta">@Around(LogInterceptor.class)</span></span><br><span class="line">  <span class="meta">@Addition(WhitelistFilter.class)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;DeptDto&gt; <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service.list();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><ul>
<li>请求 /dept/index，不带token得情况，演示全局的过滤器效果</li>
</ul>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=NmM0YjNjMGEyMzlkOTc4Njc4YjlmYWY2ZDhhZjcxYjlfYjNVcG5aelVBWVF4SDNxRXF0dFJVNUxZdUVScDNBdWpfVG9rZW46Tkw3NGJqNHhTb3p3SWt4WXFlOWNCVmJPbkpnXzE3Mzk0NDc1MTA6MTczOTQ1MTExMF9WNA" alt="img"></p>
<ul>
<li>请求 /dept/list?tokent=1，带token得情况，验证请求过程，使用的是 Addition 和 Around 的方式添加局部过滤器和拦截器。</li>
</ul>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=YmZmMDk1NjlhMTI0MWZlODg5MDY4ZTk1ZjU2ZDhjMTNfOEZ4cndDd1QxVjBqWlNkazBYVlhuQm91cHdoSDltYlJfVG9rZW46WVRtcmJuMVdrbzBnSTd4NjFSYWNaTDRTbkJmXzE3Mzk0NDc1MTA6MTczOTQ1MTExMF9WNA" alt="img"></p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=N2I2N2I0N2FmN2JiN2Q0ZTU3NmEwMDE2YmZlOWQ3N2Rfdk1Dd2FpNU9tUU5ZQWdmWmE2eEZYcUZRT0RjeE5jekpfVG9rZW46Ulp1SmI3b29Ub0pqUXJ4T21hNWN6SE1IbkhlXzE3Mzk0NDc1MTA6MTczOTQ1MTExMF9WNA" alt="img"></p>
<ul>
<li>请求 /dept/index?tokent=1，带token得情况，验证请求过程，使用注解继承的方式添加局部过滤器和拦截器。</li>
</ul>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=NTNjOWY5M2RlNTYyMWQxNmIxMDhkYmE2ZTlhMWEyYmFfRTZPUFphZWZ1ZnMxT1JiZ056dDQ2VG1Wc3oyVnlLUHFfVG9rZW46U1VqSmIxSlNsbzNtaTJ4YVZ3NGNGeHhNbkNiXzE3Mzk0NDc1MTA6MTczOTQ1MTExMF9WNA" alt="img"></p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=MWE1YTRlNjY5OWRhZmFhZmRkNzNhOGYxNGU1ZjQwMjBfeGlIYjFZMG1YTVhpRU5IYkpLV0RkQ2s4czNlaHZGTXdfVG9rZW46WmZRY2JPTDJpb09RSGV4UkY3N2M1aWZybmRmXzE3Mzk0NDc1MTA6MTczOTQ1MTExMF9WNA" alt="img"></p>
<ul>
<li>请求 /img/wechat.png，验证静态请求不会通过RouterInterceptor。如果静态资源不存在的情况，依然会继续查找动态路由，此时会进入RouterInterceptor。</li>
</ul>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDI4NjE3MWQxOTllOWFiYTk4NDNjZDQ0NWZlMGExZjdfT2xUb242Z1VHNkhWaGsxVjAyZjVlNnJEdlEyM213NHdfVG9rZW46UnpTQWJKTG5Vb0tHVlh4ZlRsbGNXN3VYbkpjXzE3Mzk0NDc1MTA6MTczOTQ1MTExMF9WNA" alt="img"></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>本章节通过示意图的方式简单描述Solon web的请求过程，并对其中的重要概念做了讲解，通过实例的方式正式了对过滤器，路由拦截器和拦截器的定制。</p>
<p>官网对这些内容做了多篇文章的介绍，可以通过官网进一步的了解这些概念和使用方法。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2025/02/11/course100/020/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/11/course100/020/" class="post-title-link" itemprop="url">Web 开发 —— 基础</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-02-11 20:38:28 / 修改时间：20:46:39" itemprop="dateCreated datePublished" datetime="2025-02-11T20:38:28+08:00">2025-02-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/" itemprop="url" rel="index"><span itemprop="name">教程100</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">写作</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/" itemprop="url" rel="index"><span itemprop="name">Solon</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/Solon-%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Solon 实用教程</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>7.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>7 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>Web 基础主要讲解 Solon 对 Web 开发提供的基础能力，支持 HTML 文档和其他静态资源的获取，提供数据交换的能力。</p>
<h3 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h3><p>Web 开发中最常使用的 MVC 架构，MVC 全称是 “模型 (Model)- 视图 (View)- 控制器 (Controller)”，是一种广泛使用的设计模式，用于将应用程序的逻辑、数据和界面进行分离。</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=MGE5NzFiYTQ3NjczYWRkMjkzNDVjMjNmMzgxZjE4ZDZfZWp4MFVHa0JmWW5SWmtaT2duRUpyMGFUWWdYNWdUN05fVG9rZW46UEtEa2JkNWh4b1dLT014b29TWWNMYkRhbnBxXzE3MzkyNzc1NzI6MTczOTI4MTE3Ml9WNA" alt="img"></p>
<p>在具体对 MVC 的划分中可能存在一些边界的不同，有的人认为 Modle是输入，View 是输出，Controller是处理；有的人认为 Model 是数据，View 是数据的展示与用户的交互，Controller是处理，包含了输入和输出；有的人认为 Model 就是模型，即数据+接口，View 是模型的裁剪，Controller 是数据交互。随着前后端分离的架构的发展，前端也有自己的MVC 的结构，这个时候后端的接口的就成了 Model 层。根据自己对 MVC 的实际理解去用就好了，适合自己就好。</p>
<p>在 Solon 中可以这样理解：solon-data 对应处理 Model 层，提供数据处理、事务、缓存等支持；solon-core/solon-boot 对应处理 Controller 层，提供 Handler + Context 操作接口，提供Http信号接入支持；solon-view 对应处理 View 层（单体结构），提供不同的模板渲染框架，solon-serialization 对应处理 View 层（前后端分离结构），提供JSON、XML、PROTOSTUFF 等不同格式的序列化。</p>
<h3 id="常用注解"><a href="#常用注解" class="headerlink" title="常用注解"></a>常用注解</h3><table>
<thead>
<tr>
<th>@Controller</th>
<th>控制器注解（只有一个注解，会自动通过不同的返回值做不同的处理）</th>
</tr>
</thead>
<tbody><tr>
<td>@Param</td>
<td>注入请求参数（包括：QueryString、Form、Path）。起到指定名字、默认值等作用</td>
</tr>
<tr>
<td>@Header</td>
<td>注入请求 header</td>
</tr>
<tr>
<td>@Cookie</td>
<td>注入请求 cookie</td>
</tr>
<tr>
<td>@Path</td>
<td>注入请求 path 变量（因为框架会自动处理，所以这个只是标识下方便文档生成用）</td>
</tr>
<tr>
<td>@Body</td>
<td>注入请求体（一般会自动处理。仅在主体的 String, Steam, Map 时才需要）</td>
</tr>
<tr>
<td>@Mapping</td>
<td>路由关系映射注解</td>
</tr>
<tr>
<td>@Get</td>
<td>@Mapping 的辅助注解，便于 RESTful 开发</td>
</tr>
<tr>
<td>@Post</td>
<td>@Mapping 的辅助注解，便于 RESTful 开发</td>
</tr>
<tr>
<td>@Put</td>
<td>@Mapping 的辅助注解，便于 RESTful 开发</td>
</tr>
<tr>
<td>@Delete</td>
<td>@Mapping 的辅助注解，便于 RESTful 开发</td>
</tr>
<tr>
<td>@Patch</td>
<td>@Mapping 的辅助注解，便于 RESTful 开发</td>
</tr>
<tr>
<td>@Produces</td>
<td>输出内容类型申明</td>
</tr>
<tr>
<td>@Consumes</td>
<td>输入内容类型申明（当输出内容类型未包函 @Consumes，则响应为 415 状态码）</td>
</tr>
<tr>
<td>@Multipart</td>
<td>显式申明支持 Multipart 输入</td>
</tr>
</tbody></table>
<h3 id="参数注入"><a href="#参数注入" class="headerlink" title="参数注入"></a>参数注入</h3><p>关于 MVC 参数注入，主要尊守以下规则：</p>
<ul>
<li>参数名与请求数据名一一对应（使用 -parameters）。</li>
<li>当对映不上时，会采用整体数据注入（如果接收的是实体）</li>
<li>参数名与请求数据同名时，又想整体注入（如果接收的是实体），可使用 @Body 注解强制标注。</li>
</ul>
<h3 id="个人偏好"><a href="#个人偏好" class="headerlink" title="个人偏好"></a>个人偏好</h3><p>不同的 MVC 的理解，会有不一样的项目结构，下面是阿里巴巴《Java 开发手册（黄山版）》的截图，可供参考。 </p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=NDkxZTNhOTAzZmE3MjAwMjY4ODdjZjQ0ZTE0YjFjNzhfVE5OYjRMNFdybDUyZnlLcFppSkc5cFFCTjlVTzBWcnhfVG9rZW46RkVZTmI5Y2RJb3Q5SWZ4WlhrWmNYYXFqbldmXzE3MzkyNzc1NzI6MTczOTI4MTE3Ml9WNA" alt="img"></p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=MTE4YWJhOTQ0MjA4ZGZlZmNjODdjMDE3MTVjMWE2MDdfb3Y5MUxjMk9NM08yQVVScGVlMmpWVTlEaXpNdGZINDNfVG9rZW46TnIzMmIyMDVRb1B0WTl4VG8zaWNzZGJ2bk9FXzE3MzkyNzc1NzI6MTczOTI4MTE3Ml9WNA" alt="img"></p>
<p>以下属于个人偏好的目录结构，后续的示例会按这个方式处理。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">domain(业务领域)</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">controller(对应Contoller</span> <span class="string">层，提供用户交互接口)</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">admin（管理端接口）</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">app（应用端接）</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">dto</span> <span class="string">（对应</span> <span class="string">View</span> <span class="string">层的数据）</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">model（对应</span> <span class="string">Model</span> <span class="string">层的数据）</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">service（对应</span> <span class="string">Model</span> <span class="string">层的接口）</span></span><br></pre></td></tr></table></figure>

<p>进一步补充，在 controller 中我不会放业务逻辑，只是调用 service进行转发，这样能更大程度的复用Service；在service中通常不采用接口实现的分离方式（虽然这种方式更好，但在编写、查看代码的过程中跳转太多，而且对应业务来说，通常不会有多种实现，有多种实现的逻辑再进行接口实现分离的方式）；尽可能少的分层领域模型，避免过多的数据转换操作。</p>
<h2 id="demo-web01"><a href="#demo-web01" class="headerlink" title="demo-web01"></a>demo-web01</h2><p>在 IDEA 中通过 <code>File-&gt;New-&gt;Modules...</code> 可以创建新的模块 <code>demo-web01</code>，基础代码和配置可以从<code>demo-orm</code>中拷贝过来，或者自己手动创建，之后调整包名。</p>
<p>这里我们继续补充<code>demo-orm</code>的部门管理的例子。实现基本的增删改查（CURD）接口，实现数据的导入导出展示文件的上传与下载，实现 index 接口用于展示模版的渲染，同时在模版中访问静态资源。提供 list 展示 json 的序列化，提供 listXml 展示 XML 的序列化。</p>
<p>为了在接口中尽可能多的展示不同的参数注入的使用，接口的定义不会是完全的 RESTful 风格。</p>
<h3 id="修改依赖"><a href="#修改依赖" class="headerlink" title="修改依赖"></a>修改依赖</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    <span class="comment">// enjoy 模版渲染</span></span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-view-enjoy&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// xml 序列化</span></span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-serialization-jackson-xml&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// json 序列化，默认就是snack3 可以不配置</span></span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-serialization-snack3&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 静态资源访问</span></span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-web-staticfiles&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建model"><a href="#创建model" class="headerlink" title="创建model"></a>创建model</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.manage.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.easy.query.core.annotation.Column;</span><br><span class="line"><span class="keyword">import</span> com.easy.query.core.annotation.EntityProxy;</span><br><span class="line"><span class="keyword">import</span> com.easy.query.core.annotation.Table;</span><br><span class="line"><span class="keyword">import</span> com.easy.query.core.proxy.ProxyEntityAvailable;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.manage.model.proxy.DeptEntityProxy;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 部门表 实体类。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Airhead</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Table(value = &quot;demo_dept&quot;)</span></span><br><span class="line"><span class="meta">@EntityProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptEntity</span> <span class="keyword">implements</span> <span class="title">ProxyEntityAvailable</span>&lt;<span class="title">DeptEntity</span>, <span class="title">DeptEntityProxy</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** id */</span></span><br><span class="line">  <span class="meta">@Column(primaryKey = true, value = &quot;id&quot;, generatedKey = true)</span></span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 部门名称 */</span></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 部门编码 */</span></span><br><span class="line">  <span class="keyword">private</span> String code;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 时间时间 */</span></span><br><span class="line">  <span class="keyword">private</span> LocalDateTime createAt;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 更新时间 */</span></span><br><span class="line">  <span class="keyword">private</span> LocalDateTime updateAt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建service"><a href="#创建service" class="headerlink" title="创建service"></a>创建service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.manage.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.easy.query.api.proxy.client.EasyEntityQuery;</span><br><span class="line"><span class="keyword">import</span> com.easy.query.solon.annotation.Db;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.manage.convert.DeptConvert;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.manage.dto.DeptDto;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.manage.model.DeptEntity;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptService</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Db(&quot;db1&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> EasyEntityQuery entityQuery;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;DeptDto&gt; <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> entityQuery.queryable(DeptEntity.class).select(DeptDto.class).toList();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">add</span><span class="params">(DeptDto deptDto)</span> </span>&#123;</span><br><span class="line">    DeptEntity dept = DeptConvert.INSTANCE.convert(deptDto);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> entityQuery.insertable(dept).executeRows(<span class="keyword">true</span>) &gt; <span class="number">0L</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">update</span><span class="params">(DeptDto deptDto)</span> </span>&#123;</span><br><span class="line">    DeptEntity dept = DeptConvert.INSTANCE.convert(deptDto);</span><br><span class="line">    <span class="keyword">return</span> entityQuery.updatable(dept).executeRows() &gt; <span class="number">0L</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> DeptDto <span class="title">get</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> entityQuery</span><br><span class="line">        .queryable(DeptEntity.class)</span><br><span class="line">        .whereById(id)</span><br><span class="line">        .select(DeptDto.class)</span><br><span class="line">        .firstOrNull();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">delete</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> entityQuery</span><br><span class="line">            .getEasyQueryClient()</span><br><span class="line">            .deletable(DeptEntity.class)</span><br><span class="line">            .allowDeleteStatement(<span class="keyword">true</span>)</span><br><span class="line">            .whereById(id)</span><br><span class="line">            .executeRows()</span><br><span class="line">        &gt; <span class="number">0L</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建dto"><a href="#创建dto" class="headerlink" title="创建dto"></a>创建dto</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.manage.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptDto</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 部门名称 */</span></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 部门编码 */</span></span><br><span class="line">  <span class="keyword">private</span> String code;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建controller"><a href="#创建controller" class="headerlink" title="创建controller"></a>创建controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.manage.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.manage.dto.DeptDto;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.manage.service.DeptService;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.Context;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.ModelAndView;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.UploadedFile;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Mapping(&quot;/dept&quot;)</span></span><br><span class="line"><span class="meta">@Api(&quot;部门管理&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> DeptService service;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(value = &quot;list&quot;, produces = &quot;application/json&quot;)</span></span><br><span class="line">  <span class="meta">@Get</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;获取列表json&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;DeptDto&gt; <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service.list();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(value = &quot;listXml&quot;, produces = &quot;application/xml&quot;)</span></span><br><span class="line">  <span class="meta">@Get</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;获取列表Xml&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;DeptDto&gt; <span class="title">listXml</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service.list();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping</span></span><br><span class="line">  <span class="meta">@Post</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;新增&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">add</span><span class="params">(<span class="meta">@Body</span> DeptDto deptDto)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service.add(deptDto);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping</span></span><br><span class="line">  <span class="meta">@Put</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;更新&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">update</span><span class="params">(<span class="meta">@Body</span> DeptDto deptDto)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service.update(deptDto);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">  <span class="meta">@Get</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;获取&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> DeptDto <span class="title">get</span><span class="params">(<span class="meta">@Path</span> Long id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service.get(id);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping</span></span><br><span class="line">  <span class="meta">@Delete</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;删除&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">delete</span><span class="params">(<span class="meta">@Param</span> Long id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service.delete(id);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(&quot;/importData&quot;)</span></span><br><span class="line">  <span class="meta">@Post</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;上传&quot;)</span></span><br><span class="line">  <span class="meta">@Multipart</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">importData</span><span class="params">(UploadedFile file)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service.importData(file);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(&quot;/exportData&quot;)</span></span><br><span class="line">  <span class="meta">@Get</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;下载&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exportData</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">    service.exportData(context);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(&quot;/index&quot;)</span></span><br><span class="line">  <span class="meta">@Get</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;浏览部门&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">index</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">    mv.put(<span class="string">&quot;depts&quot;</span>, service.list());</span><br><span class="line">    mv.view(<span class="string">&quot;dept.shtm&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mv;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="上传下载"><a href="#上传下载" class="headerlink" title="上传下载"></a>上传下载</h3><p>Solon 对上传下载的支持也是比较丰富的，这里只是使用了最常用的方式进行展示。更多的使用方法，参看 <a target="_blank" rel="noopener" href="https://solon.noear.org/article/313">https://solon.noear.org/article/313</a> 。</p>
<h3 id="静态资源"><a href="#静态资源" class="headerlink" title="静态资源"></a>静态资源</h3><p>引入<code>solon-web-staticfiles</code>可以提供公共的静态文件服务，默认静态文件目录是<code>resources/static/</code> 。可以通过配置的的方式调整目录。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">solon:</span></span><br><span class="line">  <span class="symbol">staticfiles:</span></span><br><span class="line">    <span class="symbol">mappings:</span></span><br><span class="line">      - <span class="attr">path:</span> <span class="string">&quot;/img/&quot;</span></span><br><span class="line">        <span class="symbol">repository:</span> <span class="string">&quot;classpath:img&quot;</span></span><br></pre></td></tr></table></figure>

<p>还可以通过代码的方式调整目录，更多的配置参看 <a target="_blank" rel="noopener" href="https://solon.noear.org/article/268">https://solon.noear.org/article/268</a> 。</p>
<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><h4 id="View"><a href="#View" class="headerlink" title="View"></a>View</h4><p>微信号的展示和logo，访问的是静态资源，且使用了不同的目录。</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=NjM3M2IyMjMwMWNmMmJlOGIyYzU2YWM4NzQzYTVjYzBfZFRSRldmbms3S1JZbkIyNnpxWkNtWTdteEVRR2VnWEpfVG9rZW46TGo4RmJrRWFnb2Rab2J4enB2Q2NkNEpZbldjXzE3MzkyNzc1NzI6MTczOTI4MTE3Ml9WNA" alt="img"></p>
<h4 id="Json"><a href="#Json" class="headerlink" title="Json"></a>Json</h4><p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=NjkxODRmZjJiMDA4NmVlNmMxZTcyOWRlN2JhYWE2NTlfVzhxelBaRzhVcUNBd2pQTW5ZWFVTZEg1eDR5OGV1TmRfVG9rZW46QUlYQmJoZXo5b2huMTF4dmYwdWNiZnlRbmRkXzE3MzkyNzc1NzI6MTczOTI4MTE3Ml9WNA" alt="img"></p>
<h4 id="Xml"><a href="#Xml" class="headerlink" title="Xml"></a>Xml</h4><p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=MTAwODRjYmJjOWZjM2FkNTlhM2MyYTY2MmQ2ZGI1NTZfYkoxNXN4eWpGbm9TaWVQak0zYmZxZmh4aFNCY1dhbkdfVG9rZW46Q0kxUGIyZmhYb09WS1R4eE9JZWNwcjhXbncxXzE3MzkyNzc1NzI6MTczOTI4MTE3Ml9WNA" alt="img"></p>
<h4 id="上传"><a href="#上传" class="headerlink" title="上传"></a>上传</h4><p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=NjY5ZWZiZDkyOTU4ZTQ3Yzk5NGM0OTM0YTMyMDBlNzlfQXBPR0d4OFI0cUw3TndpcFJyVWlOelpwcHhYTG9IYmpfVG9rZW46Q1gxcWJmQ1RTb21yclB4T09CQ2NVWThMbnRuXzE3MzkyNzc1NzI6MTczOTI4MTE3Ml9WNA" alt="img"></p>
<p>上传文件后，可以在日志中看到上传的文件名，可以在代码根目录看到对应上传的文件。</p>
<h4 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h4><p>下载的内容 swagger 工具显示不了，这里只展示返回的头信息。可以在浏览器中直接输入<a target="_blank" rel="noopener" href="http://localhost:8080/dept/exportData">http://localhost:8080/dept/exportData</a> 进行下载测试。</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=OTQ0YTI3ZWQwNjhlZjk0N2ZkZGM4N2M3YWY4Y2I2NThfSmZMMk96Z3Viek5kTk9reTliZnVKUllQTzNxM3lyaW5fVG9rZW46RXEyRWJqZXc5b3B1Q3Z4WW11M2NiVnZ1bjJmXzE3MzkyNzc1NzI6MTczOTI4MTE3Ml9WNA" alt="img"></p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>在 Solon 3.0.7 版本测试的时候发现上述 controller 的路由定义，可能存在 index 接口无法访问，而路由到的 get 接口的情况，但 3.1.0-SNAPSHOT已经修复这个问题，当前代码实用了 Solon 3.1.0-SNAPSHOT，后续 3.1.0 发布时，教程也会统一更新版本号。</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=YmFjNDI2NDUyNDVmYjBiOWI2OGU4N2VlNjkwZTdiYjJfWnB5WHBDU3JXelNRRXNydTgzUnZRdUhWb2x1WE9UaUlfVG9rZW46SWlSd2JNUWF1b3dVYXp4cEZTOGNqSjN4blhjXzE3MzkyNzc1NzI6MTczOTI4MTE3Ml9WNA" alt="img"></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>MVC 虽然广为人知，但是在细节处还是存在理解的不同。Solon 对 MVC 用完整的支持，可以放心食用。不喜欢示例中的项目结构划分的可以参考阿里或者其他的目录结构进行项目结构的组织。</p>
<h2 id="补充说明"><a href="#补充说明" class="headerlink" title="补充说明"></a>补充说明</h2><p>春节期间的囤货已经用完了，也是第一次写比较完整的教程，后续教程的更新可能会比较慢。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2025/02/10/course100/019/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/10/course100/019/" class="post-title-link" itemprop="url">数据操作 —— 操作 NoSQL</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-02-10 20:01:31 / 修改时间：20:05:43" itemprop="dateCreated datePublished" datetime="2025-02-10T20:01:31+08:00">2025-02-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/" itemprop="url" rel="index"><span itemprop="name">教程100</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">写作</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/" itemprop="url" rel="index"><span itemprop="name">Solon</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/Solon-%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Solon 实用教程</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>一般的 Web 应用都会使用到 Redis 做缓存处理，也可能会用 ElasticSearch 做全文检索。所以这里主要介绍对这个两个数据中间件的使用。Monogo方面也有对应的插件，可以自行尝试。</p>
<h2 id="创建模块"><a href="#创建模块" class="headerlink" title="创建模块"></a>创建模块</h2><p>在 IDEA 中通过 <code>File-&gt;New-&gt;Modules...</code> 可以创建新的模块 demo-nosql，基础代码和配置可以从demo01中拷贝过来，或者自己手动创建。</p>
<h2 id="修改依赖"><a href="#修改依赖" class="headerlink" title="修改依赖"></a>修改依赖</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    id <span class="string">&#x27;java&#x27;</span></span><br><span class="line">    id <span class="string">&quot;io.freefair.lombok&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">group = <span class="string">&quot;com.example&quot;</span></span><br><span class="line"><span class="comment">// 统一版本号</span></span><br><span class="line">version <span class="string">&quot;$&#123;demoVersion&#125;&quot;</span></span><br><span class="line">description = <span class="string">&quot;orm demo&quot;</span></span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    implementation platform(project(<span class="string">&quot;:demo-parent&quot;</span>))</span><br><span class="line"></span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-web&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-logging-logback&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-openapi2-knife4j&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-cache-jedis&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:esearchx&quot;</span>)</span><br><span class="line"></span><br><span class="line">    annotationProcessor(<span class="string">&quot;org.mapstruct:mapstruct-processor:$&#123;mapstructVersion&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    testImplementation(<span class="string">&quot;org.noear:solon-test-junit5&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">compileJava &#123;</span><br><span class="line">    options.encoding = <span class="string">&quot;UTF-8&quot;</span></span><br><span class="line">    options.compilerArgs &lt;&lt; <span class="string">&quot;-parameters&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jar &#123;</span><br><span class="line">    manifest &#123;</span><br><span class="line">        attributes <span class="string">&quot;Main-Class&quot;</span>: <span class="string">&quot;com.example.demo.orm.DemoOrmApp&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dependsOn(configurations.runtimeClasspath)</span><br><span class="line"></span><br><span class="line">    duplicatesStrategy = DuplicatesStrategy.EXCLUDE</span><br><span class="line">    from(configurations.runtimeClasspath.collect &#123;</span><br><span class="line">        <span class="keyword">if</span> (it.isDirectory()) it <span class="keyword">else</span> zipTree(it)</span><br><span class="line">    &#125;) &#123;</span><br><span class="line">        exclude <span class="string">&#x27;META-INF/MANIFEST.MF&#x27;</span></span><br><span class="line">        exclude <span class="string">&#x27;META-INF/*.SF&#x27;</span></span><br><span class="line">        exclude <span class="string">&#x27;META-INF/*.DSA&#x27;</span></span><br><span class="line">        exclude <span class="string">&#x27;META-INF/*.RSA&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> sourcesMain = sourceSets.main</span><br><span class="line">    sourcesMain.allSource.forEach &#123; println(<span class="string">&quot;add from sources: $&#123;it.name&#125;&quot;</span>) &#125;</span><br><span class="line">    from(sourcesMain.output)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用-Redis"><a href="#使用-Redis" class="headerlink" title="使用 Redis"></a>使用 Redis</h2><h3 id="增加依赖"><a href="#增加依赖" class="headerlink" title="增加依赖"></a>增加依赖</h3><p>build.gradle</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-cache-jedis&quot;</span>)</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h3 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h3><p>app.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置数据源</span></span><br><span class="line"><span class="attr">demo:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">driverType:</span> <span class="string">redis</span> <span class="comment">#驱动类型</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">db:</span> <span class="number">0</span> <span class="comment">#默认为 0，可不配置</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">porpoise-demo</span></span><br><span class="line">    <span class="attr">keyHeader:</span> <span class="string">porpoise-demo</span></span><br><span class="line">    <span class="attr">enableMd5key:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">defSeconds:</span> <span class="number">600</span> <span class="comment">#默认为 30，可不配置</span></span><br><span class="line">    <span class="attr">idleConnectionTimeout:</span> <span class="number">10000</span></span><br><span class="line">    <span class="attr">connectTimeout:</span> <span class="number">10000</span></span><br></pre></td></tr></table></figure>

<h3 id="增加配置类"><a href="#增加配置类" class="headerlink" title="增加配置类"></a>增加配置类</h3><p>RedisConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Bean(typed = true)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> RedisClient <span class="title">defaultClient</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">      <span class="meta">@Inject(&quot;$&#123;demo.redis&#125;&quot;)</span> RedisClientSupplier redisClientSupplier)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> redisClientSupplier.get();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="增加-controller"><a href="#增加-controller" class="headerlink" title="增加 controller"></a>增加 controller</h3><p>Controller 非必须，只是方便测试。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Mapping(&quot;/redis&quot;)</span></span><br><span class="line"><span class="meta">@Api(&quot;redis&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> RedisClient redisClient;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping</span></span><br><span class="line">  <span class="meta">@Get</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;获取key的值&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> redisClient.openAndGet(session -&gt; session.key(key).get());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping</span></span><br><span class="line">  <span class="meta">@Post</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;设置key的值&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">set</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">    redisClient.open(</span><br><span class="line">        session -&gt; &#123;</span><br><span class="line">          session.key(key).set(value);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p>验证有很多种方式，这里通过 swagger 文档进行调用。浏览器输入 <a target="_blank" rel="noopener" href="http://localhost:8080/doc.html">http://localhost:8080/doc.html</a></p>
<h4 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h4><p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=MjQwNDdjNzZiOWJjOTZlZGFiNDMxMTVjNGM2ZTUwZDNfRTlFbGs4N3lEVEx5R3g2M3ppaXk3SHphYWRGeW0zajhfVG9rZW46TzFqWmJaOXhUb3FITG14YThwUGN2NFgwbkNiXzE3MzkxODg5Mzg6MTczOTE5MjUzOF9WNA" alt="img"></p>
<h4 id="获取"><a href="#获取" class="headerlink" title="获取"></a>获取</h4><p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=NjMxZGY4Yjg0YWU1YjY4NDQyMWM3MWYxNjk3YmNiY2NfcHRvRGpmUTFlQ3k0Rzc1bkg3RmVqNWZMRG1mcGNnTXFfVG9rZW46V2VnUWJ0UFEybzhPamp4OWtkY2N5WkpkblpnXzE3MzkxODg5Mzg6MTczOTE5MjUzOF9WNA" alt="img"></p>
<h2 id="使用-ElasticSearch"><a href="#使用-ElasticSearch" class="headerlink" title="使用 ElasticSearch"></a>使用 ElasticSearch</h2><h3 id="增加依赖-1"><a href="#增加依赖-1" class="headerlink" title="增加依赖"></a>增加依赖</h3><p>build.gradle</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    <span class="comment">// es 没有对应的插件，需要自己引入 esearchx</span></span><br><span class="line">    implementation(<span class="string">&quot;org.noear:esearchx&quot;</span>)</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h3 id="修改配置-1"><a href="#修改配置-1" class="headerlink" title="修改配置"></a>修改配置</h3><p>app.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置数据源</span></span><br><span class="line"><span class="attr">demo:</span></span><br><span class="line">  <span class="attr">es:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">http://127.0.0.1:9200</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure>

<h3 id="增加配置类-1"><a href="#增加配置类-1" class="headerlink" title="增加配置类"></a>增加配置类</h3><p>EsConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EsConfig</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * url,username,password</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> properties</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Bean(name = &quot;esContext&quot;, typed = true)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> EsContext <span class="title">esContext</span><span class="params">(<span class="meta">@Inject(&quot;$&#123;demo.es&#125;&quot;)</span> Properties properties)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> EsContext(properties);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="增加-entity"><a href="#增加-entity" class="headerlink" title="增加 entity"></a>增加 entity</h3><p>增加DemoEntity方便操作数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoEntity</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> String code;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="增加-controller-1"><a href="#增加-controller-1" class="headerlink" title="增加 controller"></a>增加 controller</h3><p>Controller 非必须，只是方便测试。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Mapping(&quot;/es&quot;)</span></span><br><span class="line"><span class="meta">@Api(&quot;es&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EsController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> EsContext esContext;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping</span></span><br><span class="line">  <span class="meta">@Get</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;获取列表&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;DemoEntity&gt; <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      EsData&lt;DemoEntity&gt; result = <span class="keyword">null</span>;</span><br><span class="line">      result = esContext.indice(<span class="string">&quot;demo&quot;</span>).selectList(DemoEntity.class);</span><br><span class="line">      <span class="keyword">return</span> result.getList();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">      log.error(<span class="string">&quot;add error&quot;</span>, e);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping</span></span><br><span class="line">  <span class="meta">@Post</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;保存文档&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">add</span><span class="params">(<span class="meta">@Body</span> DemoEntity entity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      esContext.indice(<span class="string">&quot;demo&quot;</span>).insert(entity);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">      log.error(<span class="string">&quot;add error&quot;</span>, e);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="验证-1"><a href="#验证-1" class="headerlink" title="验证"></a>验证</h3><p>验证有很多种方式，这里通过 swagger 文档进行调用。浏览器输入 <a target="_blank" rel="noopener" href="http://localhost:8080/doc.html">http://localhost:8080/doc.html</a></p>
<h4 id="保存文档"><a href="#保存文档" class="headerlink" title="保存文档"></a>保存文档</h4><p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmU3OTUyMWJhMjI2NjNhZTBkM2E3ZjA0M2RhYTI5OWFfRzk3NmJhUEhQd0Y1aXZWR083M3Q1Z2laekpwVjE0SUlfVG9rZW46QVNBbWJpYkEzb0JQZUF4cDNmZGN5T0N1bllkXzE3MzkxODg5Mzg6MTczOTE5MjUzOF9WNA" alt="img"></p>
<h4 id="获取文档列表"><a href="#获取文档列表" class="headerlink" title="获取文档列表"></a>获取文档列表</h4><p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=YzgwMzRiYmNmNGRlZTM4ZjNlMDdkMWI2ODhmZmI2ODZfS3Q3ZmxwTUdpTGx2WVdXcklDUUdkb2JCdnNxaDhneGRfVG9rZW46TEJHcGJiOG9MbzFMbkZ4NWt5MmNkWmlQbmhkXzE3MzkxODg5Mzg6MTczOTE5MjUzOF9WNA" alt="img"></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>Solon 通过简单的配置就可以操作 Redis 和 ElasticSearch ，对 NoSql 的支持还是挺完整的，更多的对数据的操作需要看具体的类库提供的接口。</p>
<p>完整代码可以从 <a target="_blank" rel="noopener" href="https://gitee.com/CrazyAirhead/porpoise-demo">https://gitee.com/CrazyAirhead/porpoise-demo</a> 获取。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2025/02/09/course100/018/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/09/course100/018/" class="post-title-link" itemprop="url">数据操作 —— 操作 SQL</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-02-09 20:19:00 / 修改时间：20:22:29" itemprop="dateCreated datePublished" datetime="2025-02-09T20:19:00+08:00">2025-02-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/" itemprop="url" rel="index"><span itemprop="name">教程100</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">写作</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/" itemprop="url" rel="index"><span itemprop="name">Solon</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/Solon-%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Solon 实用教程</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>Solon 不像 Jfinal 提供了基础的数据库能力，是通过集成第三方的 ORM 来实现的，当然 Solon 家也有自己的 ORM（wood）。结合自己使用了多个 ORM 的情况，选择了无 XML 的 easy-query。虽然 Solon 也有 activerecord 的插件，但是 Jfinal 框架内，使用还是不够趁手。</p>
<p>个人确实比较喜欢 activerecord，后续也会补充对 easy-query 的扩展，比如继承 activerecord 的 sql 模版管理，基于 map 的 Model Bean。</p>
<p>这里使用的是 MySQL 数据库，其他数据库是类似的，切换对应的驱动即可。</p>
<h2 id="创建模块"><a href="#创建模块" class="headerlink" title="创建模块"></a>创建模块</h2><p>在 IDEA 中通过 <code>File-&gt;New-&gt;Modules...</code> 可以创建新的模块 demo-orm，基础代码和配置可以从demo01中拷贝过来，或者自己手动创建。</p>
<h2 id="修改依赖"><a href="#修改依赖" class="headerlink" title="修改依赖"></a>修改依赖</h2><p>使用初始器创建项目，增加 web 和 easy-query 依赖，同时增加 swagger 依赖，并非必须，只是为了方便测试接口。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    id <span class="string">&#x27;java&#x27;</span></span><br><span class="line">    id <span class="string">&quot;io.freefair.lombok&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">group = <span class="string">&quot;com.example&quot;</span></span><br><span class="line"><span class="comment">// 统一版本号</span></span><br><span class="line">version <span class="string">&quot;$&#123;demoVersion&#125;&quot;</span></span><br><span class="line">description = <span class="string">&quot;orm demo&quot;</span></span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    implementation platform(project(<span class="string">&quot;:demo-parent&quot;</span>))</span><br><span class="line"></span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-web&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-logging-logback&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-openapi2-knife4j&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    implementation(<span class="string">&quot;com.zaxxer:HikariCP&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;mysql:mysql-connector-java&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;com.easy-query:sql-solon-plugin&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    annotationProcessor(<span class="string">&quot;org.mapstruct:mapstruct-processor:$&#123;mapstructVersion&#125;&quot;</span>)</span><br><span class="line">    <span class="comment">// 生成 entityProxy</span></span><br><span class="line">    annotationProcessor(<span class="string">&quot;com.easy-query:sql-processor:$&#123;easyQueryVersion&#125;&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    testImplementation(<span class="string">&quot;org.noear:solon-test-junit5&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">compileJava &#123;</span><br><span class="line">    options.encoding = <span class="string">&quot;UTF-8&quot;</span></span><br><span class="line">    options.compilerArgs &lt;&lt; <span class="string">&quot;-parameters&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jar &#123;</span><br><span class="line">    manifest &#123;</span><br><span class="line">        attributes <span class="string">&quot;Main-Class&quot;</span>: <span class="string">&quot;com.example.demo.orm.DemoOrmApp&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dependsOn(configurations.runtimeClasspath)</span><br><span class="line"></span><br><span class="line">    duplicatesStrategy = DuplicatesStrategy.EXCLUDE</span><br><span class="line">    from(configurations.runtimeClasspath.collect &#123;</span><br><span class="line">        <span class="keyword">if</span> (it.isDirectory()) it <span class="keyword">else</span> zipTree(it)</span><br><span class="line">    &#125;) &#123;</span><br><span class="line">        exclude <span class="string">&#x27;META-INF/MANIFEST.MF&#x27;</span></span><br><span class="line">        exclude <span class="string">&#x27;META-INF/*.SF&#x27;</span></span><br><span class="line">        exclude <span class="string">&#x27;META-INF/*.DSA&#x27;</span></span><br><span class="line">        exclude <span class="string">&#x27;META-INF/*.RSA&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> sourcesMain = sourceSets.main</span><br><span class="line">    sourcesMain.allSource.forEach &#123; println(<span class="string">&quot;add from sources: $&#123;it.name&#125;&quot;</span>) &#125;</span><br><span class="line">    from(sourcesMain.output)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `demo_dept` (</span><br><span class="line">  `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;部门名称&#x27;</span>,</span><br><span class="line">  `code` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;部门编码&#x27;</span>,</span><br><span class="line">  `create_at` datetime <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;时间时间&#x27;</span>,</span><br><span class="line">  `update_at` datetime <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> UPDATE <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci COMMENT<span class="operator">=</span><span class="string">&#x27;部门表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h2><p>app.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置数据源</span></span><br><span class="line"><span class="attr">solon.dataSource:</span></span><br><span class="line">  <span class="attr">db1:</span></span><br><span class="line">    <span class="attr">jdbcUrl:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/demo?useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;rewriteBatchedStatements=true</span></span><br><span class="line">    <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">demo</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h2 id="配置数据源"><a href="#配置数据源" class="headerlink" title="配置数据源"></a>配置数据源</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EasyQueryConfig</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Bean(name = &quot;db1&quot;, typed = true)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> DataSource <span class="title">db1</span><span class="params">(<span class="meta">@Inject(&quot;$&#123;demo.db1&#125;&quot;)</span> HikariDataSource ds)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ds;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="配置文档"><a href="#配置文档" class="headerlink" title="配置文档"></a>配置文档</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfig</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> OpenApiExtensionResolver openApiExtensionResolver;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean(&quot;adminApi&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> DocDocket <span class="title">adminApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    DocDocket docDocket =</span><br><span class="line">        <span class="keyword">new</span> DocDocket()</span><br><span class="line">            .groupName(<span class="string">&quot;Admin 端接口&quot;</span>)</span><br><span class="line">            .info(</span><br><span class="line">                <span class="keyword">new</span> ApiInfo()</span><br><span class="line">                    .title(<span class="string">&quot;porpoise-demo&quot;</span>)</span><br><span class="line">                    .description(<span class="string">&quot;在线API文档&quot;</span>)</span><br><span class="line">                    .contact(<span class="keyword">new</span> ApiContact().name(<span class="string">&quot;CrazyAirhead&quot;</span>).email(<span class="string">&quot;l4qiang@hotmail.com&quot;</span>))</span><br><span class="line">                    .version(<span class="string">&quot;1.0&quot;</span>))</span><br><span class="line">            .schemes(Scheme.HTTP.toValue())</span><br><span class="line">            .globalResponseInData(<span class="keyword">true</span>)</span><br><span class="line">            .vendorExtensions(openApiExtensionResolver.buildExtensions())</span><br><span class="line">            .apis(<span class="string">&quot;com.example.demo&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> docDocket;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="增加-model"><a href="#增加-model" class="headerlink" title="增加 model"></a>增加 model</h2><p>easy-query 提供了插件可以生成 model，通过IDEA 的database 连接数据库，选择表，右键选择TableEntityGenerate，填写对应的信息，点击 ok。</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=MTBhOTBjN2QyMTU4NjQ4Njg2ZGYyNjRkNWFiMDA2OTFfNzkyNDRNTlJLeWdIWHJyQ0VIZXpDS1YxY2tLYkJBU1hfVG9rZW46Skh5cGJmY2RUb1Rod2Z4a2xPWmNOVmw0bjVlXzE3MzkxMDM2MDU6MTczOTEwNzIwNV9WNA" alt="img"></p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=ZTc0OTNjYzk2MWQ1Y2Y0ZmY2NjhjYWFhODAwYjYzOGFfMzNFOGlTdTZyZ3NqYUxqV1psRHRZcVZYa1VXNnBzQzNfVG9rZW46UVRwc2JVV2FCb0FqOWV4aXpxZGMwTWlrbm1HXzE3MzkxMDM2MDU6MTczOTEwNzIwNV9WNA" alt="img"></p>
<p>生成代码后需要使用Ctrl+enter，呼出IDEA的代码生成菜单，点击 EntityQueryImplement。</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=OTcxMzhjMzdmMGFjZDI2NmFmZjFiZmJmYWYyYzBkOTZfVDdkVERUSXA1MTV3b0QzTHJQd25YSEg3ekR0RU85YjZfVG9rZW46TWg5QmJ6dGdub3kyYXB4Qno5Q2NFM2hJbmFkXzE3MzkxMDM2MDU6MTczOTEwNzIwNV9WNA" alt="img"></p>
<p>如果没有使用插件，自己创建实体类即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.orm.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.easy.query.core.annotation.Column;</span><br><span class="line"><span class="keyword">import</span> com.easy.query.core.annotation.EntityProxy;</span><br><span class="line"><span class="keyword">import</span> com.easy.query.core.annotation.Table;</span><br><span class="line"><span class="keyword">import</span> com.easy.query.core.proxy.ProxyEntityAvailable;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.orm.model.proxy.DeptEntityProxy;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 部门表 实体类。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Airhead</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Table(value = &quot;demo_dept&quot;)</span></span><br><span class="line"><span class="meta">@EntityProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptEntity</span> <span class="keyword">implements</span> <span class="title">ProxyEntityAvailable</span>&lt;<span class="title">DeptEntity</span>, <span class="title">DeptEntityProxy</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * id</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Column(primaryKey = true, value = &quot;id&quot;, generatedKey = true)</span></span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 部门名称</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 部门编码</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> String code;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 时间时间</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> LocalDateTime createAt;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 更新时间</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> LocalDateTime updateAt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="增加Controller"><a href="#增加Controller" class="headerlink" title="增加Controller"></a>增加Controller</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Mapping(&quot;/dept&quot;)</span></span><br><span class="line"><span class="meta">@Api(&quot;部门管理&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeptController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Db(&quot;db1&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> EasyEntityQuery entityQuery;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping</span></span><br><span class="line">  <span class="meta">@Get</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;获取列表&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;DeptEntity&gt; <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> entityQuery.queryable(DeptEntity.class).toList();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping</span></span><br><span class="line">  <span class="meta">@Post</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;新增&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">add</span><span class="params">(<span class="meta">@Body</span> DeptEntity dept)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> entityQuery.insertable(dept).executeRows(<span class="keyword">true</span>) &gt; <span class="number">0L</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping</span></span><br><span class="line">  <span class="meta">@Put</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;更新&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">update</span><span class="params">(<span class="meta">@Body</span> DeptEntity dept)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> entityQuery.updatable(dept).executeRows() &gt; <span class="number">0L</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">  <span class="meta">@Get</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;获取&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> DeptEntity <span class="title">get</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> entityQuery.queryable(DeptEntity.class).whereById(id).firstOrNull();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">  <span class="meta">@Delete</span></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;删除&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">delete</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> entityQuery</span><br><span class="line">            .getEasyQueryClient()</span><br><span class="line">            .deletable(DeptEntity.class)</span><br><span class="line">            .allowDeleteStatement(<span class="keyword">true</span>)</span><br><span class="line">            .whereById(id)</span><br><span class="line">            .executeRows()</span><br><span class="line">        &gt; <span class="number">0L</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><p>验证有很多种方式，这里通过 swagger 文档进行调用。浏览器输入 <a target="_blank" rel="noopener" href="http://localhost:8080/doc.html">http://localhost:8080/doc.html</a></p>
<h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=M2I2YWQ0OGU0NTNjYzEzMWU4MWI0N2JlMWUwMjRlNDVfSFdGS1FOcmZjamM1d0xYOEZINGxKanVsTERTSzkzSnBfVG9rZW46Q2hEMmIyZGppb2lUOTF4ZUFrUmNPdXZjblRiXzE3MzkxMDM2MDU6MTczOTEwNzIwNV9WNA" alt="img"></p>
<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=OWEyODFhODJiNjExMmNlZDMxYWE0NDU4YjJmNGI1YzJfWFN1OWE2WFdQcFlNcGNCUUExbFkyTmgyZ3Zoa2d0UnZfVG9rZW46WVlFU2IzVjZ2b2hiU1p4dXVSeWNXbXZvbjJnXzE3MzkxMDM2MDU6MTczOTEwNzIwNV9WNA" alt="img"></p>
<p>其他的接口可以自行尝试。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>通过以上步骤已经，可以实现对 dept 表的基础增删改查了，可以自己继续添加一些功能进行尝试性的修改。Solon 第三方的 orm 插件非常的多，如果不喜欢使用 easy-query，也可以选择其他 orm 框架进行尝试。</p>
<p>完整代码可以从 <a target="_blank" rel="noopener" href="https://gitee.com/CrazyAirhead/porpoise-demo">https://gitee.com/CrazyAirhead/porpoise-demo</a> 获取。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2025/02/08/course100/017/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/08/course100/017/" class="post-title-link" itemprop="url">初识 Solon —— 进一步的准备</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-02-08 21:41:03 / 修改时间：22:08:53" itemprop="dateCreated datePublished" datetime="2025-02-08T21:41:03+08:00">2025-02-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/" itemprop="url" rel="index"><span itemprop="name">教程100</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">写作</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/" itemprop="url" rel="index"><span itemprop="name">Solon</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/Solon-%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Solon 实用教程</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>为了简化和统一后续的开发，我们采用多模块的项目结构，引入 BOM 来统一管理依赖。本人并不擅长前端，前端不会过多讲解，主要基于 Sysbean Admin，后续的例子也将以对接 Sysbean Admin的接口作为例子进行讲解。</p>
<h2 id="多模块"><a href="#多模块" class="headerlink" title="多模块"></a>多模块</h2><p>多模块的配置，可以参看 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/qXaZ7BCL_0-1hkqTGNxFmA%E3%80%82">https://mp.weixin.qq.com/s/qXaZ7BCL_0-1hkqTGNxFmA。</a></p>
<p>在 IDEA 中通过 <code>File-&gt;New-&gt;Modules...</code> 可以创建新的模块。</p>
<p>先创建一个demo01的模块，然后把第一应用的文件移动到 demo01中（第一个应用的玩转例子保留在 start-up 的分支）。</p>
<p>之后再创建demo-parent模块，该模块用于统一管理依赖。</p>
<h3 id="修改settings-gradle"><a href="#修改settings-gradle" class="headerlink" title="修改settings.gradle"></a>修改settings.gradle</h3><p>补充说明写在注释中。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将demo，修改名称为porpoise-demo</span></span><br><span class="line">rootProject.name = <span class="string">&quot;porpoise-demo&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建新模版后自动增加的内容可以不用调整</span></span><br><span class="line">include <span class="string">&#x27;demo01&#x27;</span></span><br><span class="line">include <span class="string">&#x27;demo-parent&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="配置-build-gradle"><a href="#配置-build-gradle" class="headerlink" title="配置 build.gradle"></a>配置 build.gradle</h3><p>补充说明写在注释中。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    id <span class="string">&#x27;java&#x27;</span></span><br><span class="line">    id <span class="string">&quot;io.freefair.lombok&quot;</span> version <span class="string">&quot;8.11&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 统一 jdk 版本号</span></span><br><span class="line"><span class="keyword">def</span> jdkVersion = <span class="number">17</span></span><br><span class="line"><span class="keyword">def</span> demoVersion = <span class="string">&quot;1.0.0&quot;</span></span><br><span class="line"><span class="comment">// processor 的依赖需要指定版本号</span></span><br><span class="line"><span class="keyword">def</span> mapstructVersion = <span class="string">&quot;1.6.3&quot;</span></span><br><span class="line"><span class="comment">// processor 的依赖需要指定版本号</span></span><br><span class="line"><span class="keyword">def</span> easyQueryVersion = <span class="string">&quot;2.4.14&quot;</span></span><br><span class="line"></span><br><span class="line">group = <span class="string">&quot;com.example.demo&quot;</span></span><br><span class="line">version <span class="string">&quot;$&#123;demoVersion&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenLocal()</span><br><span class="line">        mavenCentral()</span><br><span class="line">        <span class="comment">// 增加腾讯云 maven 仓库镜像，提速。</span></span><br><span class="line">        maven &#123; url <span class="string">&quot;https://mirrors.cloud.tencent.com/nexus/repository/maven-public/&quot;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 版本号传递</span></span><br><span class="line">    ext[<span class="string">&quot;jdkVersion&quot;</span>] = <span class="string">&quot;$&#123;jdkVersion&#125;&quot;</span></span><br><span class="line">    ext[<span class="string">&quot;demoVersion&quot;</span>] = <span class="string">&quot;$&#123;demoVersion&#125;&quot;</span></span><br><span class="line">    ext[<span class="string">&quot;mapstructVersion&quot;</span>] = <span class="string">&quot;$&#123;mapstructVersion&#125;&quot;</span></span><br><span class="line">    ext[<span class="string">&quot;easyQueryVersion&quot;</span>] = <span class="string">&quot;$&#123;easyQueryVersion&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    tasks.withType(JavaCompile).tap &#123;</span><br><span class="line">        configureEach &#123;</span><br><span class="line">            options.encoding = <span class="string">&quot;UTF-8&quot;</span></span><br><span class="line">            <span class="comment">// 统一指定编译时保留参数名</span></span><br><span class="line">            options.compilerArgs &lt;&lt; <span class="string">&quot;-parameters&quot;</span> &lt;&lt; <span class="string">&quot;-Xlint:unchecked&quot;</span> &lt;&lt; <span class="string">&quot;-Xlint:deprecation&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置-demo-parant"><a href="#配置-demo-parant" class="headerlink" title="配置 demo-parant"></a>配置 demo-parant</h3><h4 id="增加dependencies-gradle"><a href="#增加dependencies-gradle" class="headerlink" title="增加dependencies.gradle"></a>增加dependencies.gradle</h4><p>用于统一管理版本号。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ext &#123;</span><br><span class="line">    set(<span class="string">&quot;solonVersion&quot;</span>, <span class="string">&quot;3.0.7&quot;</span>)</span><br><span class="line">    set(<span class="string">&quot;esearchxVersion&quot;</span>, <span class="string">&quot;1.0.22&quot;</span>)</span><br><span class="line">    set(<span class="string">&quot;hikaricpVersion&quot;</span>, <span class="string">&quot;5.1.0&quot;</span>)</span><br><span class="line">    set(<span class="string">&quot;mysqlVersion&quot;</span>, <span class="string">&quot;8.0.28&quot;</span>)</span><br><span class="line">    set(<span class="string">&quot;hutoolVersion&quot;</span>, <span class="string">&quot;6.0.0-M18&quot;</span>)</span><br><span class="line">    set(<span class="string">&quot;transmittableThreadLocalVersion&quot;</span>, <span class="string">&quot;2.14.2&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="配置-build-gradle-1"><a href="#配置-build-gradle-1" class="headerlink" title="配置 build.gradle"></a>配置 build.gradle</h4><p>补充说明写在注释中。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    <span class="comment">// 使用 java-platform 可以统一管理 bom</span></span><br><span class="line">    id <span class="string">&#x27;java-platform&#x27;</span></span><br><span class="line">    id <span class="string">&#x27;maven-publish&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入版本管理文件</span></span><br><span class="line">apply <span class="attr">from:</span> <span class="string">&quot;dependencies.gradle&quot;</span></span><br><span class="line"></span><br><span class="line">group <span class="string">&#x27;com.example.demo&#x27;</span></span><br><span class="line">version <span class="string">&quot;$&#123;demoVersion&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">javaPlatform &#123;</span><br><span class="line">    allowDependencies()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    api platform(<span class="string">&quot;org.noear:solon-parent:$&#123;solonVersion&#125;&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    constraints &#123;</span><br><span class="line">        api(<span class="string">&quot;com.zaxxer:HikariCP:$&#123;hikaricpVersion&#125;&quot;</span>)</span><br><span class="line">        api(<span class="string">&quot;mysql:mysql-connector-java:$&#123;mysqlVersion&#125;&quot;</span>)</span><br><span class="line">        api(<span class="string">&quot;com.easy-query:sql-solon-plugin:$&#123;easyQueryVersion&#125;&quot;</span>)</span><br><span class="line">        api(<span class="string">&quot;org.noear:esearchx:$&#123;esearchxVersion&#125;&quot;</span>)</span><br><span class="line">        api(<span class="string">&quot;org.dromara.hutool:hutool-all:$&#123;hutoolVersion&#125;&quot;</span>)</span><br><span class="line">        api(<span class="string">&quot;org.mapstruct:mapstruct:$&#123;mapstructVersion&#125;&quot;</span>)</span><br><span class="line">        api(<span class="string">&quot;com.alibaba:transmittable-thread-local:$&#123;transmittableThreadLocalVersion&#125;&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">publishing &#123;</span><br><span class="line">    publications &#123;</span><br><span class="line">        <span class="comment">//以下maven并非关键字，可自定义</span></span><br><span class="line">        maven(MavenPublication) &#123;</span><br><span class="line">            <span class="comment">//通过java-platform生成BOM</span></span><br><span class="line">            from components.javaPlatform</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    repositories &#123;</span><br><span class="line">        <span class="comment">// 根据需要发布到不同的仓库，此处只是发布到本地</span></span><br><span class="line">        mavenLocal()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置-demo01"><a href="#配置-demo01" class="headerlink" title="配置 demo01"></a>配置 demo01</h3><h4 id="配置-build-gradle-2"><a href="#配置-build-gradle-2" class="headerlink" title="配置 build.gradle"></a>配置 build.gradle</h4><p>补充说明写在注释中。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    id <span class="string">&#x27;java&#x27;</span></span><br><span class="line">    id <span class="string">&quot;io.freefair.lombok&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">group = <span class="string">&quot;com.example&quot;</span></span><br><span class="line"><span class="comment">// 统一版本号</span></span><br><span class="line">version <span class="string">&quot;$&#123;demoVersion&#125;&quot;</span></span><br><span class="line">description = <span class="string">&quot;Demo project for Solon&quot;</span></span><br><span class="line"></span><br><span class="line">java &#123;</span><br><span class="line">    toolchain &#123;</span><br><span class="line">        languageVersion = JavaLanguageVersion.of(<span class="string">&quot;$&#123;jdkVersion&#125;&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    <span class="comment">// 使用 demo-parent，依赖调整的最主要的位置</span></span><br><span class="line">    implementation platform(project(<span class="string">&quot;:demo-parent&quot;</span>))</span><br><span class="line"></span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-web&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-view-freemarker&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-logging-logback&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除，已经用插件的方式引入了</span></span><br><span class="line">    <span class="comment">// compileOnly(&quot;org.projectlombok:lombok&quot;)</span></span><br><span class="line">    testImplementation(<span class="string">&quot;org.noear:solon-test&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">compileJava &#123;</span><br><span class="line">    options.encoding = <span class="string">&quot;UTF-8&quot;</span></span><br><span class="line">    options.compilerArgs &lt;&lt; <span class="string">&quot;-parameters&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jar &#123;</span><br><span class="line">    manifest &#123;</span><br><span class="line">        attributes <span class="string">&quot;Main-Class&quot;</span>: <span class="string">&quot;com.example.demo.App&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dependsOn(configurations.runtimeClasspath)</span><br><span class="line"></span><br><span class="line">    duplicatesStrategy = DuplicatesStrategy.EXCLUDE</span><br><span class="line">    from(configurations.runtimeClasspath.collect &#123;</span><br><span class="line">        <span class="keyword">if</span> (it.isDirectory()) it <span class="keyword">else</span> zipTree(it)</span><br><span class="line">    &#125;) &#123;</span><br><span class="line">        exclude <span class="string">&#x27;META-INF/MANIFEST.MF&#x27;</span></span><br><span class="line">        exclude <span class="string">&#x27;META-INF/*.SF&#x27;</span></span><br><span class="line">        exclude <span class="string">&#x27;META-INF/*.DSA&#x27;</span></span><br><span class="line">        exclude <span class="string">&#x27;META-INF/*.RSA&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> sourcesMain = sourceSets.main</span><br><span class="line">    sourcesMain.allSource.forEach &#123; println(<span class="string">&quot;add from sources: $&#123;it.name&#125;&quot;</span>) &#125;</span><br><span class="line">    from(sourcesMain.output)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="重新运行demo01"><a href="#重新运行demo01" class="headerlink" title="重新运行demo01"></a>重新运行demo01</h4><p>日志中出现如下字样，表示项目结构调整成功，可通过浏览器调用进行测试。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">App:</span> End loading elapsed=<span class="number">258</span>ms pid=<span class="number">32912</span> v=<span class="number">3.0</span><span class="number">.7</span></span><br></pre></td></tr></table></figure>

<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=MGVlZjcyMzAzMGQ3OTdjOTFmNGExYjBkNzM2MDU2MTVfUHRGdlhQd0pxdzA1UDJ0SWFtWkxvejhxS0t4TGVxZmVfVG9rZW46VGhzWmJOVGY1b2d2eHB4TzZLTGNER3NQbnJoXzE3MzkwMjM0MTU6MTczOTAyNzAxNV9WNA" alt="img"></p>
<h2 id="技术栈"><a href="#技术栈" class="headerlink" title="技术栈"></a>技术栈</h2><h3 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h3><ul>
<li>JDK 17</li>
<li>Gradle 8+</li>
<li>Solon 3.0.7</li>
<li>Easy-query 2.4.14</li>
<li>lombok 8.11</li>
<li>Mapstruct 1.6.3</li>
<li>Hutool 6.0.0-M18</li>
<li>MySQL 8+</li>
<li>Redis 6+</li>
</ul>
<h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><p>具体参看其官方文档，<a target="_blank" rel="noopener" href="https://docs.soybeanjs.cn/zh/guide/quick-start">https://docs.soybeanjs.cn/zh/guide/quick-start</a> 。</p>
<ul>
<li>Node  18.19.0+</li>
<li>pnpm 8.7.0+</li>
<li>Vue 3</li>
<li>Vite 4</li>
<li>TypeScript</li>
</ul>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>将项目调整为多模块结构，增加父BOM，并测试 demo01 可以正常运行，为后续项目的开发做好准备。</p>
<p>完整代码可以从 <a target="_blank" rel="noopener" href="https://gitee.com/CrazyAirhead/porpoise-demo">https://gitee.com/CrazyAirhead/porpoise-demo</a> 获取。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2025/02/07/course100/016/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/07/course100/016/" class="post-title-link" itemprop="url">初识 Solon —— 第一个应用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-02-07 19:56:06 / 修改时间：20:10:12" itemprop="dateCreated datePublished" datetime="2025-02-07T19:56:06+08:00">2025-02-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/" itemprop="url" rel="index"><span itemprop="name">教程100</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">写作</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/" itemprop="url" rel="index"><span itemprop="name">Solon</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/Solon-%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Solon 实用教程</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>994</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>使用<strong>Solon Initializr（</strong><a target="_blank" rel="noopener" href="https://solon.noear.org/start/%EF%BC%89,%E5%88%9B%E5%BB%BA%E5%9F%BA%E7%A1%80%E9%A1%B9%E7%9B%AE%E3%80%82%E4%B9%9F%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8">https://solon.noear.org/start/）,创建基础项目。也可以使用</a> IDEA 的 Solon 插件，<a target="_blank" rel="noopener" href="https://plugins.jetbrains.com/plugin/21380-solon%EF%BC%8C%E5%8A%9F%E8%83%BD%E7%B1%BB%E4%BC%BC%EF%BC%8C%E7%94%A8%E5%85%B6%E4%B8%AD%E4%B8%80%E7%A7%8D%E6%96%B9%E5%BC%8F%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BA%86%E3%80%82">https://plugins.jetbrains.com/plugin/21380-solon，功能类似，用其中一种方式就可以了。</a></p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=MTJkZGI0OWQ0NzE1YTc3YmVlZWU2Mjk2NmI5YmRkYTdfS2JOM2U4c0pva0c1RmZ0anpFWmEzSlZJeFJaQmhmTU1fVG9rZW46TzA5c2JiUlFzbzZHOUV4bFcxZ2NSRE95bmtnXzE3Mzg5Mjk0Nzk6MTczODkzMzA3OV9WNA" alt="img"></p>
<p>这里选择Gradle-Groovey，Java， 3.0.6，jar，jdk17，Solon Web。</p>
<h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><p>解压下载的demo.zip，用 IDEA 打开目录的 <code>build.gradle</code> 文件，弹窗选择open as project。</p>
<p>生成的代码已经包含了一个服务接口，无须额外编写代码。</p>
<p>等 IDEA 加载依赖完毕，即可直接运行 App.java的main函数。</p>
<p>打开浏览器，输入<a target="_blank" rel="noopener" href="http://localhost:8080/hello">http://localhost:8080/hello</a></p>
<p>你的第一个 Solon 的 web 应用就完成了。</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=MDcxMGIzNTU4ZmFmZGI2ZDUxNWVlMjIwYmFhNGM3YzFfeG04anJJS3BBUERYYk1VYjdjWEJrSWcxc2NJMHY5Ym9fVG9rZW46SzNSRmI0OWhnb01QZWJ4YmpkR2NhOUtvblBkXzE3Mzg5Mjk0Nzk6MTczODkzMzA3OV9WNA" alt="img"></p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>默认生成的Demo 已经提供测试，可以点击后看到如下效果。</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=NmQ0NGY2ZDEyNThkNTIwZDdlNjZjMTljMzZjOWNmMTlfMExUQ2lKVWc2VDBtS0d5NGZSdHVTR3dqb0FBemxLZ0tfVG9rZW46SVpuVmJjR2lnb1Y4ZWV4OUZyT2NJeTlMbm1iXzE3Mzg5Mjk0Nzk6MTczODkzMzA3OV9WNA" alt="img"></p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=NTU5ZWZmN2U3ODgyZWRkZDdmNzc5NGM5YWM1NzAwM2ZfV3ZCTzNqaTlMSlJrdWp4a25HZWhveWtTa3RYQ1pNeEVfVG9rZW46UkpKT2JLZWZQbzdkTXF4VXdpUGNHR0NoblFkXzE3Mzg5Mjk0Nzk6MTczODkzMzA3OV9WNA" alt="img"></p>
<p>如果提示不存在任何测试的错误，调整 IDEA 的配置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">No matching tests found <span class="keyword">in</span> any candidate <span class="built_in">test</span> task.</span><br><span class="line">    Requested tests:</span><br><span class="line">        Test pattern features.HelloTest.hello <span class="keyword">in</span> task :demo:<span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmQ4YmZkNGEzODM2M2FkNjc3ZDE2MzY0MTM5M2Y0NDFfVXQ0OW5hbzBFOU83Sjl4Zkw3UmpDbkRPQU1HWVVpOHpfVG9rZW46QXRDM2JPRGczb0dKeDF4QTNvaWNVOTRybjdmXzE3Mzg5Mjk0Nzk6MTczODkzMzA3OV9WNA" alt="img"></p>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=NzVlMGQxY2Y4NjgxOGMxOTZhOGQxZmYyODJkM2Y1ZWVfdURKZFBnWXA0T0FHOWZtd0JXclpzS0V0ZnZidzFpQXlfVG9rZW46Vkx5VWJ1VlJybzI0OE14elZWWmNrZXpFblRkXzE3Mzg5Mjk0Nzk6MTczODkzMzA3OV9WNA" alt="img"></p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>默认生成的代码可以从下面的分支获取。</p>
<p><a target="_blank" rel="noopener" href="https://gitee.com/CrazyAirhead/porpoise-demo/tree/start-up/">https://gitee.com/CrazyAirhead/porpoise-demo/tree/start-up/</a></p>
<h2 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h2><p>Solon 作者针对的提供了多个性能的测试对比，具体看链接 <a target="_blank" rel="noopener" href="https://solon.noear.org/article/737">https://solon.noear.org/article/737</a> 的文章。这里不逻辑所有的性能对比，只例出<code>Spring VS Javalin VS Solon</code>的对比，另外测试只是做个参考。不同的环境、场景，效果不同。</p>
<h3 id="测试记录"><a href="#测试记录" class="headerlink" title="测试记录"></a>测试记录</h3><table>
<thead>
<tr>
<th>项目</th>
<th>SpringBoot2</th>
<th>SpringBoot3</th>
<th>Javalin</th>
<th>Solon</th>
</tr>
</thead>
<tbody><tr>
<td>运行时</td>
<td>java 17</td>
<td>java 17</td>
<td>java 17</td>
<td>java 17</td>
</tr>
<tr>
<td>测试前状态/内存</td>
<td>101.1Mb</td>
<td>112.9Mb</td>
<td>66.1Mb</td>
<td>45.6Mb</td>
</tr>
<tr>
<td>测试后状态/内存</td>
<td>996.3Mb</td>
<td>326.9Mb</td>
<td>457.3Mb</td>
<td>369.2Mb</td>
</tr>
<tr>
<td>测试后状态/并发</td>
<td>2万</td>
<td>2.6万</td>
<td>12万</td>
<td>17万</td>
</tr>
</tbody></table>
<h3 id="测试视频"><a href="#测试视频" class="headerlink" title="测试视频"></a>测试视频</h3><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1nJ4m1h79P/">https://www.bilibili.com/video/BV1nJ4m1h79P/</a></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>通过 Solon Initializr 可以直接创建基础可运行的应用。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2025/02/06/course100/015/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/06/course100/015/" class="post-title-link" itemprop="url">初始 Solon —— Solon 体系</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-02-06 22:13:02 / 修改时间：22:25:29" itemprop="dateCreated datePublished" datetime="2025-02-06T22:13:02+08:00">2025-02-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/" itemprop="url" rel="index"><span itemprop="name">教程100</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">写作</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/" itemprop="url" rel="index"><span itemprop="name">Solon</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/Solon-%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Solon 实用教程</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>本部分内容建议直接看官网 <a target="_blank" rel="noopener" href="https://solon.noear.org,以便能看到最新的内容.这里只是简单的罗列./">https://solon.noear.org，以便能看到最新的内容。这里只是简单的罗列。</a></p>
<h2 id="Solon-体系"><a href="#Solon-体系" class="headerlink" title="Solon 体系"></a>Solon 体系</h2><p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=NzU2YWQ2MDY4OTViOGE2ZDIxNjhkNjk1ZTNjOTc3ZDZfWW55QW5ZYVdlZVBPQjhGcWtUc2VyZUJRYjZOb0FqVUNfVG9rZW46TmZBeGJ2bnVzbzhVRnB4T2ZkUmNqUVB3bkhoXzE3Mzg4NTE0NTM6MTczODg1NTA1M19WNA" alt="img"></p>
<h3 id="Solon-Core"><a href="#Solon-Core" class="headerlink" title="Solon Core"></a>Solon Core</h3><p>Solon 核心库，主要分成，容器、插件、上下文处理。</p>
<ul>
<li>Ioc / Aop 容器，提供基于注入依赖的自动装配体系</li>
<li>插件扩展机制，提供“编码风格”的扩展体系</li>
<li>通用上下文处理接口，提供开放式网络协议对接适配体系（俗称，三元合一）</li>
</ul>
<h3 id="Solon-Boot"><a href="#Solon-Boot" class="headerlink" title="Solon Boot"></a>Solon Boot</h3><p>服务启动器，处理网络协议，三元合一。</p>
<h3 id="Solon-Serialization"><a href="#Solon-Serialization" class="headerlink" title="Solon Serialization"></a>Solon Serialization</h3><p>序列化体系及相关适配插件。</p>
<h3 id="Solon-View"><a href="#Solon-View" class="headerlink" title="Solon View"></a>Solon View</h3><p>Solon Web 的后端视图体系及相关适配插件。</p>
<h3 id="Solon-Data"><a href="#Solon-Data" class="headerlink" title="Solon Data"></a>Solon Data</h3><p>Solon 数据处理，包括事务、缓存、Orm 框架、NoSQL相关的插件。</p>
<h3 id="Solon-Doc"><a href="#Solon-Doc" class="headerlink" title="Solon Doc"></a>Solon Doc</h3><p>Solon 文档相关的插件。</p>
<h3 id="Solon-Log"><a href="#Solon-Log" class="headerlink" title="Solon Log"></a>Solon Log</h3><p>Solon 日志相关的插件。</p>
<h3 id="Solon-Test"><a href="#Solon-Test" class="headerlink" title="Solon Test"></a>Solon Test</h3><p>Solon 单元测试等开发辅助相关的插件。</p>
<h3 id="Solon-Security"><a href="#Solon-Security" class="headerlink" title="Solon Security"></a>Solon Security</h3><p>Solon 安全，鉴权、校验、加密等安全相关的插件。</p>
<h3 id="Solon-I18n"><a href="#Solon-I18n" class="headerlink" title="Solon I18n"></a>Solon I18n</h3><p>Solon 国际化相关的插件。</p>
<h3 id="Solon-Native"><a href="#Solon-Native" class="headerlink" title="Solon Native"></a>Solon Native</h3><p>Solon Native 是可以让 Solon 应用程序以 GraalVM 原生镜像的方式运行的技术方案。</p>
<h3 id="Solon-AI"><a href="#Solon-AI" class="headerlink" title="Solon AI"></a>Solon AI</h3><p>Solon 使用 AI 的相关插件。</p>
<h3 id="Solon-Remoting"><a href="#Solon-Remoting" class="headerlink" title="Solon Remoting"></a>Solon Remoting</h3><p>Solon 远程服务相关的插件及其应用。</p>
<h3 id="Solon-Web"><a href="#Solon-Web" class="headerlink" title="Solon Web"></a>Solon Web</h3><p>Solon Web 一个虚拟的项目，是相关依赖项目的组合。</p>
<h3 id="Solon-Scheduling"><a href="#Solon-Scheduling" class="headerlink" title="Solon Scheduling"></a>Solon Scheduling</h3><p>Solon 任务调度相关的插件。</p>
<h3 id="Solon-FaaS"><a href="#Solon-FaaS" class="headerlink" title="Solon FaaS"></a>Solon FaaS</h3><p>Solon 即时运行函数（一个文件，即为一个函数）的技术方案。</p>
<h3 id="Solon-Flow"><a href="#Solon-Flow" class="headerlink" title="Solon Flow"></a>Solon Flow</h3><p>Solon 流程引擎、规则引擎 等相关的插件。</p>
<h3 id="Solon-Cloud"><a href="#Solon-Cloud" class="headerlink" title="Solon Cloud"></a>Solon Cloud</h3><p>Solon 分布式与微服务开发相关的插件，主要包括：</p>
<ul>
<li>Solon Cloud Gateway 分布式网关相关插件</li>
<li>Solon Cloud Config 分布式配置相关插件</li>
<li>Solon Cloud Discovery 分布式注册与发现相关插件</li>
<li>Solon Cloud Event 分布式时间总线相关插件</li>
<li>Solon Cloud Job 分布式任务调度插件</li>
<li>Solon Cloud File 分布式文件插件</li>
<li>Solon Cloud Log 分布式日志插件</li>
<li>Solon Cloud Trace 分布式跟踪插件</li>
<li>Solon Cloud Metrics 分布式监控插件</li>
<li>Solon Cloud Breaker 分布式熔断插件</li>
<li>Solon Cloud Id 分布式 ID 插件</li>
<li>Solon Cloud I18n 分布式国际化配置插件</li>
<li>Solon Cloud List 分布式名单，白名单、黑名单等</li>
<li>Solon Cloud Lock 分布式锁插件</li>
</ul>
<h2 id="技术趋势"><a href="#技术趋势" class="headerlink" title="技术趋势"></a>技术趋势</h2><p>我们关注 Spring Boot3 的话，当前已经只支持 JDK17 以上版本，对 WebFlux，异步编程的支持越来越好。而且因为云原生的发展，Native 项目。随着大语言模型的发展，对构建 AI 应用的需求也会增加。在这些方面 Solon 都是有完整支持的，跟进 Solon 也能保持自己在技术方面的更新迭代。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/30/">30</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">L4qiang</p>
  <div class="site-description" itemprop="description">记录点滴，注重积累。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">292</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">119</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">118</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/crazy-airhead" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;crazy-airhead" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:L4qiang@gmail.com" title="E-Mail → mailto:L4qiang@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/enderjo" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;enderjo" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://ri.cms.firesbox.com/" title="https:&#x2F;&#x2F;ri.cms.firesbox.com" rel="noopener" target="_blank">践行群官方情报站</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">L4qiang</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">766k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">11:36</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  















    <div id="pjax">
  

  


    </div>
</body>
</html>

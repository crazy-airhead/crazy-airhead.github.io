<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"l4qiang.me","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="记录点滴，注重积累。">
<meta property="og:type" content="website">
<meta property="og:title" content="CrazyAirhead">
<meta property="og:url" content="http://l4qiang.me/page/2/index.html">
<meta property="og:site_name" content="CrazyAirhead">
<meta property="og:description" content="记录点滴，注重积累。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="L4qiang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://l4qiang.me/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>CrazyAirhead</title>
  


  <script data-pjax>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2613e7f510eebd12cf4d0d067e4ce195";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">CrazyAirhead</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">疯狂的傻瓜，傻瓜也疯狂——傻方能执著，疯狂才专注!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/crazy-airhead" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2025/03/02/course100/033/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/03/02/course100/033/" class="post-title-link" itemprop="url">Solon Cloud —— 熔断与限流</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-03-02 08:41:08 / 修改时间：08:42:03" itemprop="dateCreated datePublished" datetime="2025-03-02T08:41:08+08:00">2025-03-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/" itemprop="url" rel="index"><span itemprop="name">教程100</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">写作</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/" itemprop="url" rel="index"><span itemprop="name">Solon</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/Solon-%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Solon 实用教程</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><h3 id="限流"><a href="#限流" class="headerlink" title="限流"></a>限流</h3><p>限流是控制系统的的并发流量，通过限制请求流量的手段防止过度的流量导致系统崩溃。限流的指标有TPS， HPS、QPS等，限流的方法有流量计数器，滑动时间窗口，漏桶算法，令牌桶算法等。</p>
<h3 id="熔断"><a href="#熔断" class="headerlink" title="熔断"></a>熔断</h3><p>熔断的概念来自电路保护，提供了断路开关，主要有三种状态，关闭状态，打开状态和半开状态。熔断可以防止应用程序不断地尝试可能超时和失败的服务，能达到应用程序执行而不必等待下游服务修正错误服务。</p>
<h3 id="降级"><a href="#降级" class="headerlink" title="降级"></a>降级</h3><p>降级是指当自身服务压力增大时，采取一些手段，增强自身服务的处理能力，以保障服务的持续可用。比如，下线非核心服务以保证核心服务的稳定、降低实时性、降低数据一致性等。</p>
<h3 id="三者关系"><a href="#三者关系" class="headerlink" title="三者关系"></a>三者关系</h3><p>限流、熔断和服务降级是系统容错的重要设计模式，从一定意义上讲限流和熔断也是一种服务降级的手段。</p>
<table>
<thead>
<tr>
<th>措施</th>
<th>产生原因</th>
<th>针对服务</th>
</tr>
</thead>
<tbody><tr>
<td>熔断</td>
<td>下游服务不可用</td>
<td>下游服务</td>
</tr>
<tr>
<td>降级</td>
<td>自身服务的处理能力不够</td>
<td>自身服务</td>
</tr>
<tr>
<td>限流</td>
<td>上游服务请求增多</td>
<td>上游服务</td>
</tr>
</tbody></table>
<h3 id="Sentinel"><a href="#Sentinel" class="headerlink" title="Sentinel"></a>Sentinel</h3><p>Sentinel 是面向分布式、多语言异构化服务架构的流量治理组件，主要以流量为切入点，从流量路由、流量控制、流量整形、熔断降级、系统自适应过载保护、热点流量防护等多个维度来帮助开发者保障微服务的稳定性。</p>
<p>之前使用的是Spring Cloud 默认带的是 Hystrix，之前也没有用过Sentinel，这次按理是尝试使用Setinel。</p>
<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation platform(project(<span class="string">&quot;:demo-parent&quot;</span>))</span><br><span class="line"></span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-web&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-logging-logback&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-openapi2-knife4j&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:sentinel-solon-cloud-plugin&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;com.alibaba.csp:sentinel-transport-simple-http:1.8.8&quot;</span>)</span><br><span class="line"></span><br><span class="line">    annotationProcessor(<span class="string">&quot;org.mapstruct:mapstruct-processor:$&#123;mapstructVersion&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    testImplementation(<span class="string">&quot;org.noear:solon-test-junit5&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">solon.cloud.local:</span></span><br><span class="line">  <span class="attr">breaker:</span></span><br><span class="line">    <span class="attr">root:</span> <span class="number">1000</span></span><br><span class="line">    <span class="attr">hello:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<h2 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">package com.example.demo.solon.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Controller;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Mapping;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Param;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.cloud.annotation.CloudBreaker;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author <span class="variable">airhead</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Api</span>(<span class="string">&quot;Demo&quot;</span>)</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Mapping</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@ApiOperation</span>(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">  <span class="meta">@Mapping</span>(<span class="string">&quot;/hello&quot;</span>)</span><br><span class="line">  <span class="meta">@CloudBreaker</span>(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">String</span> <span class="function"><span class="title">hello</span>(<span class="params"><span class="meta">@Param</span>(defaultValue = <span class="string">&quot;world&quot;</span>) <span class="built_in">String</span> name</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">String</span>.format(<span class="string">&quot;Hello %s!&quot;</span>, name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><p>需要通过多线程的方式来测试，写个单元测试。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.solon.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.solon.DemoCloudBreakerApp;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.Utils;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.test.HttpTester;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.test.SolonTest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@SolonTest(DemoCloudBreakerApp.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoControllerTest</span> <span class="keyword">extends</span> <span class="title">HttpTester</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    CountDownLatch count = <span class="keyword">new</span> CountDownLatch(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">      log.info(<span class="string">&quot;get hello start. i:&#123;&#125;&quot;</span>, i);</span><br><span class="line">      <span class="keyword">int</span> finalI = i;</span><br><span class="line">      Utils.async(</span><br><span class="line">          () -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              path(<span class="string">&quot;/hello&quot;</span>).get();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">              log.error(<span class="string">&quot;&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            log.info(<span class="string">&quot;get hello end. i:&#123;&#125;&quot;</span>, finalI);</span><br><span class="line">            count.countDown();</span><br><span class="line">          &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    count.await();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当超过限流时，提示错误。</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=Njg4YzI3NTJlMzUyNjVlYmMyOGM2NDM5MzY5YmQ0ZGFfUkt6S3N3SVU0SXJVaDloaWdYc1ZodUl2NEZNUE0yRXZfVG9rZW46VW1VQmJ2WUNPb2xqRXh4V1lQYWNxR2xZblFjXzE3NDA4NzYxMDk6MTc0MDg3OTcwOV9WNA" alt="img"></p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ol>
<li>当前使用的版本3.0.9及 3.1.0-M3版本暂时不能把 CloudBreaker 注解在类上。</li>
<li>当前版本无法注册到 sentinel 的 dashboard 中，属于本地配置。</li>
<li>当前支持限流，没有熔断的支持。</li>
</ol>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>从测试使用的情况来看，Solon 目前只支持本地的限流处理，暂时不支持熔断，对 sentinel 的支持还不够完善，无法注册到 sentinel 的 dashboard 中。如果需要用于生产，需要自己扩展下对应的插件，或者再等一等官方的更新。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2025/03/01/course100/032/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/03/01/course100/032/" class="post-title-link" itemprop="url">Solon AI —— 初体验</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-03-01 07:58:44 / 修改时间：10:09:17" itemprop="dateCreated datePublished" datetime="2025-03-01T07:58:44+08:00">2025-03-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/" itemprop="url" rel="index"><span itemprop="name">教程100</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">写作</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/" itemprop="url" rel="index"><span itemprop="name">Solon</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/Solon-%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Solon 实用教程</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>关于 Solon Cloud 目前正在准备「熔断与限流」 的部分，想使用 sentinel 的插件，但我之前只用过 Spring 集成的 Hystrix，还需要先学习下 sentinel，目前还在准备当中，不会那么快更新。Solon AI 是 《Solon 实用教程》的第六部分，算是新增章节，恰好之前有使用过 agents-flex，准备起来更容易些，因此先开始更新 Solon AI 部分。</p>
<p><img src="blob:https://otwu9ovpkn.feishu.cn/96ae1bca-64eb-41f6-beb4-b20344c7041e" alt="Feishu Docs - Image"></p>
<p>Solon 将在 3.1.0 版本引入 AI 相关插件，现在已经发布 SNAPSHOT 版本，现在接口和功能还不稳定，只建议尝鲜。</p>
<p>从官网的介绍中（<a target="_blank" rel="noopener" href="https://solon.noear.org/article/learn-solon-ai%EF%BC%89%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0Solon">https://solon.noear.org/article/learn-solon-ai），可以看到Solon</a> AI 对大模型的支持是比较完整的，聊天模型接口支持同步调用，流式调用，Function Call，记忆功能，多种消息角色和多种消息格式，提供 RAG 支持和流程编排。</p>
<p>在初体验中，我测试的是聊天模型的同步调用，流式调用，Function Call这几个功能。</p>
<h2 id="前置"><a href="#前置" class="headerlink" title="前置"></a>前置</h2><p>本地测试使用了 ollama，需要安装好 ollama (<a target="_blank" rel="noopener" href="https://ollama.com/download)%EF%BC%8C%E5%B9%B6%E4%B8%8B%E8%BD%BD%E5%A5%BD%E6%A8%A1%E5%9E%8B%EF%BC%8C%E6%88%91%E8%BF%99%E9%87%8C%E6%BC%94%E7%A4%BA%E7%94%A8%E7%9A%84%E4%B8%A4%E4%B8%AA%E6%A8%A1%E5%9E%8B%E4%B8%80%E4%B8%AA%E6%98%AFdeepseek-r1:7b%EF%BC%88%E5%9F%BA%E4%BA%8E">https://ollama.com/download)，并下载好模型，我这里演示用的两个模型一个是deepseek-r1:7b（基于</a> qwen2.5 的蒸馏的一个推理模型）和 qwen2.5:7b（支持tools，在ollama 可以通过点击 tools 标签查看哪些模型支持 tools）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ollama run deepseek-r1:7b</span><br><span class="line">ollama run qwen2.5:7b</span><br></pre></td></tr></table></figure>

<p>如果无法调用 ollama 接口时，可做如下配置，主要处理跨域或者局域网调用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi .zshrc</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> OLLAMA_ORIGINS=<span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="built_in">export</span> OLLAMA_HOST=0.0.0.0:11434</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> .zshrc</span><br></pre></td></tr></table></figure>

<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><p>增加 solon-ai 的依赖，solon-web-rx 和 solon-web-sse 用于支持流式调用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    <span class="function">implementation <span class="title">platform</span><span class="params">(project(<span class="string">&quot;:demo-parent&quot;</span>)</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">implementation</span><span class="params">(<span class="string">&quot;org.noear:solon-web&quot;</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">implementation</span><span class="params">(<span class="string">&quot;org.noear:solon-ai&quot;</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">implementation</span><span class="params">(<span class="string">&quot;org.noear:solon-logging-logback&quot;</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">implementation</span><span class="params">(<span class="string">&quot;org.noear:solon-openapi2-knife4j&quot;</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">implementation</span><span class="params">(<span class="string">&quot;org.noear:solon-web-rx&quot;</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">implementation</span><span class="params">(<span class="string">&quot;org.noear:solon-web-sse&quot;</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">testImplementation</span><span class="params">(<span class="string">&quot;org.noear:solon-test&quot;</span>)</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>我这里使用 ollama 服务时，需要配置 provider。如果使用云服务时，设置 apiKey。</p>
<p>这里配置 timeout 是避免使用推理模型时，接口调用时间过长报错问题，可以根据自己的模型和机器的配置情况进行调整。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">demo:</span></span><br><span class="line">  <span class="attr">llm:</span></span><br><span class="line">    <span class="attr">apiUrl:</span> <span class="string">&quot;http://127.0.0.1:11434/api/chat&quot;</span> <span class="comment"># 使用完整地址（而不是 api_base）</span></span><br><span class="line">    <span class="comment"># apiKey: &quot;xxxx&quot;</span></span><br><span class="line">    <span class="attr">provider:</span> <span class="string">&quot;ollama&quot;</span></span><br><span class="line">    <span class="comment"># model: &quot;deepseek-r1:7b&quot;</span></span><br><span class="line">    <span class="attr">model:</span> <span class="string">&quot;qwen2.5:7b&quot;</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="string">600s</span></span><br></pre></td></tr></table></figure>

<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="LlmConfig"><a href="#LlmConfig" class="headerlink" title="LlmConfig"></a>LlmConfig</h3><p>通过注入的方式获取配置，并初始化ChatModel，这里可以根据自在的需求进一步配置ChatModel。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.ai.llm.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.noear.solon.ai.chat.ChatConfig;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.ai.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Inject;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LlmConfig</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ChatModel <span class="title">build</span><span class="params">(<span class="meta">@Inject(&quot;$&#123;demo.llm&#125;&quot;)</span> ChatConfig config)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ChatModel.of(config).build();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.ai.llm.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.ai.llm.service.LlmService;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.util.MimeType;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Mapping(&quot;/llm&quot;)</span></span><br><span class="line"><span class="meta">@Api(&quot;聊天&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LlmController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> LlmService service;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;chat&quot;)</span></span><br><span class="line">  <span class="meta">@Post</span></span><br><span class="line">  <span class="meta">@Mapping(&quot;chat&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">chat</span><span class="params">(String prompt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service.chat(prompt);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Produces(MimeType.TEXT_EVENT_STREAM_UTF8_VALUE)</span></span><br><span class="line">  <span class="meta">@Mapping(&quot;stream&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Flux&lt;String&gt; <span class="title">stream</span><span class="params">(String prompt)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service.stream(prompt);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;functionCall&quot;)</span></span><br><span class="line">  <span class="meta">@Post</span></span><br><span class="line">  <span class="meta">@Mapping(&quot;functionCall&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">functionCall</span><span class="params">(String prompt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service.functionCall(prompt);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.ai.llm.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.ai.chat.ChatModel;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.ai.chat.ChatResponse;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Component;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Inject;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LlmService</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> ChatModel chatModel;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">chat</span><span class="params">(String prompt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      ChatResponse response = chatModel.prompt(prompt).call();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> response.getMessage().getContent();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Flux&lt;String&gt; <span class="title">stream</span><span class="params">(String prompt)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Flux.from(chatModel.prompt(prompt).stream())</span><br><span class="line">        .filter(ChatResponse::hasChoices)</span><br><span class="line">        .map(resp -&gt; resp.getMessage().getContent());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">functionCall</span><span class="params">(String prompt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      ChatResponse response =</span><br><span class="line">          chatModel.prompt(prompt).options(o -&gt; o.functionAdd(<span class="keyword">new</span> Tools())).call();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> response.getMessage().getContent();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h3><p>Solon 提供了多种设置 Fuction Call 的方式，这里只是从官网拿过来的一个例子，更多内容看这里 <a target="_blank" rel="noopener" href="https://solon.noear.org/article/921">https://solon.noear.org/article/921</a> 。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">package com.example.demo.ai.llm.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.noear.solon.ai.chat.annotation.FunctionMapping;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.ai.chat.annotation.FunctionParam;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tools</span> </span>&#123;</span><br><span class="line">  <span class="meta">@FunctionMapping</span>(description = <span class="string">&quot;获取指定城市的天气情况&quot;</span>)</span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">String</span> <span class="function"><span class="title">get_weather</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">      <span class="meta">@FunctionParam</span>(name = <span class="string">&quot;location&quot;</span>, description = <span class="string">&quot;根据用户提到的地点推测城市&quot;</span>) <span class="built_in">String</span> location</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (location == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;arguments location is null (Assistant recognition failure)&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;晴，24度&quot;</span>; <span class="comment">// 可使用 “数据库” 或 “网络” 接口根据 location 查询合适数据;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><h3 id="同步调用"><a href="#同步调用" class="headerlink" title="同步调用"></a>同步调用</h3><p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=ZTAwZjI5YTA0MTY2M2RlYTU1NWExYzRjMjE5N2E3ODJfYUgyMU9WckRORUhYT2dLNm84cDg3ZjJrbDNrWXVhRXNfVG9rZW46V1V1a2JMNkU4b1hxb0p4VmRqS2N5ZnJ6bk5kXzE3NDA3OTI1Mzg6MTc0MDc5NjEzOF9WNA" alt="img"></p>
<h3 id="流式调用"><a href="#流式调用" class="headerlink" title="流式调用"></a>流式调用</h3><p>可以在浏览器中直接进行测试，目前的情况是，如果使用了推理模型 think 可能不显示，如果推理时间过长，可能出现超时的情况。作者在最新版本的SNAPSHOT中已处理，但我暂时还拉取不到最新版本。</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=OTA1MDU5ZWQzYTllNGE1ZDU4ZjdjMTUyOWE3ODFkM2NfZUIyZnFvblFJZE0zUmhMTXg1MjI2TE85eU9iclFTMzRfVG9rZW46S1RvUWJKSmVxb3JHNUF4ZzByb2MyTzhpbk5lXzE3NDA3OTI1Mzg6MTc0MDc5NjEzOF9WNA" alt="img"></p>
<h3 id="Function-Call"><a href="#Function-Call" class="headerlink" title="Function Call"></a>Function Call</h3><p>我们可能看到这例子里面只简单返回了 “晴，24度” 的天气情况。经过大模型的处理，内容就更完整丰富了。</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=MDkwYmJiOGRlZGE3YWFiYjZhODM3MDBjODQ5YmUzMzVfbG9EdDIzMlhEeU5UeHVIdEJSQ2VGNHNDaFlDZzFXNkVfVG9rZW46Rjh0TGJsSGpwb2ZhNHB4NE16UWNpQWZmbk9jXzE3NDA3OTI1Mzg6MTc0MDc5NjEzOF9WNA" alt="img"></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>这里我只测试了 Solon AI 的基础功能，可以说是非常容易上手，通过简单的配置就能调用本地的服务了，如果是云服务也是一样的，增加配置 apiKey 就可以了。后续我将继续测试 Solon AI 的 RAG 和 Flow 的功能。</p>
<h2 id="广告"><a href="#广告" class="headerlink" title="广告"></a>广告</h2><p>在 AI 来临的时候，越来越多的新奇的东西会占有我们的时间，我们的注意力，不少人甚至认为有了 AI 甚至可以不用学习了，然而现实有了 AI 能学的人越能学，不学的人越不会学，就像现在面对同样的 AI 有的人能做出精美的图片，有的人能写出生动的故事，但一些人面对 AI 还是不知所措。那么更关键的是即使没有 AI，自己也应该是一台学习机器、生产机器。不论学习还是生产都是需要占用时间的，或者更准确的说是注意力，这个注意力就好像是时间的利用率，注意力越高，时间利用率就越高，越能学习，越能生产。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2025/02/24/course100/031/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/24/course100/031/" class="post-title-link" itemprop="url">Solon Cloud —— 服务网关</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-02-24 22:44:30 / 修改时间：22:46:08" itemprop="dateCreated datePublished" datetime="2025-02-24T22:44:30+08:00">2025-02-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/" itemprop="url" rel="index"><span itemprop="name">教程100</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">写作</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/" itemprop="url" rel="index"><span itemprop="name">Solon</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/Solon-%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Solon 实用教程</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>Solon Cloud Gateway 是 一个可 Java 编程的分布式网关，提供了服务路由的能力和各种拦截的支持，只要是 http 服务（不需要关心实现的语言）都可以通过 Solon Cloud Gateway 进行代理转发，代理转发的服务也不一定要注册到服务注册中心。</p>
<p>虽然 Solon Cloud 提供了网关的实现，但在其官网出于性能及资源等原因的考虑，推荐优先使用专业网关（ngix，apisix，kong， k8s ingress controller），其次才是 Java 实现的网关 Spring Cloud Gateway 和 Solon Cloud Gateway。因此，在实际的项目中需要结合自己的项目情况来选择。</p>
<p>以下是微服务框架配合网关的架构图，图片来自 Solon 官网。<a target="_blank" rel="noopener" href="https://solon.noear.org/article/328">https://solon.noear.org/article/328</a> 。</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=NGE2N2NiOWVmYjRjNGFjNmNhZGE3YjlmMTQ5YmM3ODdfMjBnNkhjSFBtbkd0MENRRWNPVURFTmZBWm83OFBNeFZfVG9rZW46U3N5a2J1MGxwb2FJTVF4RkhpVGNWNXBlbjJjXzE3NDA0MDgzNDA6MTc0MDQxMTk0MF9WNA" alt="img"></p>
<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a><strong>依赖</strong></h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation platform(project(<span class="string">&quot;:demo-parent&quot;</span>))</span><br><span class="line"></span><br><span class="line">    implementation(<span class="string">&quot;org.noear:nacos2-solon-cloud-plugin&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon.cloud.gateway&quot;</span>)</span><br><span class="line"></span><br><span class="line">    annotationProcessor(<span class="string">&quot;org.mapstruct:mapstruct-processor:$&#123;mapstructVersion&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    testImplementation(<span class="string">&quot;org.noear:solon-test-junit5&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="响应式"><a href="#响应式" class="headerlink" title="响应式"></a>响应式</h3><p>Solon Cloud Gateway 使用响应式接口，由 Solon-Rx 来实现，是基于 reactive-streams 封装的 RxJava 极简版。目前仅一个接口 Completable，意为：可完成的发布者。</p>
<table>
<thead>
<tr>
<th>接口</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Completable</td>
<td>作为返回类型</td>
</tr>
<tr>
<td>Completable::complete()</td>
<td>构建完成发布者</td>
</tr>
<tr>
<td>Completable::error(cause)</td>
<td>构建异常发布者</td>
</tr>
<tr>
<td>Completable::create(（emitter)-&gt;{…})</td>
<td>构建发射器发布者</td>
</tr>
</tbody></table>
<h3 id="路由检测器"><a href="#路由检测器" class="headerlink" title="路由检测器"></a>路由检测器</h3><h4 id="内置路由检测器"><a href="#内置路由检测器" class="headerlink" title="内置路由检测器"></a>内置路由检测器</h4><table>
<thead>
<tr>
<th>匹配检测器工厂</th>
<th>本置前缀</th>
<th>说明与示例</th>
</tr>
</thead>
<tbody><tr>
<td>AfterPredicateFactory</td>
<td>After=</td>
<td>After 时间检测器，ZonedDateTime 格式 (After=2017-01-20T17:42:47.789-07:00[America/Denver])</td>
</tr>
<tr>
<td>BeforePredicateFactory</td>
<td>Before=</td>
<td>After 时间检测器，ZonedDateTime 格式 (Before=2017-01-20T17:42:47.789-07:00[America/Denver])</td>
</tr>
<tr>
<td>CookiePredicateFactory</td>
<td>Cookie=</td>
<td>Cookie 检测器 (Cookie=token)(Cookie=token, ^user.)</td>
</tr>
<tr>
<td>HeaderPredicateFactory</td>
<td>Header=</td>
<td>Header 检测器 (Header=token)(Header=token, ^user.)</td>
</tr>
<tr>
<td>MethodPredicateFactory</td>
<td>Method=</td>
<td>Method 检测器 (Method=GET,POST)</td>
</tr>
<tr>
<td>PathPredicateFactory</td>
<td>Path=</td>
<td>Path 检测器（支持多路径匹配，以”,”号隔开） (Path=/demo/<strong>) ，(Path=/demo/</strong>,/hello/**)</td>
</tr>
</tbody></table>
<p>通常情况下，我们使用 PathPredicateFactory 就够用，不需要额外的配置。</p>
<h3 id="路由过滤器"><a href="#路由过滤器" class="headerlink" title="路由过滤器"></a>路由过滤器</h3><h4 id="内置过滤器"><a href="#内置过滤器" class="headerlink" title="内置过滤器"></a>内置过滤器</h4><p>Solon 提供了一些内置的路由过滤器，可以通过直接的配置就可以使用。</p>
<table>
<thead>
<tr>
<th>过滤器工厂</th>
<th>本置前缀</th>
<th>说明与示例</th>
</tr>
</thead>
<tbody><tr>
<td>AddRequestHeaderFilterFactory</td>
<td>AddRequestHeader=</td>
<td>添加请求头 (AddRequestHeader=Demo-Ver,1.0)</td>
</tr>
<tr>
<td>AddResponseHeaderFilterFactory</td>
<td>AddResponseHeader=</td>
<td>添加响应头 (AddResponseHeader=Demo-Ver,1.0)</td>
</tr>
<tr>
<td>PrefixPathFilterFactory</td>
<td>PrefixPath=</td>
<td>附加路径前缀 (PrefixPath=/app)</td>
</tr>
<tr>
<td>RedirectToFilterFactory</td>
<td>RedirectTo=</td>
<td>跳转到 (RedirectTo=302,<a target="_blank" rel="noopener" href="http://demo.org/a,true">http://demo.org/a,true</a>)</td>
</tr>
<tr>
<td>RemoveRequestHeaderFilterFactory</td>
<td>RemoveRequestHeader=</td>
<td>移除请求头 (RemoveRequestHeader=Demo-Ver,1.0)</td>
</tr>
<tr>
<td>RemoveResponseHeaderFilterFactory</td>
<td>RemoveResponseHeader=</td>
<td>移除响应头 (RemoveResponseHeader=Demo-Ver,1.0)</td>
</tr>
<tr>
<td>StripPrefixFilterFactory</td>
<td>StripPrefix=</td>
<td>移除路径前缀段数 (StripPrefix=1)</td>
</tr>
</tbody></table>
<h4 id="定制"><a href="#定制" class="headerlink" title="定制"></a>定制</h4><p>通过RouteFilterFactory定制路由过滤规则，实现不同类型的接口过滤。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.solon.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.vertx.core.buffer.Buffer;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.dromara.hutool.core.text.StrUtil;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Component;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.cloud.gateway.exchange.ExContext;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.cloud.gateway.exchange.ExFilter;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.cloud.gateway.exchange.ExFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.cloud.gateway.route.RouteFilterFactory;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.rx.Completable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthFilterFactory</span> <span class="keyword">implements</span> <span class="title">RouteFilterFactory</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TOKEN = <span class="string">&quot;token&quot;</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EMPTY = <span class="string">&quot;empty&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">prefix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Auth&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ExFilter <span class="title">create</span><span class="params">(String config)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (TOKEN.equals(config)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> TokenFilter();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> EmptyAuthFilter();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 默认的空鉴权 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EmptyAuthFilter</span> <span class="keyword">implements</span> <span class="title">ExFilter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EmptyAuthFilter</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Completable <span class="title">doFilter</span><span class="params">(ExContext ctx, ExFilterChain chain)</span> </span>&#123;</span><br><span class="line">      log.info(<span class="string">&quot;empty filter, do nothing&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> chain.doFilter(ctx);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** token 鉴权 ，如果鉴权逻辑比较复杂的，用独立类 */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TokenFilter</span> <span class="keyword">implements</span> <span class="title">ExFilter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Completable <span class="title">doFilter</span><span class="params">(ExContext ctx, ExFilterChain chain)</span> </span>&#123;</span><br><span class="line">      String token = ctx.rawHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (StrUtil.isBlank(token)) &#123;</span><br><span class="line">        ctx.newResponse().status(<span class="number">401</span>);</span><br><span class="line">        ctx.newResponse().body(Buffer.buffer(<span class="string">&quot;token is empty&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> Completable.complete();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> chain.doFilter(ctx);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中 EmptyFilter 只是简单的记录日志，而 TokenFilter 会从头中获取 token 信息判断是否为空，为空是返回错误信息，不为空时正常情况。</p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a><strong>配置</strong></h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port:</span> <span class="number">8000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">solon.app:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">&#x27;demo-cloud-gateway&#x27;</span></span><br><span class="line">  <span class="comment"># group: &quot;DEFAULT_GROUP&quot; # 默认值为 DEFAULT_GROUP</span></span><br><span class="line">  <span class="comment"># namespace: &quot;public&quot; # 默认值为 public</span></span><br><span class="line"></span><br><span class="line"><span class="attr">knife4j.enable:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行样例时，屏蔽，或者配置app-local.yml</span></span><br><span class="line"><span class="attr">solon.env:</span> <span class="string">local</span></span><br><span class="line"></span><br><span class="line"><span class="attr">solon.cloud.nacos:</span></span><br><span class="line">  <span class="attr">server:</span> <span class="string">&quot;localhost:8848&quot;</span>           <span class="comment">#nacos2 服务地址</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">load:</span> <span class="string">&quot;demo-cloud-gateway.yml&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">solon.cloud.gateway:</span></span><br><span class="line">  <span class="attr">discover:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">excludedServices:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;self-service&quot;</span></span><br><span class="line">  <span class="attr">httpClient:</span></span><br><span class="line">    <span class="attr">responseTimeout:</span> <span class="number">1800</span> <span class="comment">#单位：秒</span></span><br><span class="line">  <span class="attr">routes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">demo</span></span><br><span class="line">      <span class="attr">index:</span> <span class="number">0</span> <span class="comment">#默认为0</span></span><br><span class="line">      <span class="attr">target:</span> <span class="string">&quot;http://127.0.0.1:8081&quot;</span></span><br><span class="line">      <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;Path=/demo/**&quot;</span></span><br><span class="line">      <span class="attr">filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;Auth=empty&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;StripPrefix=1&quot;</span></span><br><span class="line">      <span class="attr">timeout:</span></span><br><span class="line">        <span class="attr">responseTimeout:</span> <span class="number">1800</span> <span class="comment">#单位：秒</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">service01</span></span><br><span class="line">      <span class="attr">index:</span> <span class="number">0</span> <span class="comment">#默认为0</span></span><br><span class="line">      <span class="attr">target:</span> <span class="string">lb://demo-cloud-service01</span></span><br><span class="line">      <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;Path=/service01/**&quot;</span></span><br><span class="line">      <span class="attr">filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;Auth=token&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;StripPrefix=1&quot;</span></span><br><span class="line">      <span class="attr">timeout:</span></span><br><span class="line">        <span class="attr">responseTimeout:</span> <span class="number">1800</span> <span class="comment">#单位：秒</span></span><br></pre></td></tr></table></figure>

<p>这里使用 service01 作为上游服务，配置直接地址和使用服务注册的地址来分别测试。</p>
<p>使用直接地址时，使用了一个空的鉴权逻辑，然后利用 Solon 内置的StripPrefix 来移除url 中的第一段，然后请求实际的服务。</p>
<p>使用注册服务时，使用了一个简单的Token鉴权逻辑，然后利用 Solon 内置的StripPrefix 来移除url 中的第一段，然后请求实际的服务。</p>
<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><p>启动 demo-cloud-gateway 和 demo-cloud-service01。</p>
<p>通过service01来调用，也就是通过注册服务来调用。</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=NDEyNzFiZTU1ZTdkZjA2ZmMxZjg1MjQ3NTI1OTNkOGVfa0pjQ0hnYWd3OU5MNllvVDkxYnRuaVRZMzVmZjVOaFpfVG9rZW46TEE4aGIyWEVFbzlRY294blpLVGN1NEpPblJlXzE3NDA0MDgzNDA6MTc0MDQxMTk0MF9WNA" alt="img"></p>
<p>通过demo来调用，也就是通过直接地址来调用。</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=ODE5ZDQ5NTU2YWZlODdiYjQ4YmM1NTdlZGRlOGYyOGFfNmVTd0dmdEF3VUIxNFlVYjJNUHpSRENaZ2RGVWJVWjRfVG9rZW46TXZFNmJUVFZjb25FZm94T0txbGNzT3pObmlmXzE3NDA0MDgzNDA6MTc0MDQxMTk0MF9WNA" alt="img"></p>
<p>如果 servic01 没有启动的情况返回的是404的错误。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>Solon Cloud Gateway 通过配置的方式就可以对服务进行代理转发，在实际的业务使用中通常会与服务发现一起，实现负载均衡，也可以通过编程的方式进一步的定制自己的业务逻辑，实现统一鉴权，限流熔断，灰度发布等功能。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2025/02/23/course100/030/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/23/course100/030/" class="post-title-link" itemprop="url">Solon Cloud —— 服务注册与发现</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-02-23 14:29:56 / 修改时间：14:37:54" itemprop="dateCreated datePublished" datetime="2025-02-23T14:29:56+08:00">2025-02-23</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/" itemprop="url" rel="index"><span itemprop="name">教程100</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">写作</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/" itemprop="url" rel="index"><span itemprop="name">Solon</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/Solon-%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Solon 实用教程</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>服务注册与发现是一种动态管理服务实例的机制，其目的是让各个服务能够及时了解其他服务的状态与位置，以便能进行相互的通讯与协作。</p>
<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><p>添加 nacos2 的依赖 <code>org.noear:nacos2-solon-cloud-plugin</code>。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation platform(project(<span class="string">&quot;:demo-parent&quot;</span>))</span><br><span class="line"></span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-web&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-logging-logback&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-openapi2-knife4j&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:nacos2-solon-cloud-plugin&quot;</span>)</span><br><span class="line">    <span class="comment">// 使用 httputils</span></span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-net-httputils&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用 NamiClient</span></span><br><span class="line">    implementation(<span class="string">&quot;org.noear:nami-coder-snack3&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:nami-channel-http&quot;</span>)</span><br><span class="line"></span><br><span class="line">    annotationProcessor(<span class="string">&quot;org.mapstruct:mapstruct-processor:$&#123;mapstructVersion&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    testImplementation(<span class="string">&quot;org.noear:solon-test-junit5&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>Nacos2 插件已经做了些默认值，所以我不需要过多的配置即可连接到 nacos 发现服务，如果使用了server 节点，意思是配置服务和发现服务使用同一个配置，或者单独使用<code>solon.cloud.nacos.discovery.server</code>配置。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">solon.app:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">&quot;demo-cloud-config&quot;</span></span><br><span class="line">  <span class="comment"># group: &quot;DEFAULT_GROUP&quot; # 默认值为 DEFAULT_GROUP</span></span><br><span class="line">  <span class="comment"># namespace: &quot;public&quot; # 默认值为 public</span></span><br><span class="line"></span><br><span class="line"><span class="attr">solon.cloud.nacos:</span></span><br><span class="line">  <span class="attr">server:</span> <span class="string">&quot;localhost:8848&quot;</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">load:</span> <span class="string">&quot;demo-cloud-config.yml&quot;</span></span><br><span class="line">  <span class="comment"># discovery:</span></span><br><span class="line">  <span class="comment">#   server: &quot;localhost:8848&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="服务调用"><a href="#服务调用" class="headerlink" title="服务调用"></a>服务调用</h2><h3 id="测试服务"><a href="#测试服务" class="headerlink" title="测试服务"></a>测试服务</h3><p>测试服务中我们提供一个hello接口，并增加表示是从 Service01 的标识。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">package</span> com.example.demo.solon.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Controller;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Mapping;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Param;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Api(&quot;Demo&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Mapping</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@ApiOperation(&quot;hello&quot;)</span></span><br><span class="line">  <span class="meta">@Mapping(&quot;/hello&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(<span class="meta">@Param(defaultValue = &quot;world&quot;)</span> String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> String.format(<span class="string">&quot;Hello %s!, By Service01&quot;</span>, name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="DemoController"><a href="#DemoController" class="headerlink" title="DemoController"></a>DemoController</h3><p>Solon 的 NamiClient 或者 HttpUtils 可以通过服务名来调用服务，其中NamiClient可以通过类似FeignClient的注解的方式进行使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.solon.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.solon.client.DemoClient;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> org.noear.nami.annotation.NamiClient;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Controller;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Mapping;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Param;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.net.http.HttpUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Api(&quot;Demo&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Mapping</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@NamiClient</span> <span class="keyword">private</span> DemoClient demoClient;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;hello&quot;)</span></span><br><span class="line">  <span class="meta">@Mapping(&quot;/hello&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(<span class="meta">@Param(defaultValue = &quot;world&quot;)</span> String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> HttpUtils.http(<span class="string">&quot;demo-cloud-service01&quot;</span>, <span class="string">&quot;/hello&quot;</span>).data(<span class="string">&quot;name&quot;</span>, name).get();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ApiOperation(&quot;hello2&quot;)</span></span><br><span class="line">  <span class="meta">@Mapping(&quot;/hello2&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">hello2</span><span class="params">(<span class="meta">@Param(defaultValue = &quot;world&quot;)</span> String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> demoClient.hello(name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="DemoClient"><a href="#DemoClient" class="headerlink" title="DemoClient"></a>DemoClient</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.solon.client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.noear.nami.annotation.NamiClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@NamiClient(name = &quot;demo-cloud-service01&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DemoClient</span> </span>&#123;</span><br><span class="line">  <span class="function">String <span class="title">hello</span><span class="params">(String name)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><p>运行 demo-cloud-discovery 和 demo-cloud-service01，我们可以通过 nacos 看到服务到已经注册上来了。</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWRhODU4NzA4NWQ4YzlhM2EyMzliOTNlZWVhMzQ4MmRfU3FZVXhiVm84SHZsRjFuRjV6TldpQmtEaHBscDN3dWVfVG9rZW46SEJnSWJVRDNvb0sySFp4eWQyNmM0dzFybm1nXzE3NDAyOTIzMzE6MTc0MDI5NTkzMV9WNA" alt="img"></p>
<p>接下来通过 hello 和 hello2 接口测试 两种不同方式的调用。</p>
<p>通过 httputils 调用服务</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=MDJhMGM1OTA5MWYwZjkwZDljZjVmMGU3M2ZlYWE0N2VfNW5rOFJrM0c3dEZSQm5xOXBlUVRWRTkxZkp5bzF5NHFfVG9rZW46TmFOUmI0d2JEb2NRdUp4Q2w3T2NqckQxbjljXzE3NDAyOTIzMzE6MTc0MDI5NTkzMV9WNA" alt="img"></p>
<p>通过 NamiClient</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=OGYyODRmNzNkZmY0ZWZmMDQwNjBkNThlOTI0ODI4N2ZfS3NMakJmM291NEZLVXIzVnpXWnpvZ2Z1Nk5hM20yNGVfVG9rZW46T0JHbmJBV0Job1RIeGV4dzY5WmNzdFowblVoXzE3NDAyOTIzMzE6MTc0MDI5NTkzMV9WNA" alt="img"></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>通过简单的配置，我们就可以把服务注册的 Nacos 中，并可以通过服务名的方式调用其他服务。当我们在普通的服务中增加服务配置和服务注册与发现功能配置后，就可以算作系统中的一个分布式微服务了，可以关注于业务的开发了。而 Solon Cloud 的接下来的更多的面向系统的可用性，可维护性等。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2025/02/22/course100/029/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/22/course100/029/" class="post-title-link" itemprop="url">Solon Cloud —— 服务配置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-02-22 11:21:59 / 修改时间：11:24:47" itemprop="dateCreated datePublished" datetime="2025-02-22T11:21:59+08:00">2025-02-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/" itemprop="url" rel="index"><span itemprop="name">教程100</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">写作</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/" itemprop="url" rel="index"><span itemprop="name">Solon</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/Solon-%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Solon 实用教程</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>Nacos <code>/nɑ:kəʊs/</code> 是 Dynamic Naming and Configuration Service的首字母简称，一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。</p>
<p>接下来的服务配置和服务注册，我们使用的是 Nacos2。 需要自己部署好 Nacos2 ，具体内容可以参看 Nacos 的官网 <a target="_blank" rel="noopener" href="https://nacos.io/docs/latest/quickstart/quick-start%E3%80%82">https://nacos.io/docs/latest/quickstart/quick-start。</a></p>
<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><p>添加 nacos2 的依赖 <code>org.noear:nacos2-solon-cloud-plugin</code>。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation platform(project(<span class="string">&quot;:demo-parent&quot;</span>))</span><br><span class="line"></span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-web&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-logging-logback&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-openapi2-knife4j&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:nacos2-solon-cloud-plugin&quot;</span>)</span><br><span class="line"></span><br><span class="line">    annotationProcessor(<span class="string">&quot;org.mapstruct:mapstruct-processor:$&#123;mapstructVersion&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    testImplementation(<span class="string">&quot;org.noear:solon-test-junit5&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>Nacos2 插件已经做了些默认值，所以我不需要过多的配置即可连接到 nacos 配置中心。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">solon.app:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">&quot;demo-cloud-config&quot;</span></span><br><span class="line">  <span class="comment"># group: &quot;DEFAULT_GROUP&quot; # 默认值为 DEFAULT_GROUP</span></span><br><span class="line">  <span class="comment"># namespace: &quot;public&quot; # 默认值为 public</span></span><br><span class="line"></span><br><span class="line"><span class="attr">solon.cloud.nacos:</span></span><br><span class="line">  <span class="attr">server:</span> <span class="string">&quot;localhost:8848&quot;</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">load:</span> <span class="string">&quot;demo-cloud-config.yml&quot;</span></span><br></pre></td></tr></table></figure>

<p>load 使用<code>group:dataId</code>的格式加载配置配置文件，当加载的配置文件与 <code>solon.app.group</code> 配置的 group 一致时可以不用配置 group 的部分，也就是只需要 dataId 的部分即可。如果需要加载多个配置文件，使用逗号(,)分隔，加载多个配置文件通用配置特别有用，避免了在多个地方管理配置文件。</p>
<p>通过 load 加载的配置文件会进入 <code>Solon.cfg()</code> 成为应用配置，这样就可以通过 <code>@Injtect</code> 的方式进行注入。</p>
<p>以下是一份更详细的配置，内容来自官网 <a target="_blank" rel="noopener" href="https://solon.noear.org/article/400">https://solon.noear.org/article/400</a> ，可以根据实际的需要进行配置。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">solon.app:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">&quot;demoapp&quot;</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">&quot;demo&quot;</span></span><br><span class="line">  <span class="attr">meta:</span>                   <span class="comment">#添加应用元信息（可选）</span></span><br><span class="line">    <span class="attr">version:</span> <span class="string">&quot;v1.0.2&quot;</span> </span><br><span class="line">    <span class="attr">author:</span> <span class="string">&quot;noear&quot;</span></span><br><span class="line">  <span class="attr">tags:</span> <span class="string">&quot;aaa,bbb,ccc&quot;</span>     <span class="comment">#添加应用标签（可选）</span></span><br><span class="line"></span><br><span class="line"><span class="attr">solon.cloud.nacos:</span></span><br><span class="line">  <span class="attr">server:</span> <span class="string">&quot;localhost:8848,localhost:8847&quot;</span>  <span class="comment">#nacos 服务地址</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">&quot;3887EBC8-CD24-4BF7-BACF-58643397C138&quot;</span> <span class="comment">#nacos 命名空间</span></span><br><span class="line">  <span class="attr">contextPath:</span> <span class="string">&quot;nacosx&quot;</span>                    <span class="comment">#nacos 服务的上下文路径（可选）</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">&quot;aaa&quot;</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">&quot;bbb&quot;</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">load:</span> <span class="string">&quot;demoapp.yml,group:test.yml&quot;</span>                <span class="comment">#加载配置到应用属性（多个以&quot;,&quot;隔开）</span></span><br><span class="line">  <span class="attr">discovery:</span></span><br><span class="line">    <span class="attr">clusterName:</span> <span class="string">&quot;DEFAULT&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="获取配置"><a href="#获取配置" class="headerlink" title="获取配置"></a>获取配置</h3><p>使用 nacos 的配置是期望获取统一的，动态的配置，所以这里开启自动刷新 <code>autoRefreshed = true</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.solon.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Inject;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Inject(value = &quot;$&#123;app&#125;&quot;, autoRefreshed = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String appId;</span><br><span class="line">  <span class="keyword">private</span> String appKey;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来就是通过 <code>@Injtect</code> 的方式进行注入使用对应的配置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api(&quot;配置管理&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Mapping(&quot;/config&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> AppConfig appConfig;</span><br><span class="line"> </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取配置文件"><a href="#获取配置文件" class="headerlink" title="获取配置文件"></a>获取配置文件</h3><p>获取配置文件根据 dataId 获取配置，通过 <code>@CloudConfig</code> 进行注入。CloudConfig 暂时不支持注解的类上，也就是不能使用如下的方法配合 @Inject 进行注入。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.solon.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.cloud.annotation.CloudConfig;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过类获取dataId的配置，暂不支持的。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@CloudConfig(value = &quot;demo-db&quot;, autoRefreshed = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoDbConfig</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String url;</span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Inject 暂时暂时不到值的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api(&quot;配置管理&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Mapping(&quot;/config&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoController</span> </span>&#123;</span><br><span class="line">  <span class="comment">/** 获取dataId的配置，获取不到值 */</span></span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> DemoDbConfig demoDbConfig;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>正确的方式是，把 CloudConfig 注解在属性上。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoController</span> </span>&#123;</span><br><span class="line">  <span class="comment">/** 获取dataId的配置，获取不到值 */</span></span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> DemoDbConfig demoDbConfig;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> AppConfig appConfig;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@CloudConfig(value = &quot;demo-db&quot;, autoRefreshed = true)</span></span><br><span class="line">  <span class="keyword">private</span> Properties properties;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@CloudConfig(value = &quot;demo-db&quot;, autoRefreshed = true)</span></span><br><span class="line">  <span class="keyword">private</span> DemoDbConfig demoDbConfig2;</span><br><span class="line"> </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><p>通过 Swagger 测试可以正常获取到配置，并且修改 Nacos 的配置后，再次调用接口配置会更新（这里没有截图）。</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=NzVhYWRhZDAwYjQ1ODZiYWJlMGU2MGE2Y2RiOGI1OWJfVjBzOWx2SDdVaGI5eHptcUxiTGRXRkVsTGRyOU1FSVpfVG9rZW46S25tcGJQQ0lpb2VWaDd4dk5tUmNkVE9Rbm1iXzE3NDAxOTQ2MjU6MTc0MDE5ODIyNV9WNA" alt="img"></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>在 Solon Cloud 中通过简单的配置就可以使用 Nacos 配置中心了。在实际的使用过程中注意区分@Inject 和@CloudConfig 的不同，一个是针对key来的，一个是针对dataId来的。为了减少自己在开发过程中的混乱（有时过多的选择不是一件好事情），可以约定使用 load 的方式加载多个配置文件，使用 @Inject 的方式进行注入后使用。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2025/02/21/course100/028/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/21/course100/028/" class="post-title-link" itemprop="url">Solon Cloud —— 介绍</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-02-21 21:50:36" itemprop="dateCreated datePublished" datetime="2025-02-21T21:50:36+08:00">2025-02-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-02-22 11:23:02" itemprop="dateModified" datetime="2025-02-22T11:23:02+08:00">2025-02-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/" itemprop="url" rel="index"><span itemprop="name">教程100</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">写作</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/" itemprop="url" rel="index"><span itemprop="name">Solon</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/Solon-%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Solon 实用教程</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>前面的章节，我们讲解了 Solon 的开发应用，接下来准备讲解 Solon Cloud 的的开发。Solon Cloud 是为微服务和云原生准备的分布式开发套件。</p>
<h2 id="微服务"><a href="#微服务" class="headerlink" title="微服务"></a>微服务</h2><p>就像 MVC 一样，对于微服务的理解也是有不同的。微服务是一组协调工作的小而自治的服务。微服务是一组分布式的架构框架。</p>
<p>微服务有支持异构，弹性，易扩展，容易替换等优点，但也增加了开发、测试、部署、运维的复杂性。</p>
<h2 id="云原生"><a href="#云原生" class="headerlink" title="云原生"></a>云原生</h2><p>为了解决微服务（或者系统）的开发、部署、运维的复杂性，CNCF （Cloud Native Computing Foudation）提出了云原生的概念，就是利用各组织在共有云、私有云和混合云等新型动态环境中，构建和运行可弹性扩展的应用。主要涉及DevOps，CI/CD，Micro Service，Contianer等四个大的方面。</p>
<h2 id="Solon-Cloud"><a href="#Solon-Cloud" class="headerlink" title="Solon Cloud"></a>Solon Cloud</h2><p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=MjUxZDZmMjRiMmJmOGYzNzAyMTI0ZjU2M2E5OTZmZmRfcmNhUEJsRng3SnBpZ0N0TUw4TUpGRjI0TWljUU5jYThfVG9rZW46VE9zMmJtcktKbzVYQXJ4ZEJ3TWM0NHVLbjFiXzE3NDAxNDYyODI6MTc0MDE0OTg4Ml9WNA" alt="img"></p>
<p>从上图，我们可以看到 Solon Cloud 的主要组成部分：</p>
<ul>
<li>Solon Cloud Gateway 分布式网关相关插件</li>
<li>Solon Cloud Config 分布式配置相关插件</li>
<li>Solon Cloud Discovery 分布式注册与发现相关插件</li>
<li>Solon Cloud Event 分布式时间总线相关插件</li>
<li>Solon Cloud Job 分布式任务调度插件</li>
<li>Solon Cloud File 分布式文件插件</li>
<li>Solon Cloud Log 分布式日志插件</li>
<li>Solon Cloud Trace 分布式跟踪插件</li>
<li>Solon Cloud Metrics 分布式监控插件</li>
<li>Solon Cloud Breaker 分布式熔断插件</li>
<li>Solon Cloud Id 分布式 ID 插件</li>
<li>Solon Cloud I18n 分布式国际化配置插件</li>
<li>Solon Cloud List 分布式名单，白名单、黑名单等</li>
<li>Solon Cloud Lock 分布式锁插件</li>
</ul>
<p>我们可以看到Solon Cloud 其实是定义了一组接口规范，在这个接口规范的基础上实现不同分布式组件的插件。</p>
<p>在 Solon 的官网中也对分布式设计做了引导，我这里列出重点的部分，详细内容可查看官网 <a target="_blank" rel="noopener" href="https://solon.noear.org/article/638%E3%80%82">https://solon.noear.org/article/638。</a></p>
<ol>
<li>构建可水平扩展的计算能力<ol>
<li>服务无状态</li>
<li>服务透明化</li>
<li>容器弹性伸缩</li>
</ol>
</li>
<li>构建可水平扩展的业务能力<ol>
<li>基于业务领域拆分微服务</li>
<li>拆分业务的主线与辅线</li>
<li>基于实现总线交互</li>
</ol>
</li>
</ol>
<h2 id="书籍推荐"><a href="#书籍推荐" class="headerlink" title="书籍推荐"></a>书籍推荐</h2><h3 id="《微服务架构设计模式》"><a href="#《微服务架构设计模式》" class="headerlink" title="《微服务架构设计模式》"></a>《微服务架构设计模式》</h3><p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=NWI2NWJkYmVmMTM5MTk4ODIxZWU4NDJjNjllMDM1OTFfRlF5WnB4UHFTUXFhN0hGMzcyeUl3T0wycThIQWUxRnBfVG9rZW46WjZYOGJldHY5bzRLOUt4N2xoSmNhVk01bkhkXzE3NDAxNDYyODI6MTc0MDE0OTg4Ml9WNA" alt="img"></p>
<h3 id="《微服务设计》"><a href="#《微服务设计》" class="headerlink" title="《微服务设计》"></a>《微服务设计》</h3><p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=ZTlmNjA0NzViNzc3N2Q3ODY3ODIzYmZkMTU4MDgwNmZfdUJvWU5YRzNqTVlPYVNLMkNRdXNMeU1mNVRKSVFmbjZfVG9rZW46Q0JlUmJaazdFbzdpNWJ4OGxsVmN0SjhrbnhWXzE3NDAxNDYyODI6MTc0MDE0OTg4Ml9WNA" alt="img"></p>
<h3 id="The-Twelve-factor-App"><a href="#The-Twelve-factor-App" class="headerlink" title="The Twelve-factor App"></a>The Twelve-factor App</h3><p><a target="_blank" rel="noopener" href="https://12factor.net/">https://12factor.net/</a></p>
<h2 id="技术栈"><a href="#技术栈" class="headerlink" title="技术栈"></a>技术栈</h2><p>在本教程的介绍中说到，本教程更面向使用，因此会限制技术栈，对于Solon Cloud 的使用也是一样的，基础的服务：</p>
<ul>
<li>Nacos2 配置管理、服务发现。</li>
<li>Redis，分布式 ID，分布式锁等。</li>
<li>Skywalking，链路跟踪。</li>
<li>Kafka 消息服务。</li>
<li>Sentinel 熔断</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2025/02/20/course100/027/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/20/course100/027/" class="post-title-link" itemprop="url">Solon —— 插件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-02-20 20:13:23 / 修改时间：20:18:52" itemprop="dateCreated datePublished" datetime="2025-02-20T20:13:23+08:00">2025-02-20</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/" itemprop="url" rel="index"><span itemprop="name">教程100</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">写作</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/" itemprop="url" rel="index"><span itemprop="name">Solon</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/Solon-%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Solon 实用教程</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>Solon 是典型的微内核架构，通过框架核心提供了插件的核心接口和生命周期的管理。在之前的应用的生命周期中讲到过插件的三个生命时机点。通过这三个时机点，插件开发人员可以管理插件的资源初始化与资源的销毁。</p>
<p>Solon 的插件支持三种形式的运行方式：</p>
<ol>
<li>Spi 方式。是基于插件和配置声明的扩展方式，类似Spring Factories，主应用需要增加对插件的依赖。</li>
<li>E-Spi 方式，也叫体外扩展。是基于插件和动态配置的扩展方式，类似Springboot-plugin-fraework，主程序不需要增加对插件的依赖。</li>
<li>H-Spi 方式，也叫热插拔扩展。是基于插件和手动管理的扩展方式，类似Springboot-plugin-fraework，主程序不需要增加对插件的依赖。</li>
</ol>
<p>这三种扩展方式对于开发插件本身没有什么区别，主要的区别是主应用的依赖和配置等，和实现的效果的不同，具体的特性对比可以参看官网 <a target="_blank" rel="noopener" href="https://solon.noear.org/article/441">https://solon.noear.org/article/441</a> 相关的文章。</p>
<p>插件涉及的示例代码包含多个模块，具体参看 <a target="_blank" rel="noopener" href="https://gitee.com/CrazyAirhead/porpoise-demo%EF%BC%9A">https://gitee.com/CrazyAirhead/porpoise-demo：</a></p>
<ul>
<li>demo-solon03-plugin Solon 插件</li>
<li>demo-solon03-main01 Solon 主应用 Spi</li>
<li>demo-solon03-main02 Solon 主应用 E-Spi</li>
<li>demo-solon03-main03 Solon 主应用 H-Spi</li>
</ul>
<h2 id="插件-demo-solon03-plugin"><a href="#插件-demo-solon03-plugin" class="headerlink" title="插件 demo-solon03-plugin"></a>插件 demo-solon03-plugin</h2><p>实现  hello 的基础功能。</p>
<h3 id="实现-Plugin-接口"><a href="#实现-Plugin-接口" class="headerlink" title="实现 Plugin 接口"></a>实现 Plugin 接口</h3><p>这里为了简单，直接扫描了插件包的 Bean 对象，在实际的开发过程中可根据实际的实现使用Conetext的其他方法构建 Bean，或者订阅 Bean，或者加载配置文件等，来完成实际的插件初始化操作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.solon.plugin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.AppContext;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.Plugin;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoSolonPlugin</span> <span class="keyword">implements</span> <span class="title">Plugin</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">(AppContext context)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    <span class="comment">// 简单起见，直接扫描插件所在包，可以根据实际的需要进行定制化的加载</span></span><br><span class="line">    context.beanScan(DemoSolonPlugin.class);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prestop</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    Plugin.<span class="keyword">super</span>.prestop();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    <span class="comment">// 移除http处理。在热插拔的插件中特别</span></span><br><span class="line">    Solon.app().router().remove(<span class="string">&quot;/hello&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现-Controller"><a href="#实现-Controller" class="headerlink" title="实现 Controller"></a>实现 Controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.solon.plugin.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Controller;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Mapping;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Param;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Mapping(&quot;/hello&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(<span class="meta">@Param(defaultValue = &quot;world&quot;)</span> String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> String.format(<span class="string">&quot;Hello %s!&quot;</span>, name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置插件文件"><a href="#配置插件文件" class="headerlink" title="配置插件文件"></a>配置插件文件</h3><p>在 <code>resources/META-INF/solon/</code> 目录下创建插件配置文件，文件名要在应用范围内全局唯一，为了避免冲突可以使用插件的包名做了文件名。</p>
<p>这里使用是<code>META-INF/solon/com-example-demo-solon-plugin.properties</code>，文件内容如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 插件实现类</span></span><br><span class="line"><span class="meta">solon.plugin</span>=<span class="string">com.jishunetwork.ficus.framework.server.XPluginImp</span></span><br><span class="line"><span class="comment"># 插件加载优先级，越大越优先，默认为0</span></span><br><span class="line"><span class="meta">solon.plugin.priority</span>=<span class="string">1</span></span><br></pre></td></tr></table></figure>

<p>这里常见的问题：文件目录错误，注解检查是二级目录，目录名是<code>/META-INF/solon/</code>；插件的实现类写错，可以通过点击的方式看下能否正常跳转到对应的类上来验证配置是否正确。</p>
<h2 id="Spi-demo-solon03-main01"><a href="#Spi-demo-solon03-main01" class="headerlink" title="Spi demo-solon03-main01"></a>Spi demo-solon03-main01</h2><p>只要添加对应的依赖即可不需要其他额外的配置。</p>
<h3 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation platform(project(<span class="string">&quot;:demo-parent&quot;</span>))</span><br><span class="line"></span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-web&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-logging-logback&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-openapi2-knife4j&quot;</span>)</span><br><span class="line">    implementation(project(<span class="string">&quot;:demo-solon03-plugin&quot;</span>))</span><br><span class="line"></span><br><span class="line">    annotationProcessor(<span class="string">&quot;org.mapstruct:mapstruct-processor:$&#123;mapstructVersion&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    testImplementation(<span class="string">&quot;org.noear:solon-test-junit5&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p>调用插件实现的接口，<a target="_blank" rel="noopener" href="http://127.0.0.1:8080/hello%EF%BC%8C%E8%BF%94%E5%9B%9Ehello">http://127.0.0.1:8080/hello，返回hello</a> world!</p>
<h2 id="E-Spi-demo-solon03-main02"><a href="#E-Spi-demo-solon03-main02" class="headerlink" title="E-Spi demo-solon03-main02"></a>E-Spi demo-solon03-main02</h2><p>只要添加修改配置，把插件放入指定文件夹路径即可。</p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>此时把插件目录放在jar相对路径的plugin下。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">solon.extend:</span> <span class="string">&quot;!plugin&quot;</span></span><br></pre></td></tr></table></figure>

<p>注意：在idea中可能一下不能区分plugin再那个目录，可以先运行一次让 Solon 把目录创建出来，然后再把插件放到 plugin 目录下，此时我们可以看到是在<code> build/classes/java/main</code> 目录下。把demo-solon03-plugin的插件放入plugin 目录后重新启动程序（注意此时不能再clean了，否则 刚放入的文件又被清理了）。</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=NWY1NjY2YmI5MDRjNDY1ZWM0NWFmMjFhZjg1MWUxNTRfUTI3RmZpSklvM2pIS2pUaU5XNm0xR3FBVDl4MDF0eFRfVG9rZW46QnN5amIwTnV2bzRjMWF4MXR1SmMzbFhNbjFiXzE3NDAwNTM2NTQ6MTc0MDA1NzI1NF9WNA" alt="img"></p>
<h3 id="验证-1"><a href="#验证-1" class="headerlink" title="验证"></a>验证</h3><p>调用插件实现的接口，<a target="_blank" rel="noopener" href="http://127.0.0.1:8080/hello%EF%BC%8C%E8%BF%94%E5%9B%9Ehello">http://127.0.0.1:8080/hello，返回hello</a> world!</p>
<h2 id="H-Spi-demo-solon03-main03"><a href="#H-Spi-demo-solon03-main03" class="headerlink" title="H-Spi demo-solon03-main03"></a>H-Spi demo-solon03-main03</h2><p>热插拔的就是允许应用可以更灵活的管理插件的生命周期，因为热插拔是完全隔离的，因此需要自己更严格的管理资源的，更独立，避免与别的组件交互，避免不可拔的情况。</p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation platform(project(<span class="string">&quot;:demo-parent&quot;</span>))</span><br><span class="line"></span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-web&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-logging-logback&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-openapi2-knife4j&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;org.noear:solon-hotplug&quot;</span>)</span><br><span class="line"></span><br><span class="line">    annotationProcessor(<span class="string">&quot;org.mapstruct:mapstruct-processor:$&#123;mapstructVersion&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    testImplementation(<span class="string">&quot;org.noear:solon-test-junit5&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h3><p>这里使用 Solon 默认提供的配置来管理，在加载的插件的过程中，只要能找到插件就可以了，不一定需要使用这个配置，注意路径是绝对路径。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">solon.hotplug:</span></span><br><span class="line">  <span class="attr">demo:</span> <span class="string">/plugin/demo-solon03-plugin-1.0.0.jar</span></span><br></pre></td></tr></table></figure>

<h3 id="实现管理"><a href="#实现管理" class="headerlink" title="实现管理"></a>实现管理</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.solon.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Controller;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Mapping;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.hotplug.PluginManager;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PluginController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Mapping(&quot;start&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    PluginManager.start(<span class="string">&quot;demo&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(&quot;stop&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">stop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    PluginManager.stop(<span class="string">&quot;demo&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="验证-2"><a href="#验证-2" class="headerlink" title="验证"></a>验证</h3><ol>
<li>调用插件实现的接口，<a target="_blank" rel="noopener" href="http://127.0.0.1:8080/hello%EF%BC%8C%E6%AD%A4%E6%97%B6%E4%B8%8D%E5%8F%AF%E8%AE%BF%E9%97%AE">http://127.0.0.1:8080/hello，此时不可访问</a></li>
<li>调用启动插件接口，<a target="_blank" rel="noopener" href="http://127.0.0.1:8080/start%EF%BC%8C%E8%BF%94%E5%9B%9Eok">http://127.0.0.1:8080/start，返回ok</a></li>
<li>调用插件实现的接口，<a target="_blank" rel="noopener" href="http://127.0.0.1:8080/hello%EF%BC%8C%E6%AD%A4%E6%97%B6%E8%BF%94%E5%9B%9E">http://127.0.0.1:8080/hello，此时返回</a> hello world</li>
<li>调用停止插件接口，<a target="_blank" rel="noopener" href="http://127.0.0.1:8080/stop%EF%BC%8C%E8%BF%94%E5%9B%9Eok">http://127.0.0.1:8080/stop，返回ok</a></li>
<li>调用插件实现的接口，<a target="_blank" rel="noopener" href="http://127.0.0.1:8080/hello%EF%BC%8C%E6%AD%A4%E6%97%B6%E4%B8%8D%E5%8F%AF%E8%AE%BF%E9%97%AE">http://127.0.0.1:8080/hello，此时不可访问</a></li>
</ol>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>通过 Solon 提供的插件机制能简单、弹性、自由的实现功能扩展，既可以做框架型的插件开发，也可以做业务性的插件开发。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2025/02/19/course100/026/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/19/course100/026/" class="post-title-link" itemprop="url">Solon —— 容器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-02-19 22:46:49 / 修改时间：22:48:20" itemprop="dateCreated datePublished" datetime="2025-02-19T22:46:49+08:00">2025-02-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/" itemprop="url" rel="index"><span itemprop="name">教程100</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">写作</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/" itemprop="url" rel="index"><span itemprop="name">Solon</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/Solon-%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Solon 实用教程</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>Solon 的核心概念有 IoC、AOP 和本地事件总线。有人常常有误解以为 IoC 和 AOP 是 Spring 提出的，其实这两种思想在Spring 之前就已经有了，但 Spring 把这两个思想在技术上落地和推广做得很好，让 Ioc 和 AOP 广为人知。</p>
<h2 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h2><h3 id="IoC"><a href="#IoC" class="headerlink" title="IoC"></a>IoC</h3><p>Ioc 的全称是 Inversion of Control，是控制反转或者反转控制的意思。它是一种思想，主要解决的是对象创建和管理的问题，用于解耦依赖。Ioc有时也被称为 DI （Dependency Injection），依赖注入。在使用 IoC 的过程中，我们是通过容器来创建和管理对象的，我们也是从容器中获取对象，所以，有时我们会听到 IoC 就是容器的说法，可能只是简化的一种说法。</p>
<h3 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h3><p>AOP， 全称 Aspect Oriented Programming，是面向切面编程。AOP 的目的是将横切关注点（如日志记录、事务管理、权限控制、接口限流、接口幂等等）从核心业务逻辑中分离出来，通过动态代理、字节码操作等技术，实现代码的复用和解耦，提高代码的可维护性和可扩展性。其中涉及的核心有代理，切点，切面。</p>
<h3 id="本地事件总线"><a href="#本地事件总线" class="headerlink" title="本地事件总线"></a>本地事件总线</h3><p>本地事件总线是 Solon 在应用生命周期提供的扩展机制，应用可以根据需要的事件时机点，订阅响应的事件。本地事件总线支持自定义的事件。</p>
<p>注意：</p>
<ol>
<li>本地事件总线是基于应用生命周期的（应用的启停，插件的启停，bean 创建等），而不是基于业务，如果是涉及业务，可以使用使用作者的另一个作品 DamiBus。</li>
<li>要在事件发生前订阅事件，否则会错过时机，无法接收到事件消息。</li>
</ol>
<h2 id="应用生命周期"><a href="#应用生命周期" class="headerlink" title="应用生命周期"></a>应用生命周期</h2><p>应用生命周期，是应用程序从 启动到最后停止的整个过程。应用生命周期当中存在一些关键点，可称为时机点。</p>
<p>SolonApp 的应用生命周期如下图所示，其中时机点包括有：一个初始化函数时机点 + 六个应用事件时机点 + 三个插件生命时机点 + 两个容器生命时机点。</p>
<p>作者的这张图画的很细致，一步步的把这个图走完，能加深对 Solon 的理解。</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=YzEwOWMxN2RlZjZhZDdhNjEyYTU4YjBmNGM0MjBlNzZfS2xQRTJaWEZZbGlNaVU5Q3VNM0lwakpncUs0R0dUMDZfVG9rZW46SjBNRmJrc3I4b05KbGp4ZGUzZ2NsS01qblRjXzE3Mzk5NzY0NDk6MTczOTk4MDA0OV9WNA" alt="img"></p>
<h3 id="一个初始化函数时机点"><a href="#一个初始化函数时机点" class="headerlink" title="一个初始化函数时机点"></a>一个初始化函数时机点</h3><p>应用开发时可扩展的时机。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SolonMain</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Solon.start(App.class, args, (app) -&gt; &#123;</span><br><span class="line">            <span class="comment">//应用初始化时机点</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="六个应用事件时机点"><a href="#六个应用事件时机点" class="headerlink" title="六个应用事件时机点"></a>六个应用事件时机点</h3><p>应用开发时可扩展的时机。</p>
<table>
<thead>
<tr>
<th>事件</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>6.AppInitEndEvent</td>
<td>应用初始化完成事件</td>
<td>只支持手动订阅</td>
</tr>
<tr>
<td>8.AppPluginLoadEndEvent</td>
<td>应用插件加载完成事件</td>
<td>只支持手动订阅</td>
</tr>
<tr>
<td>b.AppBeanLoadEndEvent</td>
<td>应用Bean加载完成事件（即扫描完成）</td>
<td></td>
</tr>
<tr>
<td>e.AppLoadEndEvent</td>
<td>应用加载完成事件（即启动完成）</td>
<td></td>
</tr>
<tr>
<td></td>
<td>::运行</td>
<td></td>
</tr>
<tr>
<td>g.AppPrestopEndEvent</td>
<td>应用预停止事件</td>
<td></td>
</tr>
<tr>
<td>j.AppStopEndEvent</td>
<td>应用停止事件</td>
<td></td>
</tr>
</tbody></table>
<h3 id="三个插件生命时机点"><a href="#三个插件生命时机点" class="headerlink" title="三个插件生命时机点"></a>三个插件生命时机点</h3><p>插件开发时可扩展的时机。</p>
<table>
<thead>
<tr>
<th>接口</th>
<th>执行时机</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>7.start</td>
<td>在应用初始化完成后执行</td>
<td>启动</td>
</tr>
<tr>
<td>f.prestop</td>
<td>在 ::stop 前执行</td>
<td>预停止</td>
</tr>
<tr>
<td>h.stop</td>
<td>在 Solon::stop 时执行</td>
<td>停止（启用安全停止时，prestop 后等几秒再执行 stop）</td>
</tr>
</tbody></table>
<h3 id="两个容器生命时机点"><a href="#两个容器生命时机点" class="headerlink" title="两个容器生命时机点"></a>两个容器生命时机点</h3><p>Solon 内部的时机点，应用开发不可扩展。</p>
<table>
<thead>
<tr>
<th>接口</th>
<th>执行时机</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>d.start</td>
<td>在扫描完成之后执行</td>
<td>启动</td>
</tr>
<tr>
<td>i.stop</td>
<td>在 Solon::stop 时执行，在插件（h.stop）后执行</td>
<td>停止</td>
</tr>
</tbody></table>
<h2 id="Bean-生命周期"><a href="#Bean-生命周期" class="headerlink" title="Bean 生命周期"></a>Bean 生命周期</h2><p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDk4YjliYzk4OGEzMzkxZjM3MjlhMDdhMjIwM2Y3YjJfTzZzdEFmc0wyRVc3d1JRaGNqNWVydFlVNnA2MkdDMjdfVG9rZW46VTlRV2JpTkREb011Rlp4UjZKR2NhdHJlbmloXzE3Mzk5NzY0NDk6MTczOTk4MDA0OV9WNA" alt="img"></p>
<p>被容器托管的 Bean，它的生命周期只限定在容器内部。</p>
<h4 id="new"><a href="#new" class="headerlink" title="::new()"></a>::new()</h4><p>就是调用构造函数，是在 Bean 被扫描时，且符合条件才会执行。</p>
<p>注意，这个时候，Bean 还注册到容器中，还不能使用注入的字段（还未注入）。如果要初始化，推荐使用<code>@Init</code> 函数。</p>
<h4 id="Inject"><a href="#Inject" class="headerlink" title="@Inject"></a>@Inject</h4><p>开始执行注入。之后就会注册到容器，并通知订阅者。</p>
<h4 id="start-或-Init"><a href="#start-或-Init" class="headerlink" title="start() 或 @Init"></a>start() 或 @Init</h4><p>执行初始化动作，在 AppContext::start() 开始处被执行。如果使用 start() 需要实现 LifecycleBean 接口。此时 Bean 扫描已完成，理论上所有的 Bean 都已进入容器（某些特殊的 Bean 是在 AppContext.start() 时才生产的），并且所有 Bean 的字段都已完成注入。</p>
<h4 id="postStart"><a href="#postStart" class="headerlink" title="postStart()"></a>postStart()</h4><p>开始之后，AppContext::start() 结束处被执行，一般用于启动一些任务。如果使用 postStart() 需要实现 LifecycleBean 接口。</p>
<h4 id="preStop"><a href="#preStop" class="headerlink" title="preStop()"></a>preStop()</h4><p>预停止，AppContext::preStop() 时被执行。一般用来做分布式服务注销之类。如果使用 preStop() 需要实现 LifecycleBean 接口。</p>
<h4 id="stop-或-Destroy"><a href="#stop-或-Destroy" class="headerlink" title="stop() 或 @Destroy"></a>stop() 或 @Destroy</h4><p>停止，AppContext::stop() 时被执行。一般用来做安全停止。如果使用 stop() 需要实现 LifecycleBean 接口。</p>
<h2 id="容器应用"><a href="#容器应用" class="headerlink" title="容器应用"></a>容器应用</h2><p>在 Solon 中，我们可以自由的选择用注解的方式，还是手动的方式来实现想要的功能。但在这里我们主要讲解注解的使用方式。</p>
<h3 id="扫描"><a href="#扫描" class="headerlink" title="扫描"></a>扫描</h3><p>扫描一般是深度遍历指定“包名”下的 <code>.class</code> 文件获取类名，再通过类名从类加载器里获取元信息。</p>
<p>默认情况下，主类所在包名新的类都会扫描。如果需要修改导入的范围可以使用 @Import 注解，增加扫描的包名，或者导入需要的类名。</p>
<h3 id="构建-注入"><a href="#构建-注入" class="headerlink" title="构建 / 注入"></a>构建 / 注入</h3><p>在 Solon 中，我们通过Singleton，Configuration，Bean，Component，Controller，Remoting等方式产生Bean，在Bean 对象中，我们可以 @Inject 注解注入字段。在构建和注入中需要注意的可能是条件构建和依赖注入的部分了。</p>
<table>
<thead>
<tr>
<th>注解</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>@Inject *</td>
<td>注入托管对象（by type）</td>
</tr>
<tr>
<td>@Inject(“name”)</td>
<td>注入托管对象（by name）</td>
</tr>
<tr>
<td>@Inject(“${name}”)</td>
<td>注入配置（可由基础类型或结构体接收）</td>
</tr>
<tr>
<td>@Singleton</td>
<td>单例申明（Solon 默认是单例）</td>
</tr>
<tr>
<td>@Singleton(false)</td>
<td>非单例</td>
</tr>
<tr>
<td>@Configuration</td>
<td>托管配置组件类（与 @Inject, @Bean 共同完成初始化配置、构建托管对象等）</td>
</tr>
<tr>
<td>@Bean</td>
<td>配置托管对象（作用在 @Configuration 类的函数上，才有效）</td>
</tr>
<tr>
<td>@Component</td>
<td>托管组件（支持自动代理，v2.5.2 开始支持自动代理）</td>
</tr>
<tr>
<td>@Controller</td>
<td>控制器组件类（支持函数拦截）</td>
</tr>
<tr>
<td>@Remoting</td>
<td>远程控制器类（有类代理；即RPC服务端）</td>
</tr>
</tbody></table>
<h4 id="条件构建"><a href="#条件构建" class="headerlink" title="条件构建"></a>条件构建</h4><p>条件构建的意思是满足了指定条件才会构建。通过使用 @Condition 来实现，它包含如下的属性：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>onClass</td>
<td>有类（只能一个；其实没必要多个）</td>
</tr>
<tr>
<td>onClassName</td>
<td>有类名</td>
</tr>
<tr>
<td>onProperty</td>
<td>有属性</td>
</tr>
<tr>
<td>onMissingBean</td>
<td>没有 Bean</td>
</tr>
<tr>
<td>onMissingBeanName</td>
<td>没有 Bean Name</td>
</tr>
<tr>
<td>onBean</td>
<td>有 Bean</td>
</tr>
<tr>
<td>onBeanName</td>
<td>有 Bean Name</td>
</tr>
</tbody></table>
<p>更多细节，查看官网 <a target="_blank" rel="noopener" href="https://solon.noear.org/article/434">https://solon.noear.org/article/434</a> 。</p>
<h4 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h4><p>依赖注入的意思是，在构建时需要使用到其他 Bean 对象。依赖注入通常使用@Configuration，配合@Bean 来实现，其中 @Bean 的函数通过参数注入的方式来获取需要的 Bean 对象。另外就是使用手动模式通过异步订阅的方式获取依赖的 Bean 对象。</p>
<p>以下注入的例子来自官网，更多细节，查看官网 <a target="_blank" rel="noopener" href="https://solon.noear.org/article/587">https://solon.noear.org/article/587</a> 。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean(name=&quot;db1&quot;, typed=true)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">db1</span><span class="params">(<span class="meta">@Inject(&quot;$&#123;demo.db1&#125;&quot;)</span> DataSource ds)</span></span>&#123; </span><br><span class="line">        <span class="keyword">return</span> ds;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">db1Test</span><span class="params">(<span class="meta">@Db(&quot;db1&quot;)</span> UserMapper mapper)</span> </span>&#123; <span class="comment">//这个注入，依赖“db1”的数据源</span></span><br><span class="line">        <span class="keyword">return</span> mapper.initUsers();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2025/02/18/course100/025/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/18/course100/025/" class="post-title-link" itemprop="url">Solon —— 配置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-02-18 19:54:02 / 修改时间：19:59:06" itemprop="dateCreated datePublished" datetime="2025-02-18T19:54:02+08:00">2025-02-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/" itemprop="url" rel="index"><span itemprop="name">教程100</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">写作</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/" itemprop="url" rel="index"><span itemprop="name">Solon</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/Solon-%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Solon 实用教程</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>Spring Boot 流行起来的一个原因是简化了配置，其中约定优于配置减少了开发者的配置负担，无需配置或者少量的配置就可以启动项目；自动化配置根据项目依赖自动配置应用程序，简化了开发流程。Solon 作为后起之秀也是采用了约定优于配置和自动配置的方式来简化配置。</p>
<h2 id="约定"><a href="#约定" class="headerlink" title="约定"></a>约定</h2><h3 id="配置分类"><a href="#配置分类" class="headerlink" title="配置分类"></a>配置分类</h3><h4 id="启动参数"><a href="#启动参数" class="headerlink" title="启动参数"></a>启动参数</h4><p>启动参数，在应用启动后会被静态化，也就是不能再修改。在Java 启动时指定，通过<code>--key=value</code>的形式指定。</p>
<h4 id="系统属性"><a href="#系统属性" class="headerlink" title="系统属性"></a>系统属性</h4><p>系统属性，在应用启动后会被静态化，也就是不能再修改。在Java 启动时指定，通过<code>-Dkey=value</code>的形式指定。</p>
<h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><p>操作系统的环境变量。”solon” 开头的环境变量，会被框架同步到系统属性（System::getProperties）与应用属性（Solon::cfg）。</p>
<h4 id="应用配置"><a href="#应用配置" class="headerlink" title="应用配置"></a>应用配置</h4><p>应用通过配置文件加载进来的配置。</p>
<h3 id="主配置文件"><a href="#主配置文件" class="headerlink" title="主配置文件"></a>主配置文件</h3><p>应用配置文件为 <code>resources/app.yml</code> 或者 <code>app.properties</code>，文件名不能修改也不能配置。</p>
<h3 id="配置加载规则"><a href="#配置加载规则" class="headerlink" title="配置加载规则"></a>配置加载规则</h3><p>应用配置的加载主要分了六个层级，其加载规则为：</p>
<ul>
<li>越静态的越前面</li>
<li>越动态的越后面</li>
</ul>
<p>因为配置是以“键”为单位，且后面加载的会盖掉前面加载的，所以最终效果就是配置以最后加载为准。</p>
<p>加载顺序为：</p>
<ol>
<li>主配置文件，先是主配置文件（app.yml），之后是带环境的主配置（app-{env}.yml）,这里不特别区分（yml或者properties）。</li>
<li>内部配置文件，通过 <code>solon.config.load</code>加载的 <code>classpath</code> 目录下的配置文件。</li>
<li>外部配置文件，通过 <code>solon.config.add</code> 加载的配置文件。</li>
<li>动态配置，启动应用时的配置，先是启动参数（–key=value），之后是系统属性（-Dkey=value），最后是环境变量（系统环境设置，或者docker -e 等方式指定）</li>
<li>启动时加载，通过 <code>app.cfg().loadAdd</code> 或者 <code>app.cfg().loadEnv</code>加载。</li>
<li>云端配置，通过分布式配置获取，如nacos。</li>
</ol>
<h3 id="配置引用规则"><a href="#配置引用规则" class="headerlink" title="配置引用规则"></a>配置引用规则</h3><p>配置文件（或配置块）解析时，Solon.cfg() 已经存在的变量（或者配置块内的变量），可以被引用。属性之间的引用，使用 <code>$&#123;...&#125;</code>：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">test.demo1:</span> <span class="string">&quot;$&#123;db1.url&#125;&quot;</span>                          <span class="comment">#引用应用属性</span></span><br><span class="line"><span class="attr">test.demo2:</span> <span class="string">&quot;jdbc:mysql:$&#123;db1.server&#125;&quot;</span>            <span class="comment">#引用应用属性并组合</span></span><br><span class="line"><span class="attr">test.demo3:</span> <span class="string">&quot;jdbc:mysql:$&#123;db1.server&#125;/$&#123;db1.db&#125;&quot;</span>  <span class="comment">#引用多个应用属性并组合</span></span><br><span class="line"><span class="attr">test.demo4:</span> <span class="string">&quot;$&#123;JAVA_HOME&#125;&quot;</span>                        <span class="comment">#引用环境变量test.demo5: &quot;$&#123;.demo4&#125;&quot;                           #引用本级其它变量（v2.9.0 后支持）</span></span><br></pre></td></tr></table></figure>

<h3 id="常用配置"><a href="#常用配置" class="headerlink" title="常用配置"></a>常用配置</h3><p>配置可能变更，所以直接看官网 <a target="_blank" rel="noopener" href="https://solon.noear.org/article/174">https://solon.noear.org/article/174</a> 。</p>
<h2 id="注入配置"><a href="#注入配置" class="headerlink" title="注入配置"></a>注入配置</h2><p>配置注入使用 <code>$&#123;...&#125;</code>的表达式，支持如下具体的配置：</p>
<ul>
<li><code>$&#123;xxx&#125;</code> 注入字段。</li>
<li><code>$&#123;xxx:def&#125;</code> 注入字段，如果没有则提供 def 默认值，此时只支持单值接收，不支持集合或实体。</li>
<li><code>$&#123;classpath:xxx.yml&#125;</code> 注入资源目录下的配置文件 xxx.xml</li>
</ul>
<h3 id="注入字段"><a href="#注入字段" class="headerlink" title="注入字段"></a>注入字段</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoService</span></span>&#123;</span><br><span class="line">    <span class="comment">//注入值（带默认值：demoApi），并开启自动更新（注意：如果不是单例，请不要开启自动刷新）</span></span><br><span class="line">    <span class="meta">@Inject(value=&quot;$&#123;track.name:demoApi&#125;&quot;, autoRefreshed=true)</span></span><br><span class="line">    <span class="keyword">static</span> String trackName; <span class="comment">//v3.0 后支持静态字段注入//注入值（没有时，不覆盖字段初始值）</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Inject(&quot;$&#123;track.url&#125;&quot;)</span></span><br><span class="line">    String trackUrl = <span class="string">&quot;http://x.x.x/track&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//注入配置集合</span></span><br><span class="line">    <span class="meta">@Inject(&quot;$&#123;track.db1&#125;&quot;)</span></span><br><span class="line">    Properties trackDbCfg;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//注入Bean（根据对应的配置集合自动生成并注入）</span></span><br><span class="line">    <span class="meta">@Inject(&quot;$&#123;track.db1&#125;&quot;)</span></span><br><span class="line">    HikariDataSource trackDs;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="注入类"><a href="#注入类" class="headerlink" title="注入类"></a>注入类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Inject(&quot;$&#123;user.config&#125;&quot;)</span>  </span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserProperties</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; tags;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@BindProps(prefix=&quot;user.config&quot;)</span>  <span class="comment">//或者用绑定属性注解。v3.0.7 后支持</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserProperties</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; tags;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@BindProps(prefix=&quot;user.config&quot;)</span> <span class="comment">//或者用绑定属性注解。v3.0.7 后支持</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserProperties <span class="title">userProperties</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UserProperties();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="注入参数"><a href="#注入参数" class="headerlink" title="注入参数"></a>注入参数</h3><p>当注入到参数的时候，不支持自动刷新。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configurationpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoConfig</span></span>&#123;</span><br><span class="line">    <span class="comment">//提示：@Bean 只能与 @Configuration 配合@Bean </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">db1</span><span class="params">(<span class="meta">@Inject(&quot;$&#123;track.db1&#125;&quot;)</span> HikariDataSource ds)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ds;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Beanpublic</span> <span class="function">DataSourceWrap <span class="title">db1w</span><span class="params">(<span class="meta">@Inject</span> DataSource ds, <span class="meta">@Inject(&quot;$&#123;wrap&#125;&quot;)</span> WrapConfig wc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DataSourceWrap(ds, wc);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//也可以带条件处理@Bean@Condition(onProperty=&quot;$&#123;cache.enable&#125; = true&quot;) //有 &quot;cache.enable&quot; 属性值，且等于truepublic CacheService cache(@Inject(&quot;$&#123;cache.config&#125;&quot;) CacheServiceSupplier supper)&#123;</span></span><br><span class="line">       <span class="keyword">return</span> supper.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自动更新"><a href="#自动更新" class="headerlink" title="自动更新"></a>自动更新</h3><p>自动刷新只适合于字段注入，以及单例的类。注意：<strong>如果不是单例，请不要开启自动刷新</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Componentpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoService</span></span>&#123;</span><br><span class="line">    <span class="comment">//注入值（带默认值：demoApi），并开启自动更新</span></span><br><span class="line">    <span class="meta">@Inject(value=&quot;$&#123;track.name:demoApi&#125;&quot;, autoRefreshed=true)</span></span><br><span class="line">    String trackName;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//通过函数时时获取最新的（静态或动态，按需设定）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">trackName2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Solon.cfg().get(<span class="string">&quot;track.name:demoApi&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="手动配置"><a href="#手动配置" class="headerlink" title="手动配置"></a>手动配置</h2><p>通过 Solon.cfg() 获取 SolonProps 后进行操作。这里不做过多的描述，如果需要可以参看官网文档。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://solon.noear.org/article/31%EF%BC%8C%E6%89%8B%E5%8A%A8%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E5%8F%8A%E8%AE%A2%E9%98%85%E5%8F%98%E6%9B%B4%E7%9A%84%E5%86%85%E5%AE%B9%E3%80%82">https://solon.noear.org/article/31，手动获取配置及订阅变更的内容。</a></li>
<li><a target="_blank" rel="noopener" href="https://solon.noear.org/article/910%EF%BC%8CSolonProps">https://solon.noear.org/article/910，SolonProps</a> 接口参看</li>
</ul>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>配置本身相关简单，记住对应的配置加载规则和注入的方法，基本不会有什么太多的问题。这里不对示例做过多说明，更多需要参看，参看具体的代码 demo-solon01 。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>本文主要主要介绍了 Solon 的配置配置规则和自动化配置的方法。在理解了 Solon 的配置后，就可以更动态的做部署的配置。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2025/02/16/course100/024/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/16/course100/024/" class="post-title-link" itemprop="url">Web 开发 —— 高阶 WebSocket 和 SSE</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-02-16 10:14:21 / 修改时间：10:15:45" itemprop="dateCreated datePublished" datetime="2025-02-16T10:14:21+08:00">2025-02-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/" itemprop="url" rel="index"><span itemprop="name">教程100</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">写作</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/" itemprop="url" rel="index"><span itemprop="name">Solon</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%99%E7%A8%8B100/%E5%86%99%E4%BD%9C/Solon/Solon-%E5%AE%9E%E7%94%A8%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Solon 实用教程</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>随着大语言模型的流行，因为使用了 SSE 或者 Websocket的技术进行流式的交换，使得 SSE 和 Websocket也火了起来，今天我们来讲解，如何在 Solon 中实现 Websocket  服务端和 SSE 服务端。</p>
<h2 id="Websocket"><a href="#Websocket" class="headerlink" title="Websocket"></a>Websocket</h2><p>WebSocket 是 HTML5 开始提供的一种在单个 TCP 连接上进行全双工通讯的协议。它使得客户端和服务器之间的数据交换变得更加简单，允许服务端主动向客户端推送数据。在 WebSocket API 中，浏览器和服务器只需要完成一次握手，两者之间就直接可以创建持久性的连接，并进行双向数据传输。</p>
<p>我们这里通过一个简易的 im 的服务做为例子。</p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><p>如果使用了solon-web，默认使用的是smart-http，已经集成了 websocket，不需要添加其他的依赖。</p>
<table>
<thead>
<tr>
<th>插件</th>
<th>适配框架</th>
<th>包大小</th>
<th>信号协议支持</th>
<th>端口</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://solon.noear.org/article/90">solon-boot-smarthttp</a></td>
<td>smart-http (aio)</td>
<td>0.4Mb</td>
<td>http, ws</td>
<td>相同端口</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://solon.noear.org/article/91">solon-boot-jetty</a> + solon-boot-jetty-add-websocket</td>
<td>jetty (nio)</td>
<td>1.9Mb</td>
<td>http, ws</td>
<td>相同端口</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://solon.noear.org/article/92">solon-boot-undertow</a></td>
<td>undertow (nio)</td>
<td>4.3Mb</td>
<td>http, ws</td>
<td>相同端口</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://solon.noear.org/article/93">solon-boot-websocket</a></td>
<td>websocket (nio)</td>
<td>0.4Mb</td>
<td>ws</td>
<td>独立端口</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://solon.noear.org/article/551">solon-boot-websocket-netty</a></td>
<td>netty (nio)</td>
<td></td>
<td>ws</td>
<td>独立端口</td>
</tr>
</tbody></table>
<p>独立的 WebSocket 插件，会使用独立的端口，且默认为：主端口 + 10000，但都可以通过配置进行修改。</p>
<h3 id="启用"><a href="#启用" class="headerlink" title="启用"></a>启用</h3><p>在主类开启 Websocket。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.noear.solon.Solon;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.SolonMain;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SolonMain</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoWeb05App</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Solon.start(</span><br><span class="line">        DemoWeb05App.class,</span><br><span class="line">        args,</span><br><span class="line">        app -&gt; &#123;</span><br><span class="line">          app.enableWebSocket(<span class="keyword">true</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="开放端点"><a href="#开放端点" class="headerlink" title="开放端点"></a>开放端点</h3><p>这里集成了 SimpleWebSocketListener，已经提供了基本的实现，可以根据实际的需要实现需要的接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.im.endpoint;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.im.service.ImService;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Inject;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.net.annotation.ServerEndpoint;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.net.websocket.WebSocket;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.net.websocket.listener.SimpleWebSocketListener;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ServerEndpoint(&quot;/im.ws&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImWebsocket</span> <span class="keyword">extends</span> <span class="title">SimpleWebSocketListener</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> ImService service;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOpen</span><span class="params">(WebSocket socket)</span> </span>&#123;</span><br><span class="line">    service.onOpen(socket);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(WebSocket socket, String text)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    service.onMessage(socket, text);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现逻辑"><a href="#实现逻辑" class="headerlink" title="实现逻辑"></a>实现逻辑</h3><p>此处只是做简单的鉴权，和消息的回复，如果要实现完整的 IM 服务，还需要做会话的管理的逻辑。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.im.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> org.dromara.hutool.core.text.StrUtil;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Component;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.net.websocket.WebSocket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImService</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOpen</span><span class="params">(WebSocket socket)</span> </span>&#123;</span><br><span class="line">    String token = socket.param(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isBlank(token)) &#123;</span><br><span class="line">      socket.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 省略了管理 socket 的管理</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(WebSocket socket, String text)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    socket.send(<span class="string">&quot;&gt; &quot;</span> + text + <span class="string">&quot;\r\n&quot;</span> + <span class="string">&quot;消息已阅&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=N2U0ZmI3YjBjOWVjOGE4ZDdjOTNkN2ViZTA1MzkyMmFfNTZ0aUlXbzVyZG5hcUNMMFhOY1h6aUlhZ255MllqVllfVG9rZW46Skg1YmI5VmlMb21ydGd4OTJZMmMxQVBHbjJlXzE3Mzk2NzIxMDg6MTczOTY3NTcwOF9WNA" alt="img"></p>
<h2 id="SSE"><a href="#SSE" class="headerlink" title="SSE"></a>SSE</h2><p>SSE 全称是 Server-Sent Event，网页自动获取来自服务器的更新，SSE 是单向消息传递。</p>
<p>我们这里通过一个简易的 LLM 的服务做为例子。</p>
<h3 id="依赖-1"><a href="#依赖-1" class="headerlink" title="依赖"></a>依赖</h3><p>要实现 SSE 需要引入 solon-web-sse。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    <span class="function">implementation <span class="title">platform</span><span class="params">(project(<span class="string">&quot;:demo-parent&quot;</span>)</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">implementation</span><span class="params">(<span class="string">&quot;org.noear:solon-web&quot;</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">implementation</span><span class="params">(<span class="string">&quot;org.noear:solon-web-sse&quot;</span>)</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="开放端点-1"><a href="#开放端点-1" class="headerlink" title="开放端点"></a>开放端点</h3><p>客户端先要调用 open 方法，初始化 SseEmitter 连接，之后就可以通过 SseEmitter 给客户端发送消息了，为了方便测试这里还提供了 send 方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.chat.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.web.chat.service.ChatService;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Controller;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Inject;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Mapping;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.web.sse.SseEmitter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Mapping(&quot;/chat&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChatController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span> <span class="keyword">private</span> ChatService service;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(value = &quot;/open/&#123;id&#125;&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> SseEmitter <span class="title">open</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service.open(id);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(&quot;/send/&#123;id&#125;&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">send</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service.send(id);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mapping(&quot;/close/&#123;id&#125;&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">close</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service.close(id);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现逻辑-1"><a href="#实现逻辑-1" class="headerlink" title="实现逻辑"></a>实现逻辑</h3><p>与 Websocket 不同的是，SSE 是单向连接，请求的过程是不带会话连接的，所以需要自己管理好会话。 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.web.chat.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.noear.snack.ONode;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.Utils;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Component;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.Result;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.web.sse.SseEmitter;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.web.sse.SseEvent;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> airhead</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChatService</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> Map&lt;String, SseEmitter&gt; emitterMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> SseEmitter <span class="title">open</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    SseEmitter sseEmitter =</span><br><span class="line">        <span class="keyword">new</span> SseEmitter(<span class="number">60</span> * <span class="number">1000L</span>)</span><br><span class="line">            .onCompletion(() -&gt; emitterMap.remove(id))</span><br><span class="line">            .onError(e -&gt; log.error(<span class="string">&quot;初始化 sse 错误&quot;</span>, e))</span><br><span class="line">            .onInited(s -&gt; emitterMap.put(id, s));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      sseEmitter.send(<span class="string">&quot;Ok&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">      log.error(<span class="string">&quot;发送 sse 错误&quot;</span>, e);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化后，才能使用</span></span><br><span class="line">    <span class="keyword">return</span> sseEmitter;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">send</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    SseEmitter emitter = emitterMap.get(id);</span><br><span class="line">    <span class="keyword">if</span> (emitter == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;No user: &quot;</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String msg = <span class="string">&quot;test msg -&gt; &quot;</span> + System.currentTimeMillis();</span><br><span class="line">    System.out.println(msg);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      emitter.send(msg);</span><br><span class="line">      <span class="comment">// reconnectTime 用于提示前端重连时间</span></span><br><span class="line">      emitter.send(<span class="keyword">new</span> SseEvent().id(Utils.guid()).data(msg).reconnectTime(<span class="number">1000L</span>));</span><br><span class="line">      emitter.send(ONode.stringify(Result.succeed(msg)));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">      log.error(<span class="string">&quot;发送 sse 错误&quot;</span>, e);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Ok&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">close</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    SseEmitter emitter = emitterMap.get(id);</span><br><span class="line">    <span class="keyword">if</span> (emitter != <span class="keyword">null</span>) &#123;</span><br><span class="line">      emitter.complete();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Ok&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="验证-1"><a href="#验证-1" class="headerlink" title="验证"></a>验证</h3><p>ApiFox 支持测试 SSE，连接成功之后就可以调用 send 方法。</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=Nzk1OTVkMjM1Y2JkNTYzNjM2NzE2NmUzOGNhOWY0YzdfT3V4MUVvWkp4ZGswNFl5SjJ3ZHV2bExjakZjUFk3N1VfVG9rZW46SkFHV2JJbHhUb1lZQ3l4UnhNRGNGZUtabktjXzE3Mzk2NzIxMDg6MTczOTY3NTcwOF9WNA" alt="img"></p>
<p>也可以直接使用 curl 进行测试</p>
<p><img src="https://otwu9ovpkn.feishu.cn/space/api/box/stream/download/asynccode/?code=NDk5NTNlOGQ3NDM1ZDAxMjc3MjBhYmYwZDI1ZjkxYWJfWDlaaU1PWkpNUlN6d3lHemo0WklhY3R2eldrMWxxVklfVG9rZW46VzVUc2IzSmpEbzBHelR4ZHNCcWNIZHV4bmZjXzE3Mzk2NzIxMDg6MTczOTY3NTcwOF9WNA" alt="img"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/30/">30</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">L4qiang</p>
  <div class="site-description" itemprop="description">记录点滴，注重积累。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">291</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">119</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">118</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/crazy-airhead" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;crazy-airhead" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:L4qiang@gmail.com" title="E-Mail → mailto:L4qiang@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/enderjo" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;enderjo" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://ri.cms.firesbox.com/" title="https:&#x2F;&#x2F;ri.cms.firesbox.com" rel="noopener" target="_blank">践行群官方情报站</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">L4qiang</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">766k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">11:36</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  















    <div id="pjax">
  

  


    </div>
</body>
</html>

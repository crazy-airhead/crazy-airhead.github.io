<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"l4qiang.me","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="记录点滴，注重积累。">
<meta property="og:type" content="website">
<meta property="og:title" content="CrazyAirhead">
<meta property="og:url" content="http://l4qiang.me/page/2/index.html">
<meta property="og:site_name" content="CrazyAirhead">
<meta property="og:description" content="记录点滴，注重积累。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="L4qiang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://l4qiang.me/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>CrazyAirhead</title>
  


  <script data-pjax>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?3e0344e2cb00f51bf76efa000dca7d75";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">CrazyAirhead</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">疯狂的傻瓜，傻瓜也疯狂——傻方能执著，疯狂才专注!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/crazy-airhead" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2023/05/01/course100/009/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/05/01/course100/009/" class="post-title-link" itemprop="url">定投人生课堂搜索工具</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-05-01 07:00:03" itemprop="dateCreated datePublished" datetime="2023-05-01T07:00:03+08:00">2023-05-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-05-06 19:26:57" itemprop="dateModified" datetime="2023-05-06T19:26:57+08:00">2023-05-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%9A%E6%8A%95%E4%BA%BA%E7%94%9F%E8%AF%BE%E5%A0%82/" itemprop="url" rel="index"><span itemprop="name">定投人生课堂</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%9A%E6%8A%95%E4%BA%BA%E7%94%9F%E8%AF%BE%E5%A0%82/%E5%AE%9A%E6%8A%95%E6%90%9C%E7%B4%A2/" itemprop="url" rel="index"><span itemprop="name">定投搜索</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h2><p>「定投搜索」是一个免费的Mixin机器人，是「定投人生课堂」课程搜索工具，可以通过关键字检索「定投人生课堂」的课程内容，返回课程列表。</p>
<h2 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h2><ol>
<li><p>登录Mixin，点击搜索「7000103414」，确认是「定投搜索」后添加机器人。</p>
</li>
<li><p>把搜索关键字发给该机器人，机器人会返回检索到的课程列表（结果最多10条课程）。</p>
<ul>
<li><p>支持多关键字，关键字之间使用空格分隔。</p>
</li>
<li><p>支持命令模式，使用<code>/</code>开启命令模式，当前只支持<code>/d</code>，表示返回课程详情，除了返回查询结果，还将一并返回查询结果的课程的卡片。如：<code>机会成本 /d</code>，可以在下面的图中看到返回结果。</p>
</li>
</ul>
</li>
<li><p>听课。</p>
<ul>
<li><p>从结果中复制课程标题到「定投人生课堂」搜索该课程，开始听课。</p>
</li>
<li><p>如果返回课程详情，直接点击卡片，授权后开始听课。</p>
</li>
</ul>
</li>
</ol>
<p><img src="https://assets.quill.im/mhxpas3dauszrwragc3p0pnjrrx5" alt="WechatIMG239.png"><br><img src="https://assets.quill.im/v011v1c9sryqm9ug0ndib8zbytp5" alt="WechatIMG238.png"></p>
<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="搜索不到结果"><a href="#搜索不到结果" class="headerlink" title="搜索不到结果"></a>搜索不到结果</h3><blockquote>
<ul>
<li><p>技术原因，课程内容是语音的，使用的是语音识别技术，可能无法完全识别，可能识别错误，可能存在错别字，导致检索不到，另外中文需要分词，分词的结果可能会和我们的预期不一致，导致检索不到。</p>
</li>
<li><p>客观原因，没有导入课程数据，或者确实没有匹配的关键字。</p>
</li>
<li><p>可能的解决办法，调整关键字重新搜索。</p>
</li>
</ul>
</blockquote>
<h3 id="数据如何获取"><a href="#数据如何获取" class="headerlink" title="数据如何获取"></a>数据如何获取</h3><blockquote>
<p>手工整理。请不要找我索取课程数据，整理自己的课程笔记更重要，请听「学习的真相」的「必要关联」和「三个大脑」。</p>
</blockquote>
<h3 id="数据何时更新"><a href="#数据何时更新" class="headerlink" title="数据何时更新"></a>数据何时更新</h3><blockquote>
<p>课程数据是手动整理的，无法保证与课程内容的实时同步，只会不定期导入。</p>
</blockquote>
<h3 id="功能是否会更新"><a href="#功能是否会更新" class="headerlink" title="功能是否会更新"></a>功能是否会更新</h3><blockquote>
<p>目前功能基本可用，暂无功能计划，后续可能会增加命令模式的命令。</p>
<p>如果大家有新的想法，可以反馈。</p>
</blockquote>
<h3 id="是否收费"><a href="#是否收费" class="headerlink" title="是否收费"></a>是否收费</h3><blockquote>
<p>免费。如果觉得「定投搜索」工具确实对你有帮助，欢迎打赏，打赏本文即可。</p>
</blockquote>
<h3 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h3><blockquote>
<p>其他问题可以添加我的微信「Crazy_Airhead」，或Mixin号「1091586」，进行反馈和沟通。</p>
</blockquote>
<h2 id="为什么"><a href="#为什么" class="headerlink" title="为什么"></a>为什么</h2><p>偶尔会想起一些模糊的课程内容，想重听一遍课程，但定投人生课堂只能按标题内容模糊搜索，于是只能凭记忆在Mixin中找，可能半天过去了还找不到自己想要的课程，这过程其实是挺痛苦的。在「定投人生课堂后花园」的里也会看到类似的查找课程的问题，于是有了做这个工具的想法。</p>
<p>之前为「且慢且慢且慢」写作群的战友提供过写作练习工具，但因为服务器和域名过期等原因，服务就中断了，非常抱歉。计划做这个工具的时候是想收费的，因为提供服务需要成本，实际做的过程中时候发现不需要公网服务器也可以提供服务，于是少了收费的欲望，本着服务战友的想法，于是决定免费开放服务。</p>
<p>此次提供的「定投搜索」工具，因为用了自家的NAS，理论上是可以长期服务战友们。如果「定投人生课堂」提供了更好的搜索功能，这个「定投搜索」工具也就没有存在的意义了，到时会停止服务。</p>
<p>在提供服务期间，如果出现无法使用的情况，请战友们及时反馈。</p>
<h2 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h2><p>刚开始有做「定投搜索」这个工具的想法时，小熊老师（微信号「huashichenxiong」）给了不少积极的反馈，让我开始实际编写这个工具；中间因为工作忙没怎么做，小熊老师又不停地鼓励；现在能提供服务，也是和小熊老师讨论Mixin机器人开发，打破自己的做微信公众号的思维定势（微信的机器人和微信公众号不是同一个物种），于是趁着放假时间赶紧完成剩下的工作。总之非常感谢小熊老师，如果没有小熊老师的鼓励，这个工具不知道什么时候才能完工。</p>
<p>感谢Mixin好友「字友与自由」，Mixin号「39488252」，帮忙解答了机器人无法接收消息的问题。他写了个Java版的SDK（<a target="_blank" rel="noopener" href="https://github.com/tooonly/mixin-java-sdk%EF%BC%89%EF%BC%8C%E6%9C%89%E9%9C%80%E8%A6%81%E6%88%98%E5%8F%8B%E7%9A%84%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%B7%B1%E8%8E%B7%E5%8F%96%E3%80%82">https://github.com/tooonly/mixin-java-sdk）</a>，有需要战友的可以自己获取。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2023/02/22/bigdata/dss/install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/02/22/bigdata/dss/install/" class="post-title-link" itemprop="url">单机部署DSS</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-02-22 23:12:53 / 修改时间：23:26:41" itemprop="dateCreated datePublished" datetime="2023-02-22T23:12:53+08:00">2023-02-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/" itemprop="url" rel="index"><span itemprop="name">hadoop</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/course/" itemprop="url" rel="index"><span itemprop="name">course</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/course/dds/" itemprop="url" rel="index"><span itemprop="name">dds</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>8 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="零、注意事项"><a href="#零、注意事项" class="headerlink" title="零、注意事项"></a><strong>零、注意事项</strong></h1><ul>
<li><p>确保安装的系统为CentOS7</p>
</li>
<li><p>服务器存在多网卡问题。首先通过命令<code>ifconfig</code>禁用多余的网卡，以确保激活的网卡数只有1个。</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看网卡ifconfig# 禁用指定网卡ifconfig [NIC_NAME] down</span></span><br></pre></td></tr></table></figure>

<ul>
<li>网卡多IP问题。在确保服务器只存在一个网卡是激活状态的情况下，通过命令查看网卡对应的IP数，若大于1，那么就需要去掉网卡中指定的IP，采用动态获取IP的方式，具体命令如下：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> $(hostname -I) ip addr flush dev [NIC_NAME] ifdown [NIC_NAME] ifup [NIC_NAME]</span><br></pre></td></tr></table></figure>

<ul>
<li>hostname配置。在安装前用户需要配置hostname到ip的映射</li>
</ul>
<h1 id="一、基础软件安装"><a href="#一、基础软件安装" class="headerlink" title="一、基础软件安装"></a><strong>一、基础软件安装</strong></h1><ul>
<li>需要的命令工具：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y telnet tar sed dos2unix unzip zip expect curl</span><br></pre></td></tr></table></figure>

<ul>
<li>检查cp等命令是否有别名alias，避免安装时提示。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aliasvi ~/.bashrc<span class="comment"># 删除cp rm 的别名，</span></span><br></pre></td></tr></table></figure>

<ul>
<li>需要安装的软件<ul>
<li><p>MySQL(5.5+)，安装Hive时已安装</p>
</li>
<li><p>JDK (1.8.0_141以上)，安装Hadoop时已安装</p>
</li>
<li><p>Python(2.x和3.x都支持)，默认包含python2，无需安装，但需要安装pip和matplotlib</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://bootstrap.pypa.io/pip/2.7/get-pip.py -o get-pip.pypip config <span class="built_in">set</span> global.index-url https://mirrors.aliyun.com/pypi/simple/python -m pip install matplotlib</span><br></pre></td></tr></table></figure>

<ul>
<li>安装Nginx</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y epel-releasesudo yum -y updatesudo yum install -y nginxsystemctl start nginxsystemctl <span class="built_in">enable</span> nginx</span><br></pre></td></tr></table></figure>

<ul>
<li><p>安装Hadoop2.7.2</p>
</li>
<li><p>安装Hive2.3.3（未找到2.3.3版本，使用的是2.3.9版本）</p>
</li>
<li><p>安装Spark2.0以上版本</p>
<p>    <a target="_blank" rel="noopener" href="https://ytq6nfyc5n.feishu.cn/docx/XbzzdTJsFoWrcAxcmd0cqQQvn9e">部署Hadoop+Hive+Spark</a></p>
<p>    确保可以执行如下命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -ls /hive -e <span class="string">&quot;show databases&quot;</span>spark-sql -e <span class="string">&quot;show databases&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="二、创建用户"><a href="#二、创建用户" class="headerlink" title="二、创建用户"></a><strong>二、创建用户</strong></h1><ol>
<li><p>假设<strong>部署用户是hadoop账号</strong>（可以不是hadoop用户，但是推荐使用Hadoop的超级用户进行部署，这里只是一个示例）</p>
</li>
<li><p>在所有需要部署的机器上创建部署用户，用于安装 ，如下命令创建部署用户hadoop</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo useradd hadoop</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>因为Linkis的服务是以 <code>sudo -u $&#123;linux-user&#125;</code> 方式来切换引擎，从而执行作业，所以部署用户需要有 sudo 权限，而且是免密的，按下面步骤修改部署用户权限</li>
</ol>
<p>编辑/etc/sudoers文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sudoers</span><br></pre></td></tr></table></figure>

<p>在/etc/sudoers文件中添加下面内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop  ALL=(ALL)  NOPASSWD: NOPASSWD: ALL</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>修复文件权限</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...chown root:root /etc/sudo.conf -Rchown root:root /etc/sudoers.d -R</span><br></pre></td></tr></table></figure>

<h1 id="三、准备安装包"><a href="#三、准备安装包" class="headerlink" title="三、准备安装包"></a><strong>三、准备安装包</strong></h1><ul>
<li><p>用户可以自行编译或者去 release 页面下载安装包：<a target="_blank" rel="noopener" href="https://github.com/WeBankFinTech/DataSphereStudio/releases/tag/1.1.1">DSS Release-1.1.1</a></p>
</li>
<li><p>DSS &amp; Linkis 一键安装部署包的层级目录结构如下：</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">├── dss_linkis # 一键部署主目录  ├── bin # 用于一键安装，以及一键启动 DSS + Linkis  ├── conf # 一键部署的参数配置目录  ├── wedatasphere-dss-x.x.x-dist.tar.gz # DSS后端安装包  ├── wedatasphere-dss-web-x.x.x-dist.zip # DSS前端和Linkis前端安装包  ├── wedatasphere-linkis-x.x.x-dist.tar.gz # Linkis后端安装包</span><br></pre></td></tr></table></figure>

<h1 id="四、修改配置"><a href="#四、修改配置" class="headerlink" title="四、修改配置"></a><strong>四、修改配置</strong></h1><ul>
<li><p>用户需要对 <code>xx/dss_linkis/conf</code> 目录下的 <code>config.sh</code> 和 <code>db.sh</code> 进行修改。</p>
</li>
<li><p>打开 <code>config.sh</code>，按需修改相关配置参数，参数说明如下：</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#################### 一键安装部署的基本配置 ####################### deploy user（部署用户，默认为当前登录用户）deployUser=hadoop### Linkis_VERSIONLINKIS_VERSION=1.1.1### DSS Web（本机安装一般无需修改，但需确认此端口是否占用，若被占用，修改一个可用端口即可）DSS_NGINX_IP=127.0.0.1DSS_WEB_PORT=8085### DSS VERSIONDSS_VERSION=1.1.1############## linkis的其他默认配置信息 start ############## ### Specifies the user workspace, which is used to store the user&#x27;s script files and log files.### Generally local directory##file:// required. 指定用户使用的目录路径，一般用于存储用户的脚本文件和日志文件等，是用户的工作空间WORKSPACE_USER_ROOT_PATH=file:///tmp/linkis/ ### User&#x27;s root hdfs path##hdfs:// required. 结果集日志等文件路径，用于存储Job的结果集文件HDFS_USER_ROOT_PATH=hdfs:///tmp/linkis ### Path to store job ResultSet:file or hdfs path##hdfs:// required. 结果集日志等文件路径，用于存储Job的结果集文件，如果未配置 使用HDFS_USER_ROOT_PATH的配置RESULT_SET_ROOT_PATH=hdfs:///tmp/linkis ### Path to store started engines and engine logs, must be local. 存放执行引擎的工作路径，需要部署用户有写权限的本地目录ENGINECONN_ROOT_PATH=/appcom/tmp### 基础组件环境信息###HADOOP CONF DIR #/appcom/config/hadoop-config（用户根据实际情况修改）</span></span><br><span class="line">HADOOP_CONF_DIR=/appcom/config/hadoop-config<span class="comment">###HIVE CONF DIR  #/appcom/config/hive-config（用户根据实际情况修改）</span></span><br><span class="line">HIVE_CONF_DIR=/appcom/config/hive-config<span class="comment">###SPARK CONF DIR #/appcom/config/spark-config（用户根据实际情况修改）</span></span><br><span class="line">SPARK_CONF_DIR=/appcom/config/spark-config<span class="comment">###for install （用户根据实际情况修改）LINKIS_PUBLIC_MODULE=lib/linkis-commons/public-module##YARN REST URL spark engine required（根据实际情况修改IP和端口）</span></span><br><span class="line">YARN_RESTFUL_URL=http://127.0.0.1:8088<span class="comment">## Engine version#SPARK_VERSION（根据实际版本情况修改版本号）</span></span><br><span class="line">SPARK_VERSION=2.4.3<span class="comment">##HIVE_VERSION（根据实际版本情况修改版本号）</span></span><br><span class="line">HIVE_VERSION=2.3.9<span class="comment">##PYTHON_VERSION（根据实际版本情况修改版本号）</span></span><br><span class="line">PYTHON_VERSION=python2<span class="comment">## LDAP is for enterprise authorization, if you just want to have a try, ignore it.#LDAP_URL=ldap://localhost:1389/#LDAP_BASEDN=dc=webank,dc=com#LDAP_USER_NAME_FORMAT=cn=%s@xxx.com,OU=xxx,DC=xxx,DC=com############## linkis的其他默认配置信息 end ################################# The install Configuration of all Linkis&#x27;s Micro-Services ######################################## 用户可以根据实际情况修改IP和端口 #####################    NOTICE:#       1. If you just wanna try, the following micro-service configuration can be set without any settings.#            These services will be installed by default on this machine.#       2. In order to get the most complete enterprise-level features, we strongly recommend that you install#          the following microservice parameters####  EUREKA install information###  You can access it in your browser at the address below:http://$&#123;EUREKA_INSTALL_IP&#125;:$&#123;EUREKA_PORT&#125;###  Microservices Service Registration Discovery CenterLINKIS_EUREKA_INSTALL_IP=127.0.0.1LINKIS_EUREKA_PORT=9600#LINKIS_EUREKA_PREFER_IP=true###  Gateway install information#LINKIS_GATEWAY_INSTALL_IP=127.0.0.1LINKIS_GATEWAY_PORT=9001### ApplicationManager#LINKIS_MANAGER_INSTALL_IP=127.0.0.1LINKIS_MANAGER_PORT=9101### EngineManager#LINKIS_ENGINECONNMANAGER_INSTALL_IP=127.0.0.1LINKIS_ENGINECONNMANAGER_PORT=9102### EnginePluginServer#LINKIS_ENGINECONN_PLUGIN_SERVER_INSTALL_IP=127.0.0.1LINKIS_ENGINECONN_PLUGIN_SERVER_PORT=9103### LinkisEntrance#LINKIS_ENTRANCE_INSTALL_IP=127.0.0.1LINKIS_ENTRANCE_PORT=9104###  publicservice#LINKIS_PUBLICSERVICE_INSTALL_IP=127.0.0.1LINKIS_PUBLICSERVICE_PORT=9105### cs#LINKIS_CS_INSTALL_IP=127.0.0.1LINKIS_CS_PORT=9108########## Linkis微服务配置完毕 ############################# The install Configuration of all DataSphereStudio&#x27;s Micro-Services ######################################### 非注释的参数必须配置，注释掉的参数可按需修改 #################### #    NOTICE:#       1. If you just wanna try, the following micro-service configuration can be set without any settings.#            These services will be installed by default on this machine.#       2. In order to get the most complete enterprise-level features, we strongly recommend that you install#          the following microservice parameters## 用于存储发布到 Schedulis 的临时ZIP包文件WDS_SCHEDULER_PATH=file:///appcom/tmp/wds/scheduler### DSS_SERVER### This service is used to provide dss-server capability.### project-server#DSS_FRAMEWORK_PROJECT_SERVER_INSTALL_IP=127.0.0.1#DSS_FRAMEWORK_PROJECT_SERVER_PORT=9002### orchestrator-server#DSS_FRAMEWORK_ORCHESTRATOR_SERVER_INSTALL_IP=127.0.0.1#DSS_FRAMEWORK_ORCHESTRATOR_SERVER_PORT=9003### apiservice-server#DSS_APISERVICE_SERVER_INSTALL_IP=127.0.0.1#DSS_APISERVICE_SERVER_PORT=9004### dss-workflow-server#DSS_WORKFLOW_SERVER_INSTALL_IP=127.0.0.1#DSS_WORKFLOW_SERVER_PORT=9005### dss-flow-execution-server#DSS_FLOW_EXECUTION_SERVER_INSTALL_IP=127.0.0.1#DSS_FLOW_EXECUTION_SERVER_PORT=9006###dss-scriptis-server#DSS_SCRIPTIS_SERVER_INSTALL_IP=127.0.0.1#DSS_SCRIPTIS_SERVER_PORT=9008########## DSS微服务配置完毕################### other default configuration 其他默认配置信息  ############## ## java application default jvm memory（Java应用的堆栈大小。如果部署机器的内存少于8G，推荐128M；## 达到16G时，推荐至少256M；如果想拥有非常良好的用户使用体验，推荐部署机器的内存至少达到32G）export SERVER_HEAP_SIZE=&quot;128M&quot;##sendemail配置，只影响DSS工作流中发邮件功能EMAIL_HOST=smtp.163.comEMAIL_PORT=25EMAIL_USERNAME=xxx@163.comEMAIL_PASSWORD=xxxxxEMAIL_PROTOCOL=smtp### Save the file path exported by the orchestrator serviceORCHESTRATOR_FILE_PATH=/appcom/tmp/dss### Save DSS flow execution service log pathEXECUTION_LOG_PATH=/appcom/tmp/dss############## other default configuration 其他默认配置信息 ############## </span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>请注意：DSS 推荐使用 LDAP 进行用户登录鉴权，如您想接入公司的 LDAP，还需在上面的 <code>config.sh</code> 中填写 LDAP 的配置参数。 <a target="_blank" rel="noopener" href="https://web.mit.edu/rhel-doc/5/RHEL-5-manual/Deployment_Guide-en-US/s1-ldap-quickstart.html">如何安装 LDAP？</a></p>
</li>
<li><p>修改数据库配置。请确保配置的数据库，安装机器可以正常访问，否则将会出现 DDL 和 DML 导入失败的错误，打开 <code>db.sh</code>，按需修改相关配置参数，参数说明如下：</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">配置DSS数据库MYSQL_HOST=127.0.0.1MYSQL_PORT=3306MYSQL_DB=dssMYSQL_USER=xxxMYSQL_PASSWORD=xxx<span class="comment">## Hive metastore的数据库配置，用于Linkis访问Hive的元数据信息HIVE_HOST=127.0.0.1HIVE_PORT=3306HIVE_DB=xxxHIVE_USER=xxxHIVE_PASSWORD=xxx</span></span><br></pre></td></tr></table></figure>

<h1 id="五、安装和使用"><a href="#五、安装和使用" class="headerlink" title="五、安装和使用"></a><strong>五、安装和使用</strong></h1><ol>
<li><strong>停止机器上所有<strong><strong>DSS</strong></strong>及Linkis服务</strong></li>
</ol>
<ul>
<li>若从未安装过DSS及Linkis服务，忽略此步骤</li>
</ul>
<ol start="2">
<li><strong>将当前目录切换到bin目录</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> xx/dss_linkis/bin</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p><strong>执行安装脚本</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh install.sh</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>该安装脚本会检查各项集成环境命令，如果没有请按照提示进行安装，以下命令为必须项：</p>
</li>
<li><p><em>yum; java; mysql; unzip; expect; telnet; tar; sed; dos2unix; nginx</em></p>
</li>
<li><p>安装时，脚本会询问您是否需要初始化数据库并导入元数据，Linkis 和 DSS 均会询问，<strong>第一次安装必须选是(2)</strong></p>
</li>
<li><p>通过查看控制台打印的日志信息查看是否安装成功，如果有错误信息，可以查看具体报错原因</p>
</li>
<li><p><em>除非用户想重新安装整个应用，否则该命令执行一次即可</em></p>
</li>
</ol>
</li>
<li><p><strong>启动服务</strong></p>
</li>
</ol>
<ul>
<li>若用户的Linkis安装包是通过自己编译获取且用户想启用数据源管理功能，那么就需要去修改配置以启动该项功能，使用下载的安装包无需操作</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 切换到Linkis配置文件目录cd xx/dss_linkis/linkis/conf## 打开配置文件linkis-env.shvi linkis-env.sh## 将如下配置改为trueexport ENABLE_METADATA_MANAGER=true</span></span><br></pre></td></tr></table></figure>

<ul>
<li>若用户的Linkis安装包是通过自己编译获取，在启动服务前尽量将后续用到的密码改成和部署用户名一致，使用下载的安装包无需操作</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 切换到Linkis配置文件目录cd xx/dss_linkis/linkis/conf/## 打开配置文件linkis-mg-gateway.propertiesvi linkis-mg-gateway.properties## 修改密码wds.linkis.admin.password=hadoop</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在xx/dss_linkis/bin目录下执行启动服务脚本</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh start-all.sh</span><br></pre></td></tr></table></figure>

<ul>
<li>如果启动产生了错误信息，可以查看具体报错原因。启动后，各项微服务都会进行<strong>通信检测</strong>，如果有异常则可以帮助用户定位异常日志和原因</li>
</ul>
<ol start="5">
<li><strong>安装默认Appconn</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换目录到dss，正常情况下dss目录就在xx/dss_linkis目录下，cd xx/dss_linkis/dss/bin# 执行启动默认Appconn脚本sh install-default-appconn.sh</span></span><br></pre></td></tr></table></figure>

<ul>
<li><em>该命令执行一次即可，除非用户想重新安装整个应用</em></li>
</ul>
<ol start="6">
<li><strong>查看验证是否成功</strong></li>
</ol>
<ul>
<li>用户可以在Eureka界面查看 Linkis &amp; DSS 后台各微服务的启动情况，默认情况下DSS有6个微服务，Linkis有6个微服务 <strong>（Eureka地址默认端口号9600，服务完整启动时可以看到地址）</strong></li>
</ul>
<p><img src="https://ytq6nfyc5n.feishu.cn/space/api/box/stream/download/asynccode/?code=YzJlZGJmZjIxOGU0YTM4YWU1NDBhNzNkYTU5YTZjZjVfRHR0RlU4UDZCOFZqc2xyUnZndXplTkp0amlQVDRLTkJfVG9rZW46Ym94Y250blY5V0VuTkNXV1dFQWhRVG1tUVBlXzE2NzcwNzk1ODE6MTY3NzA4MzE4MV9WNA"></p>
<p><img src="https://ytq6nfyc5n.feishu.cn/space/api/box/stream/download/asynccode/?code=MWVhNjY2NDNhMjMwMTA3NzM0ZmRlODQ0YWI0NGUyNzFfZ3RRZHVJcno4OVBtVEVnQ1pQOXpHS2czS0NzUWVRYzRfVG9rZW46Ym94Y25GQVZLbHVwRUxQMHkyV1lmVHZ3WmJiXzE2NzcwNzk1ODE6MTY3NzA4MzE4MV9WNA"></p>
<ul>
<li>用户可以使用<strong>谷歌浏览器</strong>访问以下前端地址：<code>http://DSS_NGINX_IP:DSS_WEB_PORT</code> <strong>启动日志会打印此访问地址（在xx/dss_linkis/conf/config.sh中也配置了此地址）</strong>。登陆时默认管理员的用户名和密码均为部署用户为hadoop（用户若想修改密码，可以通过修改 xx/dss_linkis/linkis/conf/linkis-mg-gateway.properties 文件中的 wds.linkis.admin.password 参数)</li>
</ul>
<ol start="7">
<li><strong>停止服务</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh stop-all.sh</span><br></pre></td></tr></table></figure>

<ul>
<li>若用户需要停止所有服务可执行该命令<code>sh stop-all.sh</code>，重新启动所有服务就执行<code>sh start-all.sh</code>，这两条命令均在xx/dss_linkis/bin目录下执行</li>
</ul>
<h1 id="六、补充说明"><a href="#六、补充说明" class="headerlink" title="六、补充说明"></a><strong>六、补充说明</strong></h1><ul>
<li><p>考虑到安装包过于大的问题，Linkis默认仅提供Hive, Python, Shell, Spark引擎插件，用户若想使用其他引擎，可参考文档: <a target="_blank" rel="noopener" href="https://linkis.apache.org/zh-CN/docs/1.1.1/deployment/engine-conn-plugin-installation">Linkis引擎的安装</a></p>
</li>
<li><p>DSS默认未安装调度系统，用户可以选择安装 Schedulis 或者 DolphinScheduler，具体安装方式见下面表格</p>
</li>
<li><p>DSS默认仅安装DateChecker, EventSender, EventReceiver AppConn，用户可参考文档安装其他AppConn，如Visualis, Exchangis, Qualitis, Prophecis, Streamis。调度系统可使用Schedulis或DolphinScheduler</p>
</li>
</ul>
<style> td {white-space:pre-wrap;border:1px solid #dee0e3;}</style>

<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>组件名</td>
<td>组件版本要求</td>
<td>组件部署链接</td>
<td>AppConn部署链接</td>
</tr>
<tr>
<td>Schedulis</td>
<td>Schedulis0.7.0</td>
<td><a target="_blank" rel="noopener" href="https://github.com/WeBankFinTech/Schedulis/blob/master/docs/schedulis_deploy_cn.md">Schedulis部署</a></td>
<td><a target="_blank" rel="noopener" href="https://github.com/WeBankFinTech/DataSphereStudio-Doc/blob/main/zh_CN/%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/SchedulisAppConn%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85%E6%96%87%E6%A1%A3.md">Schedulis AppConn安装</a></td>
</tr>
<tr>
<td>Visualis</td>
<td>Visualis1.0.0</td>
<td><a target="_blank" rel="noopener" href="https://github.com/WeBankFinTech/Visualis/blob/master/visualis_docs/zh_CN/Visualis_deploy_doc_cn.md">Visualis部署</a></td>
<td><a target="_blank" rel="noopener" href="https://github.com/WeBankFinTech/Visualis/blob/master/visualis_docs/zh_CN/Visualis_appconn_install_cn.md">Visualis AppConn安装</a></td>
</tr>
<tr>
<td>Exchangis</td>
<td>Exchangis1.0.0</td>
<td><a target="_blank" rel="noopener" href="https://github.com/WeBankFinTech/Exchangis/blob/master/docs/zh_CN/ch1/exchangis_deploy_cn.md">Exchangis部署</a></td>
<td><a target="_blank" rel="noopener" href="https://github.com/WeBankFinTech/Exchangis/blob/master/docs/zh_CN/ch1/exchangis_appconn_deploy_cn.md">Exchangis AppConn安装</a></td>
</tr>
<tr>
<td>Qualitis</td>
<td>Qualitis0.9.2</td>
<td><a target="_blank" rel="noopener" href="https://github.com/WeBankFinTech/Qualitis/blob/master/docs/zh_CN/ch1/%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E6%89%8B%E5%86%8C%E2%80%94%E2%80%94%E5%8D%95%E6%9C%BA%E7%89%88.md">Qualitis部署</a></td>
<td><a target="_blank" rel="noopener" href="https://github.com/WeBankFinTech/Qualitis/blob/master/docs/zh_CN/ch1/%E6%8E%A5%E5%85%A5%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%8C%87%E5%8D%97.md">Qualitis AppConn安装</a></td>
</tr>
<tr>
<td>Prophecis</td>
<td>Prophecis0.3.2</td>
<td><a target="_blank" rel="noopener" href="https://github.com/WeBankFinTech/Prophecis/blob/master/docs/zh_CN/QuickStartGuide.md">Prophecis部署</a></td>
<td><a target="_blank" rel="noopener" href="https://github.com/WeBankFinTech/Prophecis/blob/master/docs/zh_CN/Deployment_Documents/Prophecis%20Appconn%E5%AE%89%E8%A3%85%E6%96%87%E6%A1%A3.md">Prophecis AppConn安装</a></td>
</tr>
<tr>
<td>Streamis</td>
<td>Streamis0.2.0</td>
<td><a target="_blank" rel="noopener" href="https://github.com/WeBankFinTech/Streamis/blob/main/docs/zh_CN/0.2.0/Streamis%E5%AE%89%E8%A3%85%E6%96%87%E6%A1%A3.md">Streamis部署</a></td>
<td><a target="_blank" rel="noopener" href="https://github.com/WeBankFinTech/Streamis/blob/main/docs/zh_CN/0.2.0/development/StreamisAppConn%E5%AE%89%E8%A3%85%E6%96%87%E6%A1%A3.md">Streamis AppConn安装</a></td>
</tr>
<tr>
<td>DolphinScheduler</td>
<td>DolphinScheduler1.3.x</td>
<td><a target="_blank" rel="noopener" href="https://dolphinscheduler.apache.org/zh-cn/docs/1.3.8/user_doc/standalone-deployment.html">DolphinScheduler部署</a></td>
<td><a target="_blank" rel="noopener" href="https://github.com/WeBankFinTech/DataSphereStudio-Doc/blob/main/zh_CN/%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/DolphinScheduler%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85%E6%96%87%E6%A1%A3.md">DolphinScheduler AppConn安装</a></td>
</tr>
</tbody></table>
<h1 id="七、问题处理"><a href="#七、问题处理" class="headerlink" title="七、问题处理"></a>七、问题处理</h1><ul>
<li>部署时提示上传资源错误</li>
</ul>
<p><img src="https://ytq6nfyc5n.feishu.cn/space/api/box/stream/download/asynccode/?code=YTQ2ZmEzNjU2ZDk4ZjFhZDFiNjI3NTE2Y2RkNGQzMjJfZHUydlZFQUJ5dXlzYUdTQWdHa3VTaURtZWJJRnMya1JfVG9rZW46Ym94Y242RHdqcE81dmt6UHRzTThPRFJMSWtoXzE2NzcwNzk1ODE6MTY3NzA4MzE4MV9WNA"></p>
<blockquote>
<p>可以查看<code>xx/dss-links/links/logs/links-ps-publishservice.log</code>看具体的错误信息，来确定具体的错误</p>
</blockquote>
<h1 id="八、参考链接"><a href="#八、参考链接" class="headerlink" title="八、参考链接"></a>八、参考链接</h1><ul>
<li><p><a target="_blank" rel="noopener" href="https://github.com/WeBankFinTech/DataSphereStudio-Doc/blob/main/zh_CN/%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/DSS%26Linkis%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3%E5%8D%95%E6%9C%BA%E7%89%88.md">DSS单机部署</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/apache/linkis/discussions/3628">DSS部署</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/433878383">安装pip</a></p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2023/02/22/bigdata/hive/install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/02/22/bigdata/hive/install/" class="post-title-link" itemprop="url">单机部署Hive</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-02-22 22:06:58 / 修改时间：23:13:18" itemprop="dateCreated datePublished" datetime="2023-02-22T22:06:58+08:00">2023-02-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/" itemprop="url" rel="index"><span itemprop="name">hadoop</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/hive/" itemprop="url" rel="index"><span itemprop="name">hive</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/hive/course/" itemprop="url" rel="index"><span itemprop="name">course</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/hive/course/dds/" itemprop="url" rel="index"><span itemprop="name">dds</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p>需要部署大数据治理平台，查看了一些开源版本之后发现微众银行的<a target="_blank" rel="noopener" href="https://github.com/WeBankFinTech/DataSphereStudio">DataSphereStudio</a>(DSS)比较符合我们的预期，于是着手部署该数据平台。</p>
<p>因为DSS默认支持的是Hive2.3.3，但官网没找到对应版本，使用的是<a target="_blank" rel="noopener" href="https://dlcdn.apache.org/hive/hive-2.3.9/apache-hive-2.3.9-bin.tar.gz">2.3.9</a>。</p>
<p>参考安装文档<a target="_blank" rel="noopener" href="https://cwiki.apache.org/confluence/display/Hive/GettingStarted">GettingStarted - Apache Hive - Apache Software Foundation</a>。</p>
<h1 id="基础软件"><a href="#基础软件" class="headerlink" title="基础软件"></a>基础软件</h1><ul>
<li><p>CentOS7</p>
</li>
<li><p>Hadoop2.7.2</p>
</li>
<li><p>MySQL5.6+</p>
</li>
</ul>
<h1 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h1><ul>
<li>安装MySQL，下载的是5.7.40版本</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">yum installm -y ./*.rpm</span><br><span class="line"></span><br><span class="line">systemctl start mysqld &amp;&amp; systemctl <span class="built_in">enable</span> mysqld</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">grep <span class="string">&#x27;temporary password&#x27;</span> /var/<span class="built_in">log</span>/mysqld.log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql -uroot -ppassword</span><br><span class="line"></span><br><span class="line">alter user root@localhost identified by <span class="string">&#x27;Hadoop.2023&#x27;</span>;</span><br><span class="line">flush privileges;</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<ul>
<li><h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1></li>
<li><p>解压</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf apache-hive-2.3.9-bin.tar.gz</span><br><span class="line">mv apache-hive-2.3.9-bin /home/hive</span><br></pre></td></tr></table></figure>

<ul>
<li>增加PATH</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">vi</span> <span class="string">~/.bashrc</span></span><br><span class="line"></span><br><span class="line"><span class="attr">epxort</span> <span class="string">HIVE_HOME=/home/hive</span></span><br><span class="line"><span class="attr">export</span> <span class="string">PATH=$PATH:/home/hadoop/bin:$HIVE_HOME/bin</span></span><br><span class="line"></span><br><span class="line"><span class="attr">source</span> <span class="string">~/.bashrc</span></span><br></pre></td></tr></table></figure>

<ul>
<li>创建hdfs的hive目录</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -mkdir -p /user/hive</span><br><span class="line">hdfs dfs -chmod -R 777 /user/hive</span><br><span class="line">hdfs dfs -mkdir -p /tmp/hive</span><br><span class="line">hdfs dfs -chmod -R 777 /tmp/hive</span><br></pre></td></tr></table></figure>

<ul>
<li>配置hive本地临时目录</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /home/tmp/hive</span><br><span class="line">chmod -R 777 /home/tmp/hive</span><br></pre></td></tr></table></figure>

<ul>
<li>配置hive-site.xml</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/hive/conf</span><br><span class="line"></span><br><span class="line">cp hive-default.xml.template hive-site.xml</span><br></pre></td></tr></table></figure>

<ul>
<li> 使用vim模式替换</li>
</ul>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 替换临时目录</span><br><span class="line">:%s#$&#123;<span class="built_in">system</span>:java.io.tmpdir&#125;#/home/temp/hive#g</span><br><span class="line"></span><br><span class="line"># 替换目录用户</span><br><span class="line">:%s#$&#123;<span class="built_in">system</span>:user.name&#125;#root#g</span><br></pre></td></tr></table></figure>

<ul>
<li>修改hive数据库配置</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">nae</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Driver class name for a JDBC metastore<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Username to use against metastore database<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://172.18.23.219:3306/hive?createDatabaseIfNoExist=true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">    JDBC connect string for a JDBC metastore.</span><br><span class="line">    To use SSL to encrypt/authenticate the connection, provide database-specific SSL flag in the connection URL.</span><br><span class="line">    For example, jdbc:postgresql://myhost/db?ssl=true for postgres database.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>Hadoop.2023<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>password to use against metastore database<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>下载jdbc驱动，上传到<code>/home/hive/lib</code>目录下。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y wget </span><br><span class="line">wget https://repo1.maven.org/maven2/mysql/mysql-connector-java/5.1.48/mysql-connector-java-5.1.48.jar</span><br></pre></td></tr></table></figure>

<h1 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h1><ul>
<li>初始化</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /home/hive/bin</span><br><span class="line">schematool -initSchema -dbType mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 如果没有自动创建hive数据库，需要自己手动创建，后重新执行上述语句。</span><br></pre></td></tr></table></figure>

<ul>
<li>启动Hive</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./hive</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2023/02/22/bigdata/spark/install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/02/22/bigdata/spark/install/" class="post-title-link" itemprop="url">单机部署Spark On Yarn</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-02-22 22:04:31 / 修改时间：23:13:29" itemprop="dateCreated datePublished" datetime="2023-02-22T22:04:31+08:00">2023-02-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/" itemprop="url" rel="index"><span itemprop="name">hadoop</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/course/" itemprop="url" rel="index"><span itemprop="name">course</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/course/dds/" itemprop="url" rel="index"><span itemprop="name">dds</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p>需要部署大数据治理平台，查看了一些开源版本之后发现微众银行的<a target="_blank" rel="noopener" href="https://github.com/WeBankFinTech/DataSphereStudio">DataSphereStudio</a>(DSS)比较符合我们的预期，于是着手部署该数据平台。</p>
<p>因为DSS默认支持的Spark2.0以上版本，于是本次的安装也用<a target="_blank" rel="noopener" href="https://dlcdn.apache.org/spark/spark-3.3.2/spark-3.3.2-bin-hadoop2.tgz">3.3.2-hadoop2</a>版本。</p>
<p>参考安装文档<a target="_blank" rel="noopener" href="https://spark.apache.org/docs/2.4.3/running-on-yarn.html">Running Spark on YARN - Spark 2.4.3 Documentation (apache.org)</a>。</p>
<h1 id="基础软件"><a href="#基础软件" class="headerlink" title="基础软件"></a>基础软件</h1><ul>
<li><a target="_blank" rel="noopener" href="https://downloads.lightbend.com/scala/2.12.17/scala-2.12.17.rpm">Scala2.12.17</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y scala-2.12.17.rpm</span><br></pre></td></tr></table></figure>

<h1 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h1><ul>
<li>设置</li>
</ul>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><ul>
<li>解压</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf spark-3.3.2-bin-hadoop2.tgz</span><br><span class="line">mv spark-3.3.2-bin-hadoop2 /home/spark</span><br></pre></td></tr></table></figure>

<ul>
<li>配置spark-env.sh</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Options read in any cluster manager using HDFS</span></span><br><span class="line"><span class="comment"># - HADOOP_CONF_DIR, to point Spark towards Hadoop configuration files</span></span><br><span class="line"><span class="attr">HADOOP_CONF_DIR</span>=<span class="string">/home/bigdata/hadoop/etc/hadoop</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Options read in YARN client/cluster mode</span></span><br><span class="line"><span class="comment"># - YARN_CONF_DIR, to point Spark towards YARN configuration files when you use YARN</span></span><br><span class="line"><span class="attr">YARN_CONF_DIR</span>=<span class="string">/home/bigdata/hadoop/etc/hadoo</span></span><br></pre></td></tr></table></figure>

<ul>
<li>编辑<code>/home/hadoop/etc/hadoop/yarn-site.xml</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.pmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.vmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h1><ul>
<li>启动dfs</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start-dfs.sh</span><br></pre></td></tr></table></figure>

<ul>
<li>启动yarn</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start-yarn.sh</span><br></pre></td></tr></table></figure>

<ul>
<li>运行sprk-shell</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spark-shell --master yarn --deploy-mode client</span><br></pre></td></tr></table></figure>

<ul>
<li>验证yarn</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://hadoop0:8088/cluster</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2023/02/22/bigdata/hadoop/hadoop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/02/22/bigdata/hadoop/hadoop/" class="post-title-link" itemprop="url">单机部署Hadoop</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-02-22 20:04:43 / 修改时间：22:13:18" itemprop="dateCreated datePublished" datetime="2023-02-22T20:04:43+08:00">2023-02-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/" itemprop="url" rel="index"><span itemprop="name">hadoop</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/course/" itemprop="url" rel="index"><span itemprop="name">course</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/hadoop/course/dds/" itemprop="url" rel="index"><span itemprop="name">dds</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p>需要部署大数据治理平台，查看了一些开源版本之后发现微众银行的<a target="_blank" rel="noopener" href="https://github.com/WeBankFinTech/DataSphereStudio">DataSphereStudio</a>(DSS)比较符合我们的预期，于是着手部署该数据平台。</p>
<p>因为DSS默认支持的是Hadoop2.7.2，于是本次的安装也用<a target="_blank" rel="noopener" href="https://archive.apache.org/dist/hadoop/common/hadoop-2.7.2/hadoop-2.7.2.tar.gz">2.7.2</a>版本。</p>
<p>参考安装文档<a target="_blank" rel="noopener" href="https://hadoop.apache.org/docs/r2.7.2/hadoop-project-dist/hadoop-common/SingleCluster.html">Apache Hadoop 2.7.2 – Hadoop: Setting up a Single Node Cluster.</a>。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/02/22/bigdata/hadoop/hadoop/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2023/01/26/bigdata/tdengine/tdengine-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/26/bigdata/tdengine/tdengine-2/" class="post-title-link" itemprop="url">引入tdengine流计算</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-01-26 10:09:15 / 修改时间：10:47:28" itemprop="dateCreated datePublished" datetime="2023-01-26T10:09:15+08:00">2023-01-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tdengine/" itemprop="url" rel="index"><span itemprop="name">tdengine</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>参考前文<a href="https://l4qiang.me/2022/10/30/tdengine/tdengine-1/">系统升级TDengine3.0</a>安装TDegine。</p>
<h2 id="创建原始数据表"><a href="#创建原始数据表" class="headerlink" title="创建原始数据表"></a>创建原始数据表</h2><p>虽然程序中支持使用动态创建原始数据表，但在创建流计算时需要原始数据表的信息，因此先创建，此处省略其他字段。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/01/26/bigdata/tdengine/tdengine-2/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2023/01/26/virtualization/ovirt-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/26/virtualization/ovirt-1/" class="post-title-link" itemprop="url">安装Ovirt后导致无法连接Docker容器问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-26 09:41:38" itemprop="dateCreated datePublished" datetime="2023-01-26T09:41:38+08:00">2023-01-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-02-19 15:38:03" itemprop="dateModified" datetime="2023-02-19T15:38:03+08:00">2023-02-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/oVirt/" itemprop="url" rel="index"><span itemprop="name">oVirt</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/oVirt/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>因为<a href="https://l4qiang.me/2023/01/25/git/git-3/">备份GitLab代码仓库</a>，安装了<a href="https://l4qiang.me/2019/05/30/virtualizaition/ovirt/">oVirt4.3</a>，之后发现原来的Docker服务无法访问了。简单测试Docker服务本身是可用的。在张同学的协助下，初步断定是oVirt安装了路由发生了变化引起的。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/01/26/virtualization/ovirt-1/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2023/01/25/git/git-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/01/25/git/git-3/" class="post-title-link" itemprop="url">备份Git代码仓库并定时更新</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-01-25 16:04:33 / 修改时间：21:04:18" itemprop="dateCreated datePublished" datetime="2023-01-25T16:04:33+08:00">2023-01-25</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>公司所在机房时不时断电，且因为机房没配置UPS，于是考虑用自己家里的NAS做一个GitLab仓库的异地备份。</p>
<p>之前其实已经在物理机（CentOS7系统）上通过部署Gogs，通过新增镜像仓库的方式实现了代码的异地备份。但Linux的VPN客户端不稳定的，即便配置了自动重连，但无法断线重连，导致无法正常同步。于是使用<a href="https://l4qiang.me/2019/05/30/virtualizaition/ovirt/">oVirt</a> 安装了Windows虚拟机，并使用SoftEther Vpn Client配置好公司的VPN网络，需要配置开机自动启动和断线自动连接。</p>
<p>考虑到之前部署Gogs时只能一个个新增镜像仓库，也是花了不少时间。这次重新部署，直接使用Git命令（不依赖Gogs）、自动化脚本和Windows定时任务的方式进行同步备份。</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="SSH-Keys"><a href="#SSH-Keys" class="headerlink" title="SSH Keys"></a>SSH Keys</h3><p>因为涉及到多个项目的同步，配置上SSH Keys，可以减少配置和增加安全性。</p>
<ol>
<li><p>生成ssh公私钥，使用下面的脚本，都使用默认，敲回车即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -o -t rsa -b 4096 -C &quot;l4qiang@gmail.com&quot;</span><br></pre></td></tr></table></figure></li>
<li><p>复制<code>/c/Users/v/.ssh/id_rsa/id_rsa.pub</code>内容</p>
</li>
<li><p>添加用户的SSH Keys，点击用户头像，<code>settings-&gt;SSH Keys</code>，将复制的公钥贴入Key的文本框中，点击Add Key按钮。</p>
</li>
<li><p>测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@xxx.com</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Git镜像仓库与同步"><a href="#Git镜像仓库与同步" class="headerlink" title="Git镜像仓库与同步"></a>Git镜像仓库与同步</h3><p>主要使用两个git命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建镜像</span></span><br><span class="line">git <span class="built_in">clone</span> --mirror git@xxx.com/l4qiang/aaa.git</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 同步</span></span><br><span class="line">git --git-dir=aaa.git remote update</span><br></pre></td></tr></table></figure>

<h3 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h3><p>编写脚本并命名为<code>sync.sh</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">gitpath_prefix=git@xxx.com:</span><br><span class="line">gitpath_name=(l4qiang/aaa.git l4qiang/bbb.git)</span><br><span class="line">rep_path=/c/Repository</span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;gitpath_name[@]&#125;</span>&quot;</span>; </span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$rep_path</span></span><br><span class="line">    user_name=<span class="variable">$&#123;name%/*&#125;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$user_name</span></span><br><span class="line">    project_name=<span class="variable">$&#123;name##*/&#125;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$project_name</span></span><br><span class="line">    <span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$name</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;正在备份，同步……&quot;</span><span class="variable">$name</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">cd</span> <span class="variable">$user_name</span></span><br><span class="line">        git --git-dir=<span class="variable">$project_name</span> remote update</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;正在备份，创建……&quot;</span><span class="variable">$name</span> </span><br><span class="line"></span><br><span class="line">        mkdir -p <span class="variable">$name</span></span><br><span class="line">        <span class="built_in">cd</span> <span class="variable">$user_name</span></span><br><span class="line">        git <span class="built_in">clone</span> --mirror $gitpath_prefix<span class="variable">$name</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h3><p>打开<code>Task Scheduler</code>，选择<code>Action-&gt;Create Basic Task</code>，按格式填写对应的任务信息。</p>
<p>主要是Actions部分，填写如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;C:\Program Files\Git\bin\bash.exe&quot; /c/Repository/sync.sh</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2022/11/21/go/go-plugin/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/21/go/go-plugin/" class="post-title-link" itemprop="url">go-plugin教程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-11-21 15:26:32 / 修改时间：15:30:23" itemprop="dateCreated datePublished" datetime="2022-11-21T15:26:32+08:00">2022-11-21</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>20k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>18 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://cheppers.com/post/hashicorps-go-plugin-extensive-tutorial/">原文 HashiCorp’s go-plugin extensive tutorial</a></p>
<h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><p>If you don’t know what go-plugin is, don’t worry, here is a small introduction on the subject matter:</p>
<p>Back in the old days when Go didn’t have the <code>plugin</code> package, HashiCorp was desperately looking for a way to use plugins.</p>
<p>In the old days, Lua plus Go wasn’t really a thing yet, and to be honest, nobody wants to write Lua ( joking!).</p>
<p>And thus Mitchell had this brilliant idea of using RPC over the local network to serve a local interface as something that could easily be implemented with any other language that supported RPC. This sounds convoluted but has many benefits! For example, your code will never crash because of a plugin and the ability to use any language to implement a plugin. Not just Go.</p>
<p>It has been a battle-hardened solution for years now and is being actively used by Terraform, Vault, Consule, and especially Packer. All using go-plugin in order to provide a much needed flexibility. Writing a plugin is easy. Or so they say.</p>
<p>It can get complicated quickly, for example, if you are trying to use GRPC. You can lose sight of what exactly you’ll need to implement, where and why; or utilizing various languages or using go-plugins in your own project and extending your CLI with pluggable components.</p>
<p>These are all nothing to sneeze at. Suddenly you’ll find yourself with hundreds of lines of code pasted from various examples and yet nothing works. Or worse, it DOES work but you have no idea how. Then you find yourself needing to extend it with a new capability, or you find an elusive bug and can’t trace its origins.</p>
<p>Fear not. I’ll try to demystify things and draw a clear picture about how it works and how the pieces fit together.</p>
<p>Let’s start at the beginning.</p>
<h2 id="Basic-plugin"><a href="#Basic-plugin" class="headerlink" title="Basic plugin"></a>Basic plugin</h2><p>Let’s start by writing a simple Go GRPC plugin. In fact, we can go through the basic example in the go-plugin’s repository which can be quite confusing when first starting out. We’ll go step-by-step, and the switch to GRPC will be much easier!</p>
<h2 id="Basic-concepts"><a href="#Basic-concepts" class="headerlink" title="Basic concepts"></a>Basic concepts</h2><h3 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h3><p>In the case of plugins, the Server is the one serving the plugin’s implementation. This means the server will have to provide the implementation to an interface.</p>
<h3 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h3><p>The Client calls the server in order to execute the desired behavior. The underlying logic will connect to the server running on localhost on a random higher port, call the wanted function’s implementation and wait for a response. Once the response is received provide that back to the calling Client.</p>
<h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><h3 id="The-main-function"><a href="#The-main-function" class="headerlink" title="The main function"></a>The main function</h3><h4 id="Logger"><a href="#Logger" class="headerlink" title="Logger"></a>Logger</h4><p>The plugins defined here use stdout in a special way. If you aren’t writing a Go based plugin, you will have to do that yourself by outputting something like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1|1|tcp|127.0.0.1:1234|grpc </span><br></pre></td></tr></table></figure>

<p>We’ll come back to this later. Suffice to say the framework will pick this up and will connect to the plugin based on the output. In order to get some output back, we must define a special logger:</p>
<p> <code>// Create an hclog.Logger logger := hclog.New(&amp;hclog.LoggerOptions&#123;     Name:   &quot;plugin&quot;,     Output: os.Stdout,     Level:  hclog.Debug, &#125;)</code> </p>
<h4 id="NewClient"><a href="#NewClient" class="headerlink" title="NewClient"></a>NewClient</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> // We&#x27;re a host! Start by launching the plugin process. client := plugin.NewClient(&amp;plugin.ClientConfig&#123;</span><br><span class="line">    HandshakeConfig: handshakeConfig,</span><br><span class="line">    Plugins:         pluginMap,</span><br><span class="line">    Cmd:             exec.Command(&quot;./plugin/greeter&quot;),</span><br><span class="line">    Logger:          logger,</span><br><span class="line">&#125;) defer client.Kill() </span><br></pre></td></tr></table></figure>

<p>What is happening here? Let’s see one by one: <strong>HandshakeConfig: handshakeConfig</strong>: This part is the handshake configuration of the plugin. It has a nice comment as well.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> // handshakeConfigs are used to just do a basic handshake between // a plugin and host. If the handshake fails, a user friendly error is shown. // This prevents users from executing bad plugins or executing a plugin // directory. It is a UX feature, not a security feature. var handshakeConfig = plugin.HandshakeConfig&#123;</span><br><span class="line">    ProtocolVersion:  1,</span><br><span class="line">    MagicCookieKey:   &quot;BASIC_PLUGIN&quot;,</span><br><span class="line">    MagicCookieValue: &quot;hello&quot;,</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>The <strong>ProtocolVersion</strong> here is used in order to maintain compatibility with your current plugin versions. It’s basically like an API version. If you increase this, you will have two options. Don’t accept lower protocol versions nor switch to the version number and use a different client implementation for a lower version than for a higher version. This way you will maintain backwards compatibility. The <strong>MagicCookieKey</strong> and <strong>MagicCookieValue</strong> are used for a basic handshake which the comment is talking about. You have to set this <strong>ONCE</strong> for your application. Never change it again, for if you do, your plugins will no longer work. For uniqueness sake, I suggest using UUID. <strong>Cmd</strong> is one of the most important parts about a plugin. Basically how plugins work is that they boil down to a compiled binary which is executed and starts an RPC server. This is where you will have to define the binary which will be executed and does all this. Since this is all happening locally, (please keep in mind that Go-plugins only support localhost, and for a good reason), these binaries will most likely sit next to your application’s binary or in a pre-configured global location. Something like: <code>~/.config/my-app/plugins</code>. This is individual for each plugin of course. The plugins can be autoloaded via a discovery function given a path and a glob. And last but not least is the <code>Plugins</code> map. This map is used in order to identify a plugin called <code>Dispense</code>. This map is globally available and must stay consistent in order for all the plugins to work:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// pluginMap is the map of plugins we can dispense. var pluginMap = map[string]plugin.Pluglin   &quot;greeter&quot;: &amp;example.GreeterPlugin&#123;&#125;, &#125; </span><br></pre></td></tr></table></figure>

<p>You can see that the key is the name of the plugin and the value is the plugin. We then proceed to create an RPC client:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> // Connect via RPC rpcClient, err := client.Client() if err != nil &#123;</span><br><span class="line">    log.Fatal(err)</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>Nothing fancy about this one… Now comes the interesting part:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> // Request the plugin raw, err := rpcClient.Dispense(&quot;greeter&quot;) if err != nil &#123;</span><br><span class="line">    log.Fatal(err)</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>What’s happening here? Dispense will look in the above created map and search for the plugin. If it cannot find it, it will throw an error at us. If it does find it, it will cast this plugin to an RPC or a GRPC type plugin. Then proceed to create an RPC or a GRPC client out of it. There is no call yet. This is just creating a client and parsing it to a respective representation. Now comes the magic:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// We should have a Greeter now! This feels like a normal interface // implementation but is in fact over an RPC connection. greeter := raw.(example.Greeter) fmt.Println(greeter.Greet()) </span><br></pre></td></tr></table></figure>

<p>Here we are type asserting our raw GRPC client into our own plugin type. This is so we can call the respective function on the plugin! Once that’s done we will have a {client,struct,implementation} that can be called like a simple function. The implementation right now comes from greeter_impl.go, but that will change once protoc makes an appearance. Behind the scenes, go-plugin will do a bunch of hat tricks with multiplexing TCP connections as well as a remote procedure call to our plugin. Our plugin then will run the function, generate some kind of output, and will then send that back for the waiting client. The client will then proceed to parse the message into a given response type and will then return it back to the client’s callee. This concludes main.go for now.</p>
<h3 id="The-Interface"><a href="#The-Interface" class="headerlink" title="The Interface"></a>The Interface</h3><p>Now let’s investigate the Interface. The interface is used to provide calling details. This interface will be what defines our plugins’ capabilities. How does our look like?</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> // Greeter is the interface that we&#x27;re exposing as a plugin. type Greeter interface &#123;</span><br><span class="line">    Greet() string</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>This is pretty simple. It defines a function which will return a string typed value. Now, we will need a couple of things for this to work. Firstly we need something which defines the RPC workings. go-plugin is working with <code>net/http</code> inside. It also uses something called Yamux for connection multiplexing, but we needn’t worry about this detail. Implementing the RPC details looks like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> // Here is an implementation that talks over RPC type GreeterRPC struct &#123;</span><br><span class="line">    client *rpc.Client</span><br><span class="line">&#125;</span><br><span class="line">func (g *GreeterRPC) Greet() string &#123;</span><br><span class="line">    var resp string</span><br><span class="line">    err := g.client.Call(&quot;Plugin.Greet&quot;, new(interface&#123;&#125;), &amp;resp)</span><br><span class="line">    if err != nil &#123;</span><br><span class="line">        // You usually want your interfaces to return errors. If they don&#x27;t,</span><br><span class="line">        // there isn&#x27;t much other choice here.</span><br><span class="line">        panic(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return resp</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>Here the GreeterRPC struct is an RPC specific implementation that will handle communication over RPC. This is Client in this setup. In case of gRPC, this would look something like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> // GRPCClient is an implementation of KV that talks over RPC. type GreeterGRPC struct&#123; client proto.GreeterClient &#125;</span><br><span class="line">func (m *GreeterGRPC) Greet() (string, error) &#123;</span><br><span class="line">    s, err := m.client.Greet(context.Background(), &amp;proto.Empty&#123;&#125;)</span><br><span class="line">    return s, err</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>What is happening here? What’s Proto and what is GreeterClient? GRPC uses Google’s protoc library to serialize and unserialize data.<code>proto.GreeterClient</code> is generated Go code by protoc. This code is a skeleton for which implementation detail will be replaced on run time. Well, the actual result will be used and not replaced as such. Back to our previous example. The RPC client calls a specific Plugin function called Greet for which the implementation will be provided by a Server that will be streamed back over the RPC protocol. The server is pretty easy to follow:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> // Here is the RPC server that GreeterRPC talks to, conforming to // the requirements of net/rpc type GreeterRPCServer struct &#123;</span><br><span class="line">    // This is the real implementation</span><br><span class="line">    Impl Greeter</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>Impl is the concrete implementation that will be called in the Server’s implementation of the Greet plugin. Now we must define Greet on the RPCServer in order for it to be able to call the remote code. This looks like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> func (s *GreeterRPCServer) Greet(args interface&#123;&#125;, resp *string) error &#123;</span><br><span class="line">    *resp = s.Impl.Greet()</span><br><span class="line">    return nil</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>This is all still boilerplate for the RPC works. Now comes plugin. For this, the comment is actually quite good too:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> // This is the implementation of plugin.Plugin so we can serve/consume this // // This has two methods: Server must return an RPC server for this plugin // type. We construct a GreeterRPCServer for this. // // Client must return an implementation of our interface that communicates // over an RPC client. We return GreeterRPC for this. // // Ignore MuxBroker. That is used to create more multiplexed streams on our // plugin connection and is a more advanced use case. type GreeterPlugin struct &#123;</span><br><span class="line">    // Impl Injection</span><br><span class="line">    Impl Greeter</span><br><span class="line">&#125;</span><br><span class="line">func (p *GreeterPlugin) Server(*plugin.MuxBroker) (interface&#123;&#125;, error) &#123;</span><br><span class="line">    return &amp;GreeterRPCServer&#123;Impl: p.Impl&#125;, nil</span><br><span class="line">&#125;</span><br><span class="line">func (GreeterPlugin) Client(b *plugin.MuxBroker, c *rpc.Client) (interface&#123;&#125;, error) &#123;</span><br><span class="line">    return &amp;GreeterRPC&#123;client: c&#125;, nil</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>What does this mean? So, remember: <code>GreeterRPCServer</code> is the one calling the actual implementation while Client is receiving the result of that call. The <code>GreeterPlugin</code> has the <code>Greeter</code> interface embedded just like the <code>RPCServer</code>. We will use the <code>GreeterPlugin</code> as a struct in the plugin map. This is the plugin that we will actually use. This is all still common stuff. These things will need to be visible for both. The plugin’s implementation will use the interface to see what it needs to implement. The Client will use it see what to call and what API is available. Like, <code>Greet</code>. How does the implementation look like?</p>
<h3 id="The-Implementation"><a href="#The-Implementation" class="headerlink" title="The Implementation"></a>The Implementation</h3><p>In a completely separate package, but which still has access to the interface definition, this plugin could be something like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> // Here is a real implementation of Greeter type GreeterHello struct &#123;</span><br><span class="line">    logger hclog.Logger</span><br><span class="line">&#125;</span><br><span class="line">func (g *GreeterHello) Greet() string &#123;</span><br><span class="line">    g.logger.Debug(&quot;message from GreeterHello.Greet&quot;)</span><br><span class="line">    return &quot;Hello!&quot;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>We create a struct and then add the function to it which is defined by the plugin’s interface. This interface, since it’s required by both parties, could well sit in a common package outside of both programs. Something like a SDK. Both code could import it and use it as a common dependency. This way we have separated the interface from the plugin <strong>and</strong> the calling client. The <code>main</code> function could look something like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> logger := hclog.New(&amp;hclog.LoggerOptions&#123;</span><br><span class="line">    Level:      hclog.Trace,</span><br><span class="line">    Output:     os.Stderr,</span><br><span class="line">    JSONFormat: true,</span><br><span class="line">&#125;)</span><br><span class="line">greeter := &amp;GreeterHello&#123;</span><br><span class="line">    logger: logger,</span><br><span class="line">&#125; // pluginMap is the map of plugins we can dispense. var pluginMap = map[string]plugin.Plugin&#123;</span><br><span class="line">    &quot;greeter&quot;: &amp;example.GreeterPlugin&#123;Impl: greeter&#125;,</span><br><span class="line">&#125;</span><br><span class="line">logger.Debug(&quot;message from plugin&quot;, &quot;foo&quot;, &quot;bar&quot;)</span><br><span class="line">plugin.Serve(&amp;plugin.ServeConfig&#123;</span><br><span class="line">    HandshakeConfig: handshakeConfig,</span><br><span class="line">    Plugins:         pluginMap,</span><br><span class="line">&#125;) </span><br></pre></td></tr></table></figure>

<p>Notice two things that we need. One is the <code>handshakeConfig</code>. You can either define it here, with the same cookie details as you defined in the client code, or you can extract the handshake information into the SDK. This is up to you. Then the next interesting thing is the <code>plugin.Serve</code> method. This is where the magic happens. The plugins open up a RPC communication socket and over a hijacked <code>stdout</code>, broadcasts its availability to the calling Client in this format:</p>
<p> <code>CORE-PROTOCOL-VERSION | APP-PROTOCOL-VERSION | NETWORK-TYPE | NETWORK-ADDR | PROTOCOL</code> </p>
<p>For Go plugins, you don’t have to concern yourself with this. <code>go-plugin</code> takes care of all this for you. For non-Go versions, we must take this into account. And before calling serve, we need to output this information to <code>stdout</code>. For example, a Python plugin must deal with this himself. Like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># Output information print(&quot;1|1|tcp|127.0.0.1:1234|grpc&quot;) sys.stdout.flush() </span><br></pre></td></tr></table></figure>

<p>For GRPC plugins, it’s also mandatory to implement a HealthChecker. How would all this look like with GRPC? It gets slightly more complicated but not too much. We need to use <code>protoc</code> to create a protocol description for our implementation, and then we will call that. Let’s look at this now by converting the basic greeter example into GRPC.</p>
<h1 id="GRPC-Basic-plugin"><a href="#GRPC-Basic-plugin" class="headerlink" title="GRPC Basic plugin"></a>GRPC Basic plugin</h1><p>The example that’s under GRPC is quite elaborate and perhaps you don’t need the Python part. I will focus on the basic RPC example into a GRPC example. That should not be a problem.</p>
<h2 id="The-API"><a href="#The-API" class="headerlink" title="The API"></a>The API</h2><p>First and foremost, you will need to define an API to implement with <code>protoc</code>. For our basic example, the protoc file could look like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> syntax = &quot;proto3&quot;; package proto;</span><br><span class="line">message GreetResponse &#123;</span><br><span class="line">    string message = 1;</span><br><span class="line">&#125;</span><br><span class="line">message Empty &#123;&#125;</span><br><span class="line">service GreeterService &#123;</span><br><span class="line">    rpc Greet(Empty) returns (GreetResponse);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>The syntax is quite simple and readable. What this defines is a message, which is a response, that will contain a <code>message</code> with the type <code>string</code>. The <code>service</code> defines a service which has a method called <code>Greet</code>. The service definition is basically an interface for which we will be providing the concrete implementation through the plugin. To read more about protoc, visit this page: <a target="_blank" rel="noopener" href="https://developers.google.com/protocol-buffers/">Google Protocol Buffer</a>.</p>
<h2 id="Generate-the-code"><a href="#Generate-the-code" class="headerlink" title="Generate the code"></a>Generate the code</h2><p>Now, with the protoc definition in hand, we need to generate the stubs that the local client implementation can call. That client call will then, through the remote procedure call, call the right function on the server which will have the concrete implementation at the ready. Run it and return the result in the specified format. Because the stub needs to be available by both parties, (the client AND the server), this needs to live in a shared location. Why? Because the client is calling the stub and the server is implementing the stub. Both need it in order to know what to call/implement. To generate the code, run this command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc -I proto/ proto/greeter.proto --go_out=plugins=grpc:proto </span><br></pre></td></tr></table></figure>

<p>I encourage you to read the generated code. Much will make little sense at first. It will have a bunch of structs and defined things that the GRPC package will use in order to server the function. The interesting bits and pieces are:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> func (m *GreetResponse) GetMessage() string &#123;</span><br><span class="line">    if m != nil &#123;</span><br><span class="line">        return m.Message</span><br><span class="line">    &#125;</span><br><span class="line">    return &quot;&quot;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>Which will get use the message inside the response.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> type GreeterServiceClient interface &#123;</span><br><span class="line">    Greet(ctx context.Context, in *Empty, opts ...grpc.CallOption) (*GreetResponse, error)</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>This is our ServiceClient interface which defines the Greet function’s topology. And lastly, this guy:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> func RegisterGreeterServiceServer(s *grpc.Server, srv GreeterServiceServer) &#123;</span><br><span class="line">    s.RegisterService(&amp;_GreeterService_serviceDesc, srv)</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>Which we will need in order to register our implementation for the server. We can ignore the rest. ## The interface Much like the RPC, we need to define an interface for the client and server to use. This must be in a shared place as both the server and the client need to know about it. You could put this into an SDK and your peers could just get the SDK and implement some function for define and done. The interface definition in the GRPC land could look something like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> // Greeter is the interface that we&#x27;re exposing as a plugin. type Greeter interface &#123;</span><br><span class="line">    Greet() string</span><br><span class="line">&#125;</span><br><span class="line">// This is the implementation of plugin.GRPCPlugin so we can serve/consume this. type GreeterGRPCPlugin struct &#123;</span><br><span class="line">    // GRPCPlugin must still implement the Plugin interface</span><br><span class="line">    plugin.Plugin</span><br><span class="line">    // Concrete implementation, written in Go. This is only used for plugins</span><br><span class="line">    // that are written in Go.</span><br><span class="line">    Impl Greeter</span><br><span class="line">&#125;</span><br><span class="line">func (p *GreeterGRPCPlugin) GRPCServer(broker *plugin.GRPCBroker, s *grpc.Server) error &#123;</span><br><span class="line">    proto.RegisterGreeterServer(s, &amp;GRPCServer&#123;Impl: p.Impl&#125;)</span><br><span class="line">    return nil</span><br><span class="line">&#125;</span><br><span class="line">func (p *GreeterGRPCPlugin) GRPCClient(ctx context.Context, broker *plugin.GRPCBroker, c *grpc.ClientConn) (interface&#123;&#125;, error) &#123;</span><br><span class="line">    return &amp;GRPCClient&#123;client: proto.NewGreeterClient(c)&#125;, nil</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>With this we have the Plugin’s implementation for hashicorp what needed to be done. The plugin will call the underlying implementation and serve/consume the plugin. We can now write the GRPC part of it. Please note that <code>proto</code> is a shared library too where the protocol stubs reside. That needs to be somewhere on the path or in a separate SDK of some sort, but it must be visible.</p>
<h2 id="Writing-the-GRPC-Client"><a href="#Writing-the-GRPC-Client" class="headerlink" title="Writing the GRPC Client"></a>Writing the GRPC Client</h2><p>Firstly we define the grpc client struct:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// GRPCClient is an implementation of Greeter that talks over RPC. type GRPCClient struct&#123; client proto.GreeterClient &#125; </span><br></pre></td></tr></table></figure>

<p>Then we define how the client will call the remote function:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> func (m *GRPCClient) Greet() string &#123;</span><br><span class="line">    ret, _ := m.client.Greet(context.Background(), &amp;proto.Empty&#123;&#125;)</span><br><span class="line">    return ret.Message</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>This will take the <code>client</code> in the <code>GRPCClient</code> and will call the method on it. Once that’s done we will return to the result <code>Message</code> property which will be <code>Hello!</code>. <code>proto.Empty</code> is an empty struct; we use this if there is no parameter for a defined method or no return value. We can’t just leave it blank. <code>protoc</code> needs to be told explicitly that there is no parameter or return value.</p>
<h2 id="Writing-the-GRPC-Server"><a href="#Writing-the-GRPC-Server" class="headerlink" title="Writing the GRPC Server"></a>Writing the GRPC Server</h2><p>The server implementation will also be similar. We call <code>Impl</code> here which will have our concrete plugin implementation.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> // Here is the gRPC server that GRPCClient talks to. type GRPCServer struct &#123;</span><br><span class="line">    // This is the real implementation</span><br><span class="line">    Impl Greeter</span><br><span class="line">&#125;</span><br><span class="line">func (m *GRPCServer) Greet(</span><br><span class="line">    ctx context.Context,</span><br><span class="line">    req *proto.Empty) *proto.GreeterResponse &#123;</span><br><span class="line">    v := m.Impl.Greet()</span><br><span class="line">    return &amp;proto.GreeterResponse&#123;Message: v&#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>And we will use the <code>protoc</code> defined message response. <code>v</code> will have the response from <code>Greet</code> which will be <code>Hello!</code> provided by the concrete plugin’s implementation. We then transform that into a protoc type by setting the <code>Message</code> property on the <code>GreeterResponse</code> struct provided by the automatically generated protoc stub code. Easy, right?</p>
<h2 id="Writing-the-plugin-itself"><a href="#Writing-the-plugin-itself" class="headerlink" title="Writing the plugin itself"></a>Writing the plugin itself</h2><p>The whole thing looks much like the RPC implementation with just a few small modifications and changes. This can sit completely outside of everything, or can even be provided by a third party implementor.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> // Here is a real implementation of KV that writes to a local file with // the key name and the contents are the value of the key. type Greeter struct&#123;&#125;</span><br><span class="line">func (Greeter) Greet() error &#123;</span><br><span class="line">    return &quot;Hello!&quot;</span><br><span class="line">&#125;</span><br><span class="line">func main() &#123;</span><br><span class="line">    plugin.Serve(&amp;plugin.ServeConfig&#123;</span><br><span class="line">        HandshakeConfig: shared.Handshake,</span><br><span class="line">        Plugins: map[string]plugin.Plugin&#123;</span><br><span class="line">            &quot;greeter&quot;: &amp;shared.GreeterGRPCPlugin&#123;Impl: &amp;Greeter&#123;&#125;&#125;,</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        // A non-nil value here enables gRPC serving for this plugin...</span><br><span class="line">        GRPCServer: plugin.DefaultGRPCServer,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h2 id="Calling-it-all-in-the-main"><a href="#Calling-it-all-in-the-main" class="headerlink" title="Calling it all in the main"></a>Calling it all in the main</h2><p>Once all that is done, the <code>main</code> function looks the same as RPC’s main but with some small modifications.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> // We&#x27;re a host. Start by launching the plugin process. client := plugin.NewClient(&amp;plugin.ClientConfig&#123;</span><br><span class="line">    HandshakeConfig: shared.Handshake,</span><br><span class="line">    Plugins:         shared.PluginMap,</span><br><span class="line">    Cmd:             exec.Command(&quot;./plugin/greeter&quot;),</span><br><span class="line">    AllowedProtocols: []plugin.Protocol&#123;plugin.ProtocolGRPC&#125;,</span><br><span class="line">&#125;) </span><br></pre></td></tr></table></figure>

<p>The <code>NewClient</code> now defines <code>AllowedProtocols</code> to be <code>ProtocolGRPC</code>. The rest is the same as before calling <code>Dispense</code> and value hinting the plugin to the correct type then calling <code>Greet()</code>.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>This is it. We made it! Now our plugin works over GRPC with a defined API by protoc. The plugin’s implementation can live where ever we want it to, but it needs some shared data. These are:</p>
<ul>
<li>The generated code by <code>protoc</code></li>
<li>The defined plugin interface</li>
<li>The GRPC Server and Client</li>
</ul>
<p>These need to be visible by both the Client and the Server. The Server here is the plugin. If you are planning on making people be able to extend your application with go-plugin, you should make these available as a separate SDK. So people won’t have to include your whole project just to implement an interface and use protoc. In fact, you could also extract the <code>protoc</code> definition into a separate repository so that your SDK can also pull it in. You will have three repositories:</p>
<ul>
<li>Your application;</li>
<li>The SDK providing the interface and the GRPC Server and Client implementation;</li>
<li>The protoc definition file and generated skeleton ( for Go based plugins).</li>
</ul>
<p>Other languages will have to generate their own protoc code, and includ it into the plugin; like the Python implementation example located here: <a target="_blank" rel="noopener" href="https://github.com/hashicorp/go-plugin/tree/master/examples/grpc/plugin-python">Go-plugin Python Example</a>. Also, read this documentation carefully: <a target="_blank" rel="noopener" href="https://github.com/hashicorp/go-plugin/blob/master/docs/guide-plugin-write-non-go.md">non-go go-plugin</a>. This document will also clarify what <code>1|1|tcp|127.0.0.1:1234|grpc</code> means and will dissipate the confusion around how plugins work. Lastly, if you would like to have an in-depth explanation about how go-plugin came to be, watch this video by Mitchell: <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=SRvm3zQQc1Q">go-plugin explanation video</a>. I must warn you though- it’s an hour long. But worth the watch!<br>That’s it. I hope this has helped to clear the confusion around how to use go-plugin.</p>
<p>Happy plugging!</p>
<p>Gergely.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://l4qiang.me/2022/10/30/bigdata/tdengine/tdengine-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="L4qiang">
      <meta itemprop="description" content="记录点滴，注重积累。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CrazyAirhead">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/10/30/bigdata/tdengine/tdengine-1/" class="post-title-link" itemprop="url">系统升级TDengine3.0</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-10-30 21:25:42" itemprop="dateCreated datePublished" datetime="2022-10-30T21:25:42+08:00">2022-10-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-10-31 11:22:29" itemprop="dateModified" datetime="2022-10-31T11:22:29+08:00">2022-10-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tdengine/" itemprop="url" rel="index"><span itemprop="name">tdengine</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tdengine/elasticsearch/" itemprop="url" rel="index"><span itemprop="name">elasticsearch</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>公司的一款产品是面向中小企业的内网安全日志采集与分析产品，使用Spring Boot &amp; Spring Cloud框架搭建，使用ElasticSearch进行存储，采用一体机的服务器（配置为4核CPU，32G，1T硬盘），使用CentOS7.8+Docker方式部署应用。</p>
<p>该产品的主要业务流程是，通过探针（探针会部署在多个工控机上）采集触发安全引擎的扫描，产生日志，之后探针采集这些日志并将其推送Kafka，平台端消费Kafka，解析和分析日志并存储到ElasticSearch，之后通过分析查询服务提供最终数据展示。</p>
<p>系统一直运行相对比较平稳，直到产品对日志增加了事件分组的要求，即当日志事件产生时，需要根据一定的规则判断是否当前日志与前一条日志是否未同一组事件。因为需要实时的判断事件的分组，在数据入库ES时，增加了大量的聚合运算。此时ES开始占用大量内存，整体响应慢，造成日志数据入库延时，和分析查询业务无法正常返回数据。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/10/30/bigdata/tdengine/tdengine-1/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">L4qiang</p>
  <div class="site-description" itemprop="description">记录点滴，注重积累。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">255</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">108</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">110</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/crazy-airhead" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;crazy-airhead" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:L4qiang@gmail.com" title="E-Mail → mailto:L4qiang@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/enderjo" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;enderjo" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://ri.cms.firesbox.com/" title="https:&#x2F;&#x2F;ri.cms.firesbox.com" rel="noopener" target="_blank">践行群官方情报站</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">L4qiang</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">550k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">8:20</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  















    <div id="pjax">
  

  


    </div>
</body>
</html>
